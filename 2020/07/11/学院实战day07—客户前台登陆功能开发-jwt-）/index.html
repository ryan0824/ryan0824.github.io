<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>谷粒学院实战day07—客户前台登陆功能开发(jwt)） | Ryan</title><meta name="description" content="1、登陆实现方式1.1、传统的单机模式登陆1.2、单点登陆首先理解一下什么叫单点登陆，英文为single sign on，简称SSO，是指在多系统应用群中登录一个系统，便可在其他所有系统中得到授权而无需再次登录，包括单点登录与单点注销两部分。  实现单点登陆主要有三种方式  session广播 也就是当一个服务登陆后，将用户信息存放到session中，并复制到其他服务器中，这种方式比较浪费资源和内"><meta name="keywords" content="vue,springboot,jwt"><meta name="author" content="Ryan"><meta name="copyright" content="Ryan"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2020/07/11/%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day07%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E7%99%BB%E9%99%86%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91-jwt-%EF%BC%89/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="谷粒学院实战day07—客户前台登陆功能开发(jwt)）"><meta property="og:url" content="http://yoursite.com/2020/07/11/%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day07%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E7%99%BB%E9%99%86%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91-jwt-%EF%BC%89/"><meta property="og:site_name" content="Ryan"><meta property="og:description" content="1、登陆实现方式1.1、传统的单机模式登陆1.2、单点登陆首先理解一下什么叫单点登陆，英文为single sign on，简称SSO，是指在多系统应用群中登录一个系统，便可在其他所有系统中得到授权而无需再次登录，包括单点登录与单点注销两部分。  实现单点登陆主要有三种方式  session广播 也就是当一个服务登陆后，将用户信息存放到session中，并复制到其他服务器中，这种方式比较浪费资源和内"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-07-11T13:35:00.000Z"><meta property="article:modified_time" content="2020-07-12T03:33:11.222Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="谷粒学院实战day08—客户前台讲师+课程页面开发" href="http://yoursite.com/2020/07/14/%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day08%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E8%AE%B2%E5%B8%88-%E8%AF%BE%E7%A8%8B%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91/"><link rel="next" title="谷粒学院实战day06—客户前台开发+整合redis" href="http://yoursite.com/2020/07/10/%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day06%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E5%BC%80%E5%8F%91-%E6%95%B4%E5%90%88redis/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Ryan" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">26</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、登陆实现方式"><span class="toc-number">1.</span> <span class="toc-text">1、登陆实现方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1、传统的单机模式登陆"><span class="toc-number">1.1.</span> <span class="toc-text">1.1、传统的单机模式登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2、单点登陆"><span class="toc-number">1.2.</span> <span class="toc-text">1.2、单点登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3、JWT"><span class="toc-number">1.3.</span> <span class="toc-text">1.3、JWT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、JWT环境准备"><span class="toc-number">2.</span> <span class="toc-text">2、JWT环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1、导入依赖"><span class="toc-number">2.1.</span> <span class="toc-text">2.1、导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2、创建JWT工具类"><span class="toc-number">2.2.</span> <span class="toc-text">2.2、创建JWT工具类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、阿里云短信"><span class="toc-number">3.</span> <span class="toc-text">3、阿里云短信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1、简介"><span class="toc-number">3.1.</span> <span class="toc-text">3.1、简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2、整合java代码"><span class="toc-number">3.2.</span> <span class="toc-text">3.2、整合java代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#controller层"><span class="toc-number">3.2.1.</span> <span class="toc-text">controller层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service层接口"><span class="toc-number">3.2.2.</span> <span class="toc-text">service层接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service层实现类"><span class="toc-number">3.2.3.</span> <span class="toc-text">service层实现类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#swagger测试"><span class="toc-number">3.2.4.</span> <span class="toc-text">swagger测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#controller层完善"><span class="toc-number">3.2.5.</span> <span class="toc-text">controller层完善</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、登陆功能"><span class="toc-number">4.</span> <span class="toc-text">4、登陆功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1、准备数据库"><span class="toc-number">4.1.</span> <span class="toc-text">4.1、准备数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2、创建service-ucenter模块"><span class="toc-number">4.2.</span> <span class="toc-text">4.2、创建service_ucenter模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mp代码生成"><span class="toc-number">4.2.1.</span> <span class="toc-text">mp代码生成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#完善实体类"><span class="toc-number">4.2.2.</span> <span class="toc-text">完善实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#相关配置类"><span class="toc-number">4.2.3.</span> <span class="toc-text">相关配置类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#引入MD5加密工具类"><span class="toc-number">4.2.4.</span> <span class="toc-text">引入MD5加密工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#controller层-1"><span class="toc-number">4.2.5.</span> <span class="toc-text">controller层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service层"><span class="toc-number">4.2.6.</span> <span class="toc-text">service层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#swagger测试-1"><span class="toc-number">4.2.7.</span> <span class="toc-text">swagger测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、注册功能"><span class="toc-number">5.</span> <span class="toc-text">5、注册功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#controller层-2"><span class="toc-number">5.1.</span> <span class="toc-text">controller层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service层-1"><span class="toc-number">5.2.</span> <span class="toc-text">service层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#swagger测试-2"><span class="toc-number">5.3.</span> <span class="toc-text">swagger测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6、根据token获取用户信息"><span class="toc-number">6.</span> <span class="toc-text">6、根据token获取用户信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#controller层-3"><span class="toc-number">6.1.</span> <span class="toc-text">controller层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7、整合前台注册页面"><span class="toc-number">7.</span> <span class="toc-text">7、整合前台注册页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#layouts"><span class="toc-number">7.1.</span> <span class="toc-text">layouts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Api"><span class="toc-number">7.2.</span> <span class="toc-text">Api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pages"><span class="toc-number">7.3.</span> <span class="toc-text">pages</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8、前端整合登陆页面"><span class="toc-number">8.</span> <span class="toc-text">8、前端整合登陆页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装cookie依赖"><span class="toc-number">8.1.</span> <span class="toc-text">安装cookie依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器"><span class="toc-number">8.2.</span> <span class="toc-text">拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#api"><span class="toc-number">8.3.</span> <span class="toc-text">api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pages-1"><span class="toc-number">8.4.</span> <span class="toc-text">pages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#layouts-1"><span class="toc-number">8.5.</span> <span class="toc-text">layouts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#效果测试"><span class="toc-number">8.6.</span> <span class="toc-text">效果测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#退出账号"><span class="toc-number">8.7.</span> <span class="toc-text">退出账号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9、OAuth2"><span class="toc-number">9.</span> <span class="toc-text">9、OAuth2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10、后端微信扫码登陆"><span class="toc-number">10.</span> <span class="toc-text">10、后端微信扫码登陆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置yml文件"><span class="toc-number">10.1.</span> <span class="toc-text">配置yml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建常量类工具"><span class="toc-number">10.2.</span> <span class="toc-text">创建常量类工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#controller层-4"><span class="toc-number">10.3.</span> <span class="toc-text">controller层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试生成二维码"><span class="toc-number">10.4.</span> <span class="toc-text">测试生成二维码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#导入相关依赖"><span class="toc-number">10.5.</span> <span class="toc-text">导入相关依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpClient工具类"><span class="toc-number">10.6.</span> <span class="toc-text">HttpClient工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#回调函数"><span class="toc-number">10.7.</span> <span class="toc-text">回调函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#前台显示微信用户信息"><span class="toc-number">10.8.</span> <span class="toc-text">前台显示微信用户信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试"><span class="toc-number">10.9.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可能遇到的问题"><span class="toc-number">10.10.</span> <span class="toc-text">可能遇到的问题</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Ryan</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">谷粒学院实战day07—客户前台登陆功能开发(jwt)）</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-11 21:35:00"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-07-11</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-12 11:33:11"><i class="fas fa-history fa-fw"></i> 更新于 2020-07-12</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/">前后端分离</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">12.2k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 56 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="far fa-comments fa-fw post-meta__icon"></i><span>评论数:</span><a href="/2020/07/11/%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day07%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E7%99%BB%E9%99%86%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91-jwt-%EF%BC%89/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/07/11/%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day07%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E7%99%BB%E9%99%86%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91-jwt-%EF%BC%89/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="1、登陆实现方式"><a href="#1、登陆实现方式" class="headerlink" title="1、登陆实现方式"></a>1、登陆实现方式</h2><h3 id="1-1、传统的单机模式登陆"><a href="#1-1、传统的单机模式登陆" class="headerlink" title="1.1、传统的单机模式登陆"></a>1.1、传统的单机模式登陆</h3><h3 id="1-2、单点登陆"><a href="#1-2、单点登陆" class="headerlink" title="1.2、单点登陆"></a>1.2、单点登陆</h3><p>首先理解一下什么叫单点登陆，英文为single sign on，简称SSO，是指在多系统应用群中登录一个系统，便可在其他所有系统中得到授权而无需再次登录，包括单点登录与单点注销两部分。</p>
<p><img src= "/img/loading.gif" data-src="C:/Users/86131/Documents/My%20Knowledge/temp/78704046_files/clip_image0041ce28b5a-5e6d-4943-a794-3f3a93e82737.gif" alt="img"></p>
<p>实现单点登陆主要有三种方式</p>
<ul>
<li><p>session广播</p>
<p>也就是当一个服务登陆后，将用户信息存放到session中，并复制到其他服务器中，这种方式比较浪费资源和内存，现在很少用了</p>
</li>
<li><p>cookie+redis</p>
<p>在项目中任何一个模块进行登陆之后，把数据放到两个地方</p>
<ul>
<li>redis，将生成的唯一随机值作为key，value存放用户数据</li>
<li>cookie，把redis里面生成的key放到cookie里面</li>
</ul>
<p>访问项目中其他模块，发送请求带着cookie进行发送，获取cookie值，拿着cookie做事情</p>
<ul>
<li>从cookie获取值，到redis进行查询，根据key进行查询，如果查询到数据就是登陆状态</li>
</ul>
</li>
<li><p>token</p>
<p>token(令牌)是按照一定规则生成字符串，字符串可以包含用户信息</p>
<p>在项目某个模块进行登陆之后，按照规则生成字符串，把登陆之后用户包含到生成字符串里面，把字符串返回，有两种返回方式</p>
<ul>
<li>通过cookie返回</li>
<li>把字符串通过地址栏返回</li>
</ul>
<p>再去访问项目其他模块，每次访问在地址栏带着生成字符串，在访问模块里面获取地址栏字符串，根据字符串获取用户信息，如果可以获取到，就是登陆状态</p>
</li>
</ul>
<p>目前使用token来单点登陆的情况是比较广泛应用的，其大概的原理可以参考下图</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200710091744.gif" alt="img"></p>
<h3 id="1-3、JWT"><a href="#1-3、JWT" class="headerlink" title="1.3、JWT"></a>1.3、JWT</h3><p>我们都知道token是通过生成令牌的方式来请求访问的，而这个令牌是通过什么规则来生成的呢？主要有两种：</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200710095455.jpg" alt="img"></p>
<p>jwt就是官方提供的，也是目前用的较为广泛的一种方式，所以这里我们就采用jwt的形式来实现单点登陆</p>
<p><strong>jwt的组成</strong></p>
<p>来看一个jwt的例子</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200710095653.png" alt="img"></p>
<p>该对象为一个很长的字符串，字符之间通过”.”分隔符分为三个部分。</p>
<p>每一个部分表示了一个功能块：</p>
<p><strong>JWT头</strong></p>
<p>JWT头部分是一个描述JWT元数据的JSON对象，通常如下所示。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"alg"</span>: <span class="string">"HS256"</span>,</span><br><span class="line">  <span class="attr">"typ"</span>: <span class="string">"JWT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，alg属性表示签名使用的算法，默认为HMAC SHA256（写为HS256）；typ属性表示令牌的类型，JWT令牌统一写为JWT。最后，使用Base64 URL算法将上述JSON对象转换为字符串保存。</p>
<p><strong>有效载荷</strong></p>
<p>有效载荷部分，是JWT的主体内容部分，也是一个JSON对象，包含需要传递的数据。 JWT指定七个默认字段供选择。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iss：发行人</span><br><span class="line">exp：到期时间</span><br><span class="line">sub：主题</span><br><span class="line">aud：用户</span><br><span class="line">nbf：在此之前不可用</span><br><span class="line">iat：发布时间</span><br><span class="line">jti：JWT ID用于标识该JWT</span><br></pre></td></tr></table></figure>

<p>除以上默认字段外，我们还可以自定义私有字段，如下例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"sub"</span>: <span class="string">"1234567890"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Helen"</span>,</span><br><span class="line">  <span class="attr">"admin"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，默认情况下JWT是未加密的，任何人都可以解读其内容，因此不要构建隐私信息字段，存放保密信息，以防止信息泄露。</p>
<p>JSON对象也使用Base64 URL算法转换为字符串保存。</p>
<p><strong>签名哈希</strong></p>
<p>签名哈希部分是对上面两部分数据签名，通过指定的算法生成哈希，以确保数据不会被篡改。</p>
<p>首先，需要指定一个密码（secret）。该密码仅仅为保存在服务器中，并且不能向用户公开。然后，使用标头中指定的签名算法（默认情况下为HMAC SHA256）根据以下公式生成签名。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + <span class="string">"."</span> + base64UrlEncode(claims), secret)</span><br></pre></td></tr></table></figure>

<p>在计算出签名哈希后，JWT头，有效载荷和签名哈希的三个部分组合成一个字符串，每个部分用”.”分隔，就构成整个JWT对象。</p>
<p><strong>JWT的原理</strong></p>
<p>JWT的原则是在服务器身份验证之后，将生成一个JSON对象并将其发送回用户，如下所示。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"sub"</span>: <span class="string">"1234567890"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Helen"</span>,</span><br><span class="line">  <span class="attr">"admin"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后，当用户与服务器通信时，客户在请求中发回JSON对象。服务器仅依赖于这个JSON对象来标识用户。为了防止用户篡改数据，服务器将在生成对象时添加签名。</p>
<p>服务器不保存任何会话数据，即服务器变为无状态，使其更容易扩展。</p>
<p><strong>JWT的用法</strong></p>
<p>客户端接收服务器返回的JWT，将其存储在Cookie或localStorage中。</p>
<p>此后，客户端将在与服务器交互中都会带JWT。如果将它存储在Cookie中，就可以自动发送，但是不会跨域，因此一般是将它放入HTTP请求的<code>Header Authorization</code>字段中。当跨域时，也可以将JWT被放置于POST请求的数据主体中。</p>
<p><strong>JWT的问题和趋势</strong></p>
<ul>
<li><p>JWT不仅可用于认证，还可用于信息交换。善用JWT有助于减少服务器请求数据库的次数。</p>
</li>
<li><p>生产的token可以包含基本信息，比如id、用户昵称、头像等信息，避免再次查库</p>
</li>
<li><p>存储在客户端，不占用服务端的内存资源</p>
</li>
<li><p>JWT默认不加密，但可以加密。生成原始令牌后，可以再次对其进行加密。</p>
</li>
<li><p>当JWT未加密时，一些私密数据无法通过JWT传输。</p>
</li>
<li><p>JWT的最大缺点是服务器不保存会话状态，所以在使用期间不可能取消令牌或更改令牌的权限。也就是说，一旦JWT签发，在有效期内将会一直有效。</p>
</li>
<li><p>JWT本身包含认证信息，token是经过base64编码，所以可以解码，因此token加密前的对象不应该包含敏感信息，一旦信息泄露，任何人都可以获得令牌的所有权限。为了减少盗用，JWT的有效期不宜设置太长。对于某些重要操作，用户在使用时应该每次都进行进行身份验证。</p>
</li>
<li><p>为了减少盗用和窃取，JWT不建议使用HTTP协议来传输代码，而是使用加密的HTTPS协议进行传输。</p>
</li>
</ul>
<h2 id="2、JWT环境准备"><a href="#2、JWT环境准备" class="headerlink" title="2、JWT环境准备"></a>2、JWT环境准备</h2><h3 id="2-1、导入依赖"><a href="#2-1、导入依赖" class="headerlink" title="2.1、导入依赖"></a>2.1、导入依赖</h3><p>因为可能在多个模块中都会用到，所以我们会在common模块中导入jwt的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--jwt依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2、创建JWT工具类"><a href="#2-2、创建JWT工具类" class="headerlink" title="2.2、创建JWT工具类"></a>2.2、创建JWT工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置两个常量，一个是过期时间，一个秘钥（规则），这里是随便写的，不同公司规定的可能不一样</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRE = <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_SECRET = <span class="string">"ukc8BDbRigUDaY6pZFfWus2jZWLPHO"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取jwttoken的方法，主要是设置三个部分信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJwtToken</span><span class="params">(String id, String nickname)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String JwtToken = Jwts.builder()</span><br><span class="line">                <span class="comment">//头信息</span></span><br><span class="line">                .setHeaderParam(<span class="string">"typ"</span>, <span class="string">"JWT"</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">"alg"</span>, <span class="string">"HS256"</span>)</span><br><span class="line">                <span class="comment">//设置过期时间</span></span><br><span class="line">                .setSubject(<span class="string">"guli-user"</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> Date(System.currentTimeMillis() + EXPIRE))</span><br><span class="line">                <span class="comment">//设置主题信息</span></span><br><span class="line">                .claim(<span class="string">"id"</span>, id)</span><br><span class="line">                .claim(<span class="string">"nickname"</span>,nickname)</span><br><span class="line">                <span class="comment">//设置哈希签名</span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, APP_SECRET)</span><br><span class="line">                .compact();</span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断token是否存在与有效</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkToken</span><span class="params">(String jwtToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断token是否存在与有效</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String jwtToken = request.getHeader(<span class="string">"token"</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据token获取会员id</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMemberIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String jwtToken = request.getHeader(<span class="string">"token"</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        Claims claims = claimsJws.getBody();</span><br><span class="line">        <span class="keyword">return</span> (String)claims.get(<span class="string">"id"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、阿里云短信"><a href="#3、阿里云短信" class="headerlink" title="3、阿里云短信"></a>3、阿里云短信</h2><h3 id="3-1、简介"><a href="#3-1、简介" class="headerlink" title="3.1、简介"></a>3.1、简介</h3><p>短信服务（Short Message Service）是广大企业客户快速触达手机用户所优选使用的通信能力。</p>
<p>调用API或用群发助手，即可发送验证码、通知类和营销短信；</p>
<p>国内验证短信秒级触达，到达率99%；</p>
<p>点击下图管理控制台进入控制台界面，点击国内消息</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711094956.png" alt="image-20200711094948078"></p>
<p>申请签名模板和和模板管理，名称什么的自定义即可，注意因为要审核，所以名称和申请理由都尽量写得有实际意义一点，才会快速审核通过</p>
<p>涉及到隐私问题，具体内容我就不放上来了</p>
<h3 id="3-2、整合java代码"><a href="#3-2、整合java代码" class="headerlink" title="3.2、整合java代码"></a>3.2、整合java代码</h3><h4 id="controller层"><a href="#controller层" class="headerlink" title="controller层"></a>controller层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"edumsm/msm"</span>)</span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsmController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MsmService msmService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/sendMsm/&#123;phone&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">sendMsm</span><span class="params">(@PathVariable String phone)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注意验证码内容是我们使用代码生成的，而不是阿里云生成的，所以需要使用工具类生成验证码</span></span><br><span class="line">        String code = RandomUtil.getFourBitRandom();</span><br><span class="line">        <span class="comment">//将code放到map集合中，方便后台转换为json格式</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>, code);</span><br><span class="line">        Boolean isSend = msmService.sendMsm(map, phone);</span><br><span class="line">        <span class="keyword">if</span>(isSend)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"发送短信成功"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error().message(<span class="string">"发送短信失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="service层接口"><a href="#service层接口" class="headerlink" title="service层接口"></a>service层接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MsmService</span> </span>&#123;</span><br><span class="line">    <span class="function">Boolean <span class="title">sendMsm</span><span class="params">(Map&lt;String, Object&gt; map, String phone)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="service层实现类"><a href="#service层实现类" class="headerlink" title="service层实现类"></a>service层实现类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsmServiceImpl</span> <span class="keyword">implements</span> <span class="title">MsmService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">sendMsm</span><span class="params">(Map&lt;String, Object&gt; map, String phone)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(phone)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(<span class="string">"default"</span>, <span class="string">"your keyid"</span>, <span class="string">"your secret"</span>);</span><br><span class="line">        DefaultAcsClient client = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置相关固定的参数</span></span><br><span class="line">        CommonRequest request = <span class="keyword">new</span> CommonRequest();</span><br><span class="line">        <span class="comment">//request.setProtocol(ProtocolType.HTTPS);</span></span><br><span class="line">        request.setMethod(MethodType.POST);</span><br><span class="line">        request.setDomain(<span class="string">"dysmsapi.aliyuncs.com"</span>);</span><br><span class="line">        request.setVersion(<span class="string">"2017-05-25"</span>);</span><br><span class="line">        request.setAction(<span class="string">"SendSms"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置发送相关参数</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"PhoneNumbers"</span>, phone);<span class="comment">//手机号码</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"SignName"</span>, <span class="string">"ryan的谷粒在线教育网"</span>);</span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateCode"</span>, <span class="string">"SMS_195722145"</span>);<span class="comment">//模板code</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateParam"</span>, JSON.toJSONString(map));<span class="comment">//验证码数据，转为json字符串传递</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//最终发送</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            CommonResponse response = client.getCommonResponse(request);</span><br><span class="line">            <span class="keyword">boolean</span> success = response.getHttpResponse().isSuccess();</span><br><span class="line">            <span class="keyword">return</span> success;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="swagger测试"><a href="#swagger测试" class="headerlink" title="swagger测试"></a>swagger测试</h4><p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711095400.png" alt="image-20200711095400734"></p>
<p>测试成功，并收到了短信</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【ryan的谷粒在线教育网】您正在申请手机注册，验证码为：8295，5分钟内有效！</span><br></pre></td></tr></table></figure>

<p>但是短信里面说的5分钟内有效只是我的模板内容，具体要怎么实现这个5分钟内有效呢？阿里云只负责帮我们发送短信，具体实现还是需要我们使用代码去实现，说到过期时间，我们可以先到redis，第一次获取code直接到redis获取，如果获取到返回成功，如果没有获取到则使用阿里云发送短信，发送成功后还要将code放到redis中，并设置过期时间，具体代码实现如下：</p>
<h4 id="controller层完善"><a href="#controller层完善" class="headerlink" title="controller层完善"></a>controller层完善</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"edumsm/msm"</span>)</span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsmController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MsmService msmService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/sendMsm/&#123;phone&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">sendMsm</span><span class="params">(@PathVariable String phone)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过手机号码获取code</span></span><br><span class="line">        String code = redisTemplate.opsForValue().get(phone);</span><br><span class="line">        <span class="comment">//如果不为空，表明redis中已经存有验证码而且还没过期，则返回ok</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(code))&#123;</span><br><span class="line">            <span class="keyword">return</span> R.ok();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果为空则说明还没有验证码或者已经过期了，需使用阿里云</span></span><br><span class="line">        <span class="comment">//注意验证码内容是我们使用代码生成的，而不是阿里云生成的，所以需要使用工具类生成验证码</span></span><br><span class="line">        code = RandomUtil.getFourBitRandom();</span><br><span class="line">        <span class="comment">//将code放到map集合中，方便后台转换为json格式</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>, code);</span><br><span class="line">        Boolean isSend = msmService.sendMsm(map, phone);</span><br><span class="line">        <span class="keyword">if</span>(isSend)&#123;</span><br><span class="line">            <span class="comment">//将code放到redis中并设置过期时间，为5分钟</span></span><br><span class="line">            redisTemplate.opsForValue().set(phone, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"发送短信成功"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error().message(<span class="string">"发送短信失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4、登陆功能"><a href="#4、登陆功能" class="headerlink" title="4、登陆功能"></a>4、登陆功能</h2><h3 id="4-1、准备数据库"><a href="#4-1、准备数据库" class="headerlink" title="4.1、准备数据库"></a>4.1、准备数据库</h3><p>数据库脚本</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`ucenter_member`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'会员id'</span>,</span><br><span class="line">  <span class="string">`openid`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'微信openid'</span>,</span><br><span class="line">  <span class="string">`mobile`</span> <span class="built_in">varchar</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'手机号'</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</span><br><span class="line">  <span class="string">`nickname`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'昵称'</span>,</span><br><span class="line">  <span class="string">`sex`</span> <span class="built_in">tinyint</span>(<span class="number">2</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'性别 1 女，2 男'</span>,</span><br><span class="line">  <span class="string">`age`</span> <span class="built_in">tinyint</span>(<span class="number">3</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span>,</span><br><span class="line">  <span class="string">`avatar`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户头像'</span>,</span><br><span class="line">  <span class="string">`sign`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户签名'</span>,</span><br><span class="line">  <span class="string">`is_disabled`</span> <span class="built_in">tinyint</span>(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'是否禁用 1（true）已禁用，  0（false）未禁用'</span>,</span><br><span class="line">  <span class="string">`is_deleted`</span> <span class="built_in">tinyint</span>(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'逻辑删除 1（true）已删除， 0（false）未删除'</span>,</span><br><span class="line">  <span class="string">`gmt_create`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`gmt_modified`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COMMENT</span>=<span class="string">'会员表'</span>;</span><br></pre></td></tr></table></figure>

<p>同时随便准备了两条记录，各位可以自己准备下，方便测试，密码可以线上md5加密下再存入</p>
<h3 id="4-2、创建service-ucenter模块"><a href="#4-2、创建service-ucenter模块" class="headerlink" title="4.2、创建service_ucenter模块"></a>4.2、创建service_ucenter模块</h3><h4 id="mp代码生成"><a href="#mp代码生成" class="headerlink" title="mp代码生成"></a>mp代码生成</h4><h4 id="完善实体类"><a href="#完善实体类" class="headerlink" title="完善实体类"></a>完善实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(callSuper = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@Accessors</span>(chain = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@TableName</span>(<span class="string">"ucenter_member"</span>)</span><br><span class="line"><span class="meta">@ApiModel</span>(value=<span class="string">"Member对象"</span>, description=<span class="string">"会员表"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"会员id"</span>)</span><br><span class="line">    <span class="meta">@TableId</span>(value = <span class="string">"id"</span>, type = IdType.ID_WORKER_STR)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"微信openid"</span>)</span><br><span class="line">    <span class="keyword">private</span> String openid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"手机号"</span>)</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"密码"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"昵称"</span>)</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"性别 1 女，2 男"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"年龄"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"用户头像"</span>)</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"用户签名"</span>)</span><br><span class="line">    <span class="keyword">private</span> String sign;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"是否禁用 1（true）已禁用，  0（false）未禁用"</span>)</span><br><span class="line">    <span class="keyword">private</span> Boolean isDisabled;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"逻辑删除 1（true）已删除， 0（false）未删除"</span>)</span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isDeleted;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"创建时间"</span>)</span><br><span class="line">    <span class="meta">@TableField</span>(fill = FieldFill.INSERT)</span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"更新时间"</span>)</span><br><span class="line">    <span class="meta">@TableField</span>(fill = FieldFill.INSERT_UPDATE)</span><br><span class="line">    <span class="keyword">private</span> Date gmtModified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="相关配置类"><a href="#相关配置类" class="headerlink" title="相关配置类"></a>相关配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.ryan.ucenter.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UcenterConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 逻辑删除插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ISqlInjector <span class="title">sqlInjector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LogicSqlInjector();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="引入MD5加密工具类"><a href="#引入MD5加密工具类" class="headerlink" title="引入MD5加密工具类"></a>引入MD5加密工具类</h4><p>提示：工具类在其他地方也可能会用到，所以放到common模块即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MD5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String strSrc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">char</span> hexChars[] = &#123; <span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>,</span><br><span class="line">                    <span class="string">'9'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span> &#125;;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = strSrc.getBytes();</span><br><span class="line">            MessageDigest md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">            md.update(bytes);</span><br><span class="line">            bytes = md.digest();</span><br><span class="line">            <span class="keyword">int</span> j = bytes.length;</span><br><span class="line">            <span class="keyword">char</span>[] chars = <span class="keyword">new</span> <span class="keyword">char</span>[j * <span class="number">2</span>];</span><br><span class="line">            <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">                <span class="keyword">byte</span> b = bytes[i];</span><br><span class="line">                chars[k++] = hexChars[b &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">0xf</span>];</span><br><span class="line">                chars[k++] = hexChars[b &amp; <span class="number">0xf</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(chars);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"MD5加密出错！！+"</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(MD5.encrypt(<span class="string">"111111"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一般登陆只需要手机号和密码，所以我们可以新建一个登陆的实体类封装</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginVo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"手机号"</span>)</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"密码"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="controller层-1"><a href="#controller层-1" class="headerlink" title="controller层"></a>controller层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/eduucenter/member"</span>)</span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//登陆,注意是post提交</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">login</span><span class="params">(@RequestBody LoginVo loginVo)</span></span>&#123;</span><br><span class="line">        <span class="comment">//按照登陆逻辑，登陆成功后应该返回一个token</span></span><br><span class="line">        String token = memberService.login(loginVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">"token"</span>, token);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="service层"><a href="#service层" class="headerlink" title="service层"></a>service层</h4><p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">Member</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">login</span><span class="params">(LoginVo loginVo)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">MemberMapper</span>, <span class="title">Member</span>&gt; <span class="keyword">implements</span> <span class="title">MemberService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(LoginVo loginVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//先判断手机号、密码是否为空</span></span><br><span class="line">        String mobile = loginVo.getMobile();</span><br><span class="line">        String password = loginVo.getPassword();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(mobile) || StringUtils.isEmpty(password))&#123;</span><br><span class="line">            <span class="comment">//如果为空则抛出异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">"手机号或者密码不能为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果不为空，则判断是否与数据库中的数据相符</span></span><br><span class="line">        <span class="comment">//先根据手机号查询数据库</span></span><br><span class="line">        QueryWrapper&lt;Member&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">"mobile"</span>, mobile);</span><br><span class="line">        Member mobileMember = baseMapper.selectOne(wrapper);</span><br><span class="line">        <span class="comment">//再判断</span></span><br><span class="line">        <span class="keyword">if</span>(mobileMember == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>,<span class="string">"该用户不存在，请重新输入或者注册用户"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//注意明文密码都是通过md5加密过的</span></span><br><span class="line">        <span class="keyword">if</span>(!MD5.encrypt(password).equals(mobileMember.getPassword()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>,<span class="string">"密码错误，请重新输入"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//手机号和密码都没问题的话还要看用户是否被禁用状态</span></span><br><span class="line">        <span class="keyword">if</span>(mobileMember.getIsDisabled())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>,<span class="string">"该用户已经被禁用"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//都没问题的话，则返回token，注意是通过id和昵称生成token</span></span><br><span class="line">        String jwtToken = JwtUtils.getJwtToken(mobileMember.getId(), mobileMember.getNickname());</span><br><span class="line">        <span class="keyword">return</span> jwtToken;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="swagger测试-1"><a href="#swagger测试-1" class="headerlink" title="swagger测试"></a>swagger测试</h4><p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711121551.png" alt="image-20200711121551235"></p>
<p>测试成功</p>
<h2 id="5、注册功能"><a href="#5、注册功能" class="headerlink" title="5、注册功能"></a>5、注册功能</h2><p>因为注册主要时通过昵称、手机号、密码、验证码（阿里云短信服务）注册，Member实体类没有验证码不适合作为注册实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterVo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"昵称"</span>)</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"手机号"</span>)</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"密码"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"验证码"</span>)</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller层-2"><a href="#controller层-2" class="headerlink" title="controller层"></a>controller层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册功能</span></span><br><span class="line"><span class="comment">//因为注册主要时通过昵称、手机号、密码、验证码（阿里云短信服务）注册，Member实体类没有验证码不适合作为注册实体类</span></span><br><span class="line"><span class="comment">//所以需要新建一个实体类封装</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/register"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">register</span><span class="params">(@RequestBody RegisterVo registerVo)</span></span>&#123;</span><br><span class="line">    memberService.register(registerVo);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="service层-1"><a href="#service层-1" class="headerlink" title="service层"></a>service层</h3><p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">register</span><span class="params">(RegisterVo registerVo)</span></span>;</span><br></pre></td></tr></table></figure>

<p>实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(RegisterVo registerVo)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//首先获取用户提交的数据</span></span><br><span class="line">    String nickname = registerVo.getNickname();</span><br><span class="line">    String mobile = registerVo.getMobile();</span><br><span class="line">    String password = registerVo.getPassword();</span><br><span class="line">    String code = registerVo.getCode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断非空</span></span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isEmpty(nickname) || StringUtils.isEmpty(mobile) || StringUtils.isEmpty(password) || StringUtils.isEmpty(code) )&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">"用户名/手机号码/密码/验证码不能为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断验证码</span></span><br><span class="line">    <span class="keyword">if</span>(!code.equals(redisTemplate.opsForValue().get(mobile)))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">"验证码不正确"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//还要判断手机号是否重复</span></span><br><span class="line">    QueryWrapper&lt;Member&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">"mobile"</span>, mobile);</span><br><span class="line">    Integer count = baseMapper.selectCount(wrapper);</span><br><span class="line">    <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">"该手机号已被注册，请登陆或者重新注册"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将用户信息存入数据库,注意密码需要先加密</span></span><br><span class="line">    Member member = <span class="keyword">new</span> Member();</span><br><span class="line">    member.setNickname(nickname);</span><br><span class="line">    member.setMobile(mobile);</span><br><span class="line">    member.setIsDisabled(<span class="keyword">false</span>);<span class="comment">//不被禁用</span></span><br><span class="line">    member.setAvatar(<span class="string">"https://ryan-guli-01.oss-cn-shenzhen.aliyuncs.com/2020/07/03/1c79228eee714773a65025d60e597321yiquan.jpg"</span>);<span class="comment">//默认头像</span></span><br><span class="line">    member.setPassword(MD5.encrypt(password));</span><br><span class="line">    baseMapper.insert(member);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="swagger测试-2"><a href="#swagger测试-2" class="headerlink" title="swagger测试"></a>swagger测试</h3><p>提示：因为注册需要使用验证码，所以测试注册功能前，应该先获取验证码，也就是先打开8005模块的swagger获取验证码，而获取验证码前别忘了打开远程的redis服务，打开redis服务又别忘了是通过自己的配置文件打开</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711130616.png" alt="image-20200711130616674"></p>
<p>查看数据库</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711130644.png" alt="image-20200711130644377"></p>
<p>测试成功</p>
<h2 id="6、根据token获取用户信息"><a href="#6、根据token获取用户信息" class="headerlink" title="6、根据token获取用户信息"></a>6、根据token获取用户信息</h2><p>提示：用户登陆成功后，前台页面一般是显示用户的头像，昵称，这样我们就要获取到用户的信息，怎么获取呢，可以通过token去获取</p>
<h3 id="controller层-3"><a href="#controller层-3" class="headerlink" title="controller层"></a>controller层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过token获取用户信息</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/getMemberInfo"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getMemberInfo</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    <span class="comment">//获取用户id</span></span><br><span class="line">    String memberId = JwtUtils.getMemberIdByJwtToken(request);</span><br><span class="line">    <span class="comment">//通过id查询用户信息</span></span><br><span class="line">    Member memberInfo = memberService.getById(memberId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">"memberInfo"</span>,memberInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7、整合前台注册页面"><a href="#7、整合前台注册页面" class="headerlink" title="7、整合前台注册页面"></a>7、整合前台注册页面</h2><p>开发接口前记得先安装好element-ui，以及提前准备好后面需要使用的qriously</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install element-ui</span><br><span class="line">npm install vue-qriously</span><br></pre></td></tr></table></figure>

<p>安装好之后在插件中引入</p>
<p>nuxt-swiper-plugins.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueAwesomeSwiper <span class="keyword">from</span> <span class="string">'vue-awesome-swiper/dist/ssr'</span></span><br><span class="line"><span class="keyword">import</span> VueQriously <span class="keyword">from</span> <span class="string">'vue-qriously'</span></span><br><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">'element-ui'</span> <span class="comment">//element-ui的全部组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-chalk/index.css'</span><span class="comment">//element-ui的css</span></span><br><span class="line">Vue.use(ElementUI) <span class="comment">//使用elementUI</span></span><br><span class="line">Vue.use(VueQriously)</span><br><span class="line">Vue.use(VueAwesomeSwiper)</span><br></pre></td></tr></table></figure>

<h3 id="layouts"><a href="#layouts" class="headerlink" title="layouts"></a>layouts</h3><p>登陆的布局sign.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;sign&quot;&gt;</span><br><span class="line">    &lt;!--标题--&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;logo&quot;&gt;</span><br><span class="line">      &lt;img src&#x3D;&quot;~&#x2F;assets&#x2F;img&#x2F;logo.png&quot; alt&#x3D;&quot;logo&quot;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;!--表单--&gt;</span><br><span class="line">    &lt;nuxt&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure>

<p>登陆注册的按钮在default页面中的，找到按钮响应跳转页面</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711161156.png" alt="image-20200711161156688"></p>
<p>在pages目录下新建login.vue和register.vue两个静态页面先，效果如下，具体功能个代码等会在补充完善</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711164032.png" alt="image-20200711164032164"></p>
<h3 id="Api"><a href="#Api" class="headerlink" title="Api"></a>Api</h3><p>registerApi.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request.js"</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//获取验证码</span></span><br><span class="line">    getCode(phone)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            url: <span class="string">`/edumsm/msm/sendMsm/<span class="subst">$&#123;phone&#125;</span>`</span>,</span><br><span class="line">            method: <span class="string">'post'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//注册</span></span><br><span class="line">    register(registerVo)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            url: <span class="string">`/eduucenter/member/register`</span>,</span><br><span class="line">            method: <span class="string">'post'</span>,</span><br><span class="line">            data: registerVo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="pages"><a href="#pages" class="headerlink" title="pages"></a>pages</h3><p>register.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;main&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;title&quot;&gt;</span><br><span class="line">      &lt;a href&#x3D;&quot;&#x2F;login&quot;&gt;登录&lt;&#x2F;a&gt;</span><br><span class="line">      &lt;span&gt;·&lt;&#x2F;span&gt;</span><br><span class="line">      &lt;a class&#x3D;&quot;active&quot; href&#x3D;&quot;&#x2F;register&quot;&gt;注册&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class&#x3D;&quot;sign-up-container&quot;&gt;</span><br><span class="line">      &lt;el-form ref&#x3D;&quot;userForm&quot; :model&#x3D;&quot;params&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item class&#x3D;&quot;input-prepend restyle&quot; prop&#x3D;&quot;nickname&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入你的昵称&#39;, trigger: &#39;blur&#39; &#125;]&quot;&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;你的昵称&quot; v-model&#x3D;&quot;params.nickname&quot;&#x2F;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;iconfont icon-user&quot;&#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item class&#x3D;&quot;input-prepend restyle no-radius&quot; prop&#x3D;&quot;mobile&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入手机号码&#39;, trigger: &#39;blur&#39; &#125;,&#123;validator: checkPhone, trigger: &#39;blur&#39;&#125;]&quot;&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;手机号&quot; v-model&#x3D;&quot;params.mobile&quot;&#x2F;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;iconfont icon-phone&quot;&#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item class&#x3D;&quot;input-prepend restyle no-radius&quot; prop&#x3D;&quot;code&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入验证码&#39;, trigger: &#39;blur&#39; &#125;]&quot;&gt;</span><br><span class="line">          &lt;div style&#x3D;&quot;width: 100%;display: block;float: left;position: relative&quot;&gt;</span><br><span class="line">            &lt;el-input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;验证码&quot; v-model&#x3D;&quot;params.code&quot;&#x2F;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;iconfont icon-phone&quot;&#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;btn&quot; style&#x3D;&quot;position:absolute;right: 0;top: 6px;width: 40%;&quot;&gt;</span><br><span class="line">            &lt;a href&#x3D;&quot;javascript:&quot; type&#x3D;&quot;button&quot; @click&#x3D;&quot;getCodeFun()&quot; :value&#x3D;&quot;codeTest&quot; style&#x3D;&quot;border: none;background-color: none&quot;&gt;&#123;&#123;codeTest&#125;&#125;&lt;&#x2F;a&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item class&#x3D;&quot;input-prepend&quot; prop&#x3D;&quot;password&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入密码&#39;, trigger: &#39;blur&#39; &#125;]&quot;&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;设置密码&quot; v-model&#x3D;&quot;params.password&quot;&#x2F;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;iconfont icon-password&quot;&#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class&#x3D;&quot;btn&quot;&gt;</span><br><span class="line">          &lt;input type&#x3D;&quot;button&quot; class&#x3D;&quot;sign-up-button&quot; value&#x3D;&quot;注册&quot; @click&#x3D;&quot;submitRegister()&quot;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;p class&#x3D;&quot;sign-up-msg&quot;&gt;</span><br><span class="line">          点击 “注册” 即表示您同意并愿意遵守简书</span><br><span class="line">          &lt;br&gt;</span><br><span class="line">          &lt;a target&#x3D;&quot;_blank&quot; href&#x3D;&quot;http:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;c44d171298ce&quot;&gt;用户协议&lt;&#x2F;a&gt;</span><br><span class="line">          和</span><br><span class="line">          &lt;a target&#x3D;&quot;_blank&quot; href&#x3D;&quot;http:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;2ov8x3&quot;&gt;隐私政策&lt;&#x2F;a&gt; 。</span><br><span class="line">        &lt;&#x2F;p&gt;</span><br><span class="line">      &lt;&#x2F;el-form&gt;</span><br><span class="line">      &lt;!-- 更多注册方式 --&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;more-sign&quot;&gt;</span><br><span class="line">        &lt;h6&gt;社交帐号直接注册&lt;&#x2F;h6&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;&lt;a id&#x3D;&quot;weixin&quot; class&#x3D;&quot;weixin&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;http:&#x2F;&#x2F;huaan.free.idcfengye.com&#x2F;api&#x2F;ucenter&#x2F;wx&#x2F;login&quot;&gt;&lt;i</span><br><span class="line">            class&#x3D;&quot;iconfont icon-weixin&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">          &lt;li&gt;&lt;a id&#x3D;&quot;qq&quot; class&#x3D;&quot;qq&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;#&quot;&gt;&lt;i class&#x3D;&quot;iconfont icon-qq&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import &#39;~&#x2F;assets&#x2F;css&#x2F;sign.css&#39;</span><br><span class="line">  import &#39;~&#x2F;assets&#x2F;css&#x2F;iconfont.css&#39;</span><br><span class="line">  import registerApi from &quot;@&#x2F;api&#x2F;registerApi&quot;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    layout: &#39;sign&#39;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        params: &#123; &#x2F;&#x2F;封装注册输入数据</span><br><span class="line">          mobile: &#39;&#39;,</span><br><span class="line">          code: &#39;&#39;,  &#x2F;&#x2F;验证码</span><br><span class="line">          nickname: &#39;&#39;,</span><br><span class="line">          password: &#39;&#39;</span><br><span class="line">        &#125;,</span><br><span class="line">        sending: true,      &#x2F;&#x2F;是否发送验证码</span><br><span class="line">        second: 60,        &#x2F;&#x2F;倒计时间</span><br><span class="line">        codeTest: &#39;获取验证码&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      &#x2F;&#x2F;注册</span><br><span class="line">      submitRegister()&#123;</span><br><span class="line">        registerApi.register(this.params)</span><br><span class="line">          .then(response &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;提示注册成功</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">                type: &#39;success&#39;,</span><br><span class="line">                message: &#39;注册成功!&#39;</span><br><span class="line">            &#125;)</span><br><span class="line">            &#x2F;&#x2F;跳转到登陆页面</span><br><span class="line">            this.$router.push(&#123;path: &#39;&#x2F;login&#39;&#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F;获取验证码</span><br><span class="line">      getCodeFun()&#123;</span><br><span class="line">        registerApi.getCode(this.params.mobile)</span><br><span class="line">          .then(response &#x3D;&gt; &#123;</span><br><span class="line">            this.sending &#x3D; false</span><br><span class="line">            &#x2F;&#x2F;获取验证码成功后，使用定时器，开始倒计时</span><br><span class="line">            this.timeDown()</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F;发送验证码后倒计时</span><br><span class="line">      timeDown() &#123;</span><br><span class="line">        let result &#x3D; setInterval(() &#x3D;&gt; &#123;</span><br><span class="line">          --this.second;</span><br><span class="line">          this.codeTest &#x3D; this.second + &#39; 重新发送&#39;</span><br><span class="line">          if (this.second &lt; 1) &#123;</span><br><span class="line">            clearInterval(result);</span><br><span class="line">            this.sending &#x3D; true;</span><br><span class="line">            &#x2F;&#x2F;this.disabled &#x3D; false;</span><br><span class="line">            this.second &#x3D; 60;</span><br><span class="line">            this.codeTest &#x3D; &quot;获取验证码&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F;验证手机号格式</span><br><span class="line">      checkPhone (rule, value, callback) &#123;</span><br><span class="line">        &#x2F;&#x2F;debugger</span><br><span class="line">        if (!(&#x2F;^1[34578]\d&#123;9&#125;$&#x2F;.test(value))) &#123;</span><br><span class="line">          return callback(new Error(&#39;手机号码格式不正确&#39;))</span><br><span class="line">        &#125;</span><br><span class="line">        return callback()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="8、前端整合登陆页面"><a href="#8、前端整合登陆页面" class="headerlink" title="8、前端整合登陆页面"></a>8、前端整合登陆页面</h2><p>相对于注册功能，登陆功能会复杂一些</p>
<p>第一：登陆成功后，获取到返回的token</p>
<p>第二：将返回的token放到cookie中去</p>
<p>第三：创建拦截器，在每一次请求中判断cookie中是否有token，有的话就将token放到header中去</p>
<p>第四：根据token获取用户信息，目的是为了后面的用户信息现实</p>
<p>第五：登陆成功后的用户信息显示</p>
<p>具体流程如下图：</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711174518.png" alt="image-20200711174518038"></p>
<h3 id="安装cookie依赖"><a href="#安装cookie依赖" class="headerlink" title="安装cookie依赖"></a>安装cookie依赖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install js-cookie --save</span><br></pre></td></tr></table></figure>

<p>别忘了在需要使用使用cookie的页面导入一下这个依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import cookie from 'js-cookie'</span><br></pre></td></tr></table></figure>

<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><p>request.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> cookie <span class="keyword">from</span> <span class="string">'js-cookie'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">'http://localhost:9001'</span>, <span class="comment">// api的base_url</span></span><br><span class="line">  timeout: <span class="number">20000</span> <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//拦截器</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">    config =&gt; &#123;</span><br><span class="line">    <span class="comment">//debugger</span></span><br><span class="line">    <span class="keyword">if</span> (cookie.get(<span class="string">'guli_token'</span>)) &#123;</span><br><span class="line">      config.headers[<span class="string">'token'</span>] = cookie.get(<span class="string">'guli_token'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure>

<h3 id="api"><a href="#api" class="headerlink" title="api"></a>api</h3><p>loginApi.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request.js"</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//登陆</span></span><br><span class="line">    login(loginVo)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            url: <span class="string">`/eduucenter/member/login`</span>,</span><br><span class="line">            method: <span class="string">'post'</span>,</span><br><span class="line">            data: loginVo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//通过token获取用户信息,request不需要传</span></span><br><span class="line">    getUserInfo()&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            url: <span class="string">`/eduucenter/member/getUserInfo`</span>,</span><br><span class="line">            method: <span class="string">'get'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="pages-1"><a href="#pages-1" class="headerlink" title="pages"></a>pages</h3><p>login.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;main&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;title&quot;&gt;</span><br><span class="line">      &lt;a class&#x3D;&quot;active&quot; href&#x3D;&quot;&#x2F;login&quot;&gt;登录&lt;&#x2F;a&gt;</span><br><span class="line">      &lt;span&gt;·&lt;&#x2F;span&gt;</span><br><span class="line">      &lt;a href&#x3D;&quot;&#x2F;register&quot;&gt;注册&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class&#x3D;&quot;sign-up-container&quot;&gt;</span><br><span class="line">      &lt;el-form ref&#x3D;&quot;userForm&quot; :model&#x3D;&quot;user&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item class&#x3D;&quot;input-prepend restyle&quot; prop&#x3D;&quot;mobile&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入手机号码&#39;, trigger: &#39;blur&#39; &#125;,&#123;validator: checkPhone, trigger: &#39;blur&#39;&#125;]&quot;&gt;</span><br><span class="line">          &lt;div &gt;</span><br><span class="line">            &lt;el-input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;手机号&quot; v-model&#x3D;&quot;user.mobile&quot;&#x2F;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;iconfont icon-phone&quot; &#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item class&#x3D;&quot;input-prepend&quot; prop&#x3D;&quot;password&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入密码&#39;, trigger: &#39;blur&#39; &#125;]&quot;&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;密码&quot; v-model&#x3D;&quot;user.password&quot;&#x2F;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;iconfont icon-password&quot;&#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class&#x3D;&quot;btn&quot;&gt;</span><br><span class="line">          &lt;input type&#x3D;&quot;button&quot; class&#x3D;&quot;sign-in-button&quot; value&#x3D;&quot;登录&quot; @click&#x3D;&quot;submitLogin()&quot;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;el-form&gt;</span><br><span class="line">      &lt;!-- 更多登录方式 --&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;more-sign&quot;&gt;</span><br><span class="line">        &lt;h6&gt;社交帐号登录&lt;&#x2F;h6&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;&lt;a id&#x3D;&quot;weixin&quot; class&#x3D;&quot;weixin&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;http:&#x2F;&#x2F;qy.free.idcfengye.com&#x2F;api&#x2F;ucenter&#x2F;weixinLogin&#x2F;login&quot;&gt;&lt;i class&#x3D;&quot;iconfont icon-weixin&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">          &lt;li&gt;&lt;a id&#x3D;&quot;qq&quot; class&#x3D;&quot;qq&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;#&quot;&gt;&lt;i class&#x3D;&quot;iconfont icon-qq&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import &#39;~&#x2F;assets&#x2F;css&#x2F;sign.css&#39;</span><br><span class="line">  import &#39;~&#x2F;assets&#x2F;css&#x2F;iconfont.css&#39;</span><br><span class="line">  import loginApi from &quot;@&#x2F;api&#x2F;loginApi&quot;</span><br><span class="line">  import cookie from &#39;js-cookie&#39;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    layout: &#39;sign&#39;,</span><br><span class="line"></span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        user:&#123;</span><br><span class="line">          mobile:&#39;&#39;,</span><br><span class="line">          password:&#39;&#39;</span><br><span class="line">        &#125;,</span><br><span class="line">        loginInfo:&#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line">      &#x2F;&#x2F;登陆</span><br><span class="line">      submitLogin()&#123;</span><br><span class="line">        &#x2F;&#x2F;第一步：调用登陆接口进行登陆</span><br><span class="line">        loginApi.login(this.user)</span><br><span class="line">          .then(response &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;第二步：获取token</span><br><span class="line">            &#x2F;&#x2F;第三步：将token放到cookie中</span><br><span class="line">            &#x2F;&#x2F;参数1：cookie名称，参数2：cookie值，参数3：作用域</span><br><span class="line">            cookie.set(&quot;guli_token&quot;, response.data.data.token, &#123;domain: &#39;localhost&#39;&#125;)</span><br><span class="line">            &#x2F;&#x2F;第四步：通过token获取用户信息</span><br><span class="line">            loginApi.getUserInfo()</span><br><span class="line">              .then(response &#x3D;&gt; &#123;</span><br><span class="line">                this.loginInfo &#x3D; response.data.data.userInfo</span><br><span class="line">                cookie.set(&quot;guli_ucenter&quot;, this.loginInfo, &#123;domain: &#39;localhost&#39;&#125;)</span><br><span class="line">                &#x2F;&#x2F;提示注册成功</span><br><span class="line">                this.$message(&#123;</span><br><span class="line">                    type: &#39;success&#39;,</span><br><span class="line">                    message: &#39;登陆成功!&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">                &#x2F;&#x2F;跳转到登陆页面</span><br><span class="line">                this.$router.push(&#123;path: &#39;&#x2F;&#39;&#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      checkPhone (rule, value, callback) &#123;</span><br><span class="line">        &#x2F;&#x2F;debugger</span><br><span class="line">        if (!(&#x2F;^1[34578]\d&#123;9&#125;$&#x2F;.test(value))) &#123;</span><br><span class="line">          return callback(new Error(&#39;手机号码格式不正确&#39;))</span><br><span class="line">        &#125;</span><br><span class="line">        return callback()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">   .el-form-item__error&#123;</span><br><span class="line">    z-index: 9999999;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="layouts-1"><a href="#layouts-1" class="headerlink" title="layouts"></a>layouts</h3><p>default.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"in-wrap"</span>&gt;</span><br><span class="line">    &lt;!-- 公共头引入 --&gt;</span><br><span class="line">    &lt;header id=<span class="string">"header"</span>&gt;</span><br><span class="line">      &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">"logo"</span>&gt;</span><br><span class="line">          &lt;a href=<span class="string">"#"</span> title=<span class="string">"谷粒学院"</span>&gt;</span><br><span class="line">            &lt;img src=<span class="string">"~/assets/img/logo.png"</span> width=<span class="string">"100%"</span> alt=<span class="string">"谷粒学院"</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>h1&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"h-r-nsl"</span>&gt;</span><br><span class="line">          &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"nav"</span>&gt;</span><br><span class="line">            &lt;router-link to=<span class="string">"/"</span> tag=<span class="string">"li"</span> active-<span class="class"><span class="keyword">class</span></span>=<span class="string">"current"</span> exact&gt;</span><br><span class="line">              &lt;a&gt;首页&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>router-link&gt;</span><br><span class="line">            &lt;router-link to=<span class="string">"/course"</span> tag=<span class="string">"li"</span> active-<span class="class"><span class="keyword">class</span></span>=<span class="string">"current"</span>&gt;</span><br><span class="line">              &lt;a&gt;课程&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>router-link&gt;</span><br><span class="line">            &lt;router-link to=<span class="string">"/teacher"</span> tag=<span class="string">"li"</span> active-<span class="class"><span class="keyword">class</span></span>=<span class="string">"current"</span>&gt;</span><br><span class="line">              &lt;a&gt;名师&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>router-link&gt;</span><br><span class="line">            &lt;router-link to=<span class="string">"/article"</span> tag=<span class="string">"li"</span> active-<span class="class"><span class="keyword">class</span></span>=<span class="string">"current"</span>&gt;</span><br><span class="line">              &lt;a&gt;文章&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>router-link&gt;</span><br><span class="line">            &lt;router-link to=<span class="string">"/qa"</span> tag=<span class="string">"li"</span> active-<span class="class"><span class="keyword">class</span></span>=<span class="string">"current"</span>&gt;</span><br><span class="line">              &lt;a&gt;问答&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>router-link&gt;</span><br><span class="line">          &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">          &lt;!-- /</span> nav --&gt;</span><br><span class="line">          &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"h-r-login"</span>&gt;</span><br><span class="line">            &lt;li v-<span class="keyword">if</span>=<span class="string">"!loginInfo.id"</span> id=<span class="string">"no-login"</span>&gt;</span><br><span class="line">                &lt;a href=<span class="string">"/login"</span> title=<span class="string">"登录"</span>&gt;</span><br><span class="line">                    &lt;em <span class="class"><span class="keyword">class</span></span>=<span class="string">"icon18 login-icon"</span>&gt;&amp;nbsp;&lt;<span class="regexp">/em&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;span class="vam ml5"&gt;登录&lt;/</span>span&gt;</span><br><span class="line">                &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">                |</span></span><br><span class="line"><span class="regexp">                &lt;a href="/</span>register<span class="string">" title="</span>注册<span class="string">"&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="</span>vam ml5<span class="string">"&gt;注册&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li v-if="</span>loginInfo.id<span class="string">" id="</span>is-login-one<span class="string">" class="</span>mr10<span class="string">"&gt;</span></span><br><span class="line">                &lt;a id="headerMsgCountId" href="#" title="消息"&gt;</span><br><span class="line">                    &lt;em <span class="class"><span class="keyword">class</span></span>=<span class="string">"icon18 news-icon"</span>&gt;&amp;nbsp;&lt;<span class="regexp">/em&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>a&gt;</span><br><span class="line">                &lt;q <span class="class"><span class="keyword">class</span></span>=<span class="string">"red-point"</span> style=<span class="string">"display: none"</span>&gt;&amp;nbsp;&lt;<span class="regexp">/q&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">            &lt;li v-<span class="keyword">if</span>=<span class="string">"loginInfo.id"</span> id=<span class="string">"is-login-two"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"h-r-user"</span>&gt;</span><br><span class="line">                &lt;a href=<span class="string">"/ucenter"</span> title&gt;</span><br><span class="line">                    &lt;img</span><br><span class="line">                        :src=<span class="string">"loginInfo.avatar"</span></span><br><span class="line">                        width=<span class="string">"30"</span></span><br><span class="line">                        height=<span class="string">"30"</span></span><br><span class="line">                        <span class="class"><span class="keyword">class</span></span>=<span class="string">"vam picImg"</span></span><br><span class="line">                        alt</span><br><span class="line">                        &gt;</span><br><span class="line">                    &lt;span id=<span class="string">"userName"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"vam disIb"</span>&gt;&#123;&#123; loginInfo.nickname &#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>a&gt;</span><br><span class="line">                &lt;a href=<span class="string">"javascript:void(0);"</span> title=<span class="string">"退出"</span> @click=<span class="string">"logout()"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"ml5"</span>&gt;退出&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">            &lt;!-- <span class="regexp">/未登录显示第1 li；登录后显示第2，3 li --&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/u</span>l&gt;</span><br><span class="line">          &lt;aside <span class="class"><span class="keyword">class</span></span>=<span class="string">"h-r-search"</span>&gt;</span><br><span class="line">            &lt;form action=<span class="string">"#"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">              &lt;label <span class="class"><span class="keyword">class</span></span>=<span class="string">"h-r-s-box"</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"text"</span> placeholder=<span class="string">"输入你想学的课程"</span> name=<span class="string">"queryCourse.courseName"</span> value&gt;</span><br><span class="line">                &lt;button type=<span class="string">"submit"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"s-btn"</span>&gt;</span><br><span class="line">                  &lt;em <span class="class"><span class="keyword">class</span></span>=<span class="string">"icon18"</span>&gt;&amp;nbsp;&lt;<span class="regexp">/em&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>button&gt;</span><br><span class="line">              &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>form&gt;</span><br><span class="line">          &lt;<span class="regexp">/aside&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &lt;aside <span class="class"><span class="keyword">class</span></span>=<span class="string">"mw-nav-btn"</span>&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"mw-nav-icon"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>aside&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"clear"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>section&gt;</span><br><span class="line">    &lt;<span class="regexp">/header&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- /</span>公共头引入 --&gt;</span><br><span class="line">      </span><br><span class="line">    &lt;nuxt/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 公共底引入 --&gt;</span><br><span class="line">    &lt;footer id=<span class="string">"footer"</span>&gt;</span><br><span class="line">      &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">h4</span> <span class="title">class</span></span>=<span class="string">"hLh30"</span>&gt;</span><br><span class="line">            &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"fsize18 f-fM c-999"</span>&gt;友情链接&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>h4&gt;</span><br><span class="line">          &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"of flink-list"</span>&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;a href=<span class="string">"http://www.atguigu.com/"</span> title=<span class="string">"尚硅谷"</span> target=<span class="string">"_blank"</span>&gt;尚硅谷&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">          &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div class="clear"&gt;&lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div class="b-foot"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;section class="fl col-7"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;section class="mr20"&gt;</span></span><br><span class="line"><span class="regexp">              &lt;section class="b-f-link"&gt;</span></span><br><span class="line"><span class="regexp">                &lt;a href="#" title="关于我们" target="_blank"&gt;关于我们&lt;/</span>a&gt;|</span><br><span class="line">                &lt;a href=<span class="string">"#"</span> title=<span class="string">"联系我们"</span> target=<span class="string">"_blank"</span>&gt;联系我们&lt;<span class="regexp">/a&gt;|</span></span><br><span class="line"><span class="regexp">                &lt;a href="#" title="帮助中心" target="_blank"&gt;帮助中心&lt;/</span>a&gt;|</span><br><span class="line">                &lt;a href=<span class="string">"#"</span> title=<span class="string">"资源下载"</span> target=<span class="string">"_blank"</span>&gt;资源下载&lt;<span class="regexp">/a&gt;|</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;服务热线：010-56253825(北京) 0755-85293825(深圳)&lt;/</span>span&gt;</span><br><span class="line">                &lt;span&gt;Email：info@atguigu.com&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>section&gt;</span><br><span class="line">              &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"b-f-link mt10"</span>&gt;</span><br><span class="line">                &lt;span&gt;©<span class="number">2018</span>课程版权均归谷粒学院所有 京ICP备<span class="number">17055252</span>号&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>section&gt;</span><br><span class="line">            &lt;<span class="regexp">/section&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>section&gt;</span><br><span class="line">          &lt;aside <span class="class"><span class="keyword">class</span></span>=<span class="string">"fl col-3 tac mt15"</span>&gt;</span><br><span class="line">            &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"gf-tx"</span>&gt;</span><br><span class="line">              &lt;span&gt;</span><br><span class="line">                &lt;img src=<span class="string">"~/assets/img/wx-icon.png"</span> alt&gt;</span><br><span class="line">              &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>section&gt;</span><br><span class="line">            &lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"gf-tx"</span>&gt;</span><br><span class="line">              &lt;span&gt;</span><br><span class="line">                &lt;img src=<span class="string">"~/assets/img/wb-icon.png"</span> alt&gt;</span><br><span class="line">              &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>section&gt;</span><br><span class="line">          &lt;<span class="regexp">/aside&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div class="clear"&gt;&lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>section&gt;</span><br><span class="line">    &lt;<span class="regexp">/footer&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- /</span>公共底引入 --&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"~/assets/css/reset.css"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"~/assets/css/theme.css"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"~/assets/css/global.css"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"~/assets/css/web.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cookie <span class="keyword">from</span> <span class="string">'js-cookie'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  data()&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      token: <span class="string">''</span>,</span><br><span class="line">      loginInfo: &#123;</span><br><span class="line">        id: <span class="string">''</span>,</span><br><span class="line">        age: <span class="string">''</span>,</span><br><span class="line">        avatar: <span class="string">''</span>,</span><br><span class="line">        mobile: <span class="string">''</span>,</span><br><span class="line">        nickname: <span class="string">''</span>,</span><br><span class="line">        sex: <span class="string">''</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created()&#123;</span><br><span class="line">    <span class="keyword">this</span>.showInfo()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">//从cookie中获取用户信息，并赋值</span></span><br><span class="line">    showInfo()&#123;</span><br><span class="line">      <span class="keyword">var</span> userStr = cookie.get(<span class="string">'guli_ucenter'</span>)</span><br><span class="line">      <span class="comment">//注意这里获取到的是字符串形式的json数据，我们需要将其转换为json数据</span></span><br><span class="line">      <span class="keyword">if</span>(userStr)&#123;</span><br><span class="line">        <span class="keyword">this</span>.loginInfo = <span class="built_in">JSON</span>.parse(userStr)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="效果测试"><a href="#效果测试" class="headerlink" title="效果测试"></a>效果测试</h3><p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711213121.png" alt="image-20200711213121318"></p>
<h3 id="退出账号"><a href="#退出账号" class="headerlink" title="退出账号"></a>退出账号</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//点击退出登录</span></span><br><span class="line">logout()&#123;</span><br><span class="line">    <span class="comment">//将cookie中的相关信息清除即可，注意cookie没有直接清楚的方法，可重设为空</span></span><br><span class="line">    cookie.set(<span class="string">'guli_token'</span>, <span class="string">''</span>,&#123;<span class="attr">domain</span>:<span class="string">"localhost"</span>&#125;)</span><br><span class="line">        cookie.set(<span class="string">'guli_ucenter'</span>, <span class="string">''</span>,&#123;<span class="attr">domain</span>:<span class="string">"localhost"</span>&#125;)</span><br><span class="line">        <span class="comment">//然后回到首页</span></span><br><span class="line">        <span class="comment">//this.$router.push(&#123;path: '/'&#125;)</span></span><br><span class="line">        <span class="comment">//跳转页面其实也可以这样写，使用js代码，这里建议使用，具体你可以看看a连接的href</span></span><br><span class="line">        <span class="built_in">window</span>.location.href = <span class="string">"/"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9、OAuth2"><a href="#9、OAuth2" class="headerlink" title="9、OAuth2"></a>9、OAuth2</h2><p>背景：</p>
<p>照片拥有者想要在云冲印服务上打印照片，云冲印服务需要访问云存储服务上的资源</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222004.jpg" alt="img"></p>
<p>针对这个问题，大家主要提供了以下几种方案：</p>
<p>方式一：用户名密码复制</p>
<p>适用于同一公司内部的多个系统，不适用于不受信的第三方应用</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222119.jpg" alt="img"></p>
<p>方式二：通用开发者key</p>
<p>适用于合作商或者授信的不同业务部门之间</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222139.jpg" alt="img"></p>
<p>方式三：办法令牌</p>
<p>接近OAuth2方式，需要考虑如何管理令牌、颁发令牌、吊销令牌，需要统一的协议，因此就有了OAuth2协议</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222209.jpg" alt="img"></p>
<p>针对此类问题，于是产生了OAuth2</p>
<p>正式定义</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222427.jpg" alt="img"></p>
<p>OAuth2的核心</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222526.jpg" alt="img"></p>
<p>OAuth2涉及的角色</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222612.jpg" alt="img"></p>
<p>OAuth2术语</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222635.png" alt="img"></p>
<p>OAuth2的令牌类型</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222659.jpg" alt="img"></p>
<p>OAuth2的误解</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222713.jpg" alt="img"></p>
<p>总结</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711222829.jpg" alt="img"></p>
<h2 id="10、后端微信扫码登陆"><a href="#10、后端微信扫码登陆" class="headerlink" title="10、后端微信扫码登陆"></a>10、后端微信扫码登陆</h2><p>首先使用该功能需要到微信开放平台注册和认证开发者资质，但是目前只对企业开放，暂时没有对个人开放</p>
<p>开发文档参考：<a href="https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html</a></p>
<p>这里使用尚硅谷老师提供的相关资料（请往下看）</p>
<p>熟悉微信登陆的流程</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711223418.png" alt="img"></p>
<p>因为还是登陆模块，所以还是在ucenter这个模块中开发</p>
<h3 id="配置yml文件"><a href="#配置yml文件" class="headerlink" title="配置yml文件"></a>配置yml文件</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wx:</span></span><br><span class="line">  <span class="attr">open:</span></span><br><span class="line">    <span class="comment"># 微信开放平台 appid</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">wxed9954c01bb89b47</span></span><br><span class="line">    <span class="comment"># 微信开放平台 appsecret</span></span><br><span class="line">    <span class="attr">appsecret:</span> <span class="string">a7482517235173ddb4083788de60b90e</span></span><br><span class="line">    <span class="comment"># 微信开放平台 重定向url（guli.shop需要在微信开放平台配置）</span></span><br><span class="line">    <span class="attr">redirecturl:</span> <span class="string">http://guli.shop/api/ucenter/wx/callback</span></span><br></pre></td></tr></table></figure>

<h3 id="创建常量类工具"><a href="#创建常量类工具" class="headerlink" title="创建常量类工具"></a>创建常量类工具</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstantWxUtil</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;wx.open.appid&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String appid;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;wx.open.appsecret&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String appsecret;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;wx.open.redirecturl&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String redirecturl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String APP_ID;</span><br><span class="line">    <span class="keyword">private</span> String APP_SECRET;</span><br><span class="line">    <span class="keyword">private</span> String REDIRECT_URL;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        APP_ID = appid;</span><br><span class="line">        APP_SECRET = appsecret;</span><br><span class="line">        REDIRECT_URL = redirecturl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller层-4"><a href="#controller层-4" class="headerlink" title="controller层"></a>controller层</h3><p>提示：新建一个WxApiController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span><span class="comment">//注意这里是为了请求地址，不需要返回数据，所以需要使用@Controller注解，而不是ResController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/eduucenter/wx"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxApiController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注意这里是为了请求地址，生成微信扫描登陆的二维码，所以返回值应该是String</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQrCode</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//微信开放平台授权bashUrl,连接是固定的，%s相当于sql语句中？占位符，其他的都是固定值，详细可以参考开发文档</span></span><br><span class="line">        <span class="comment">//注意下面拼接的redirect_uri二部是url</span></span><br><span class="line">        String baseUrl = <span class="string">"https://open.weixin.qq.com/connect/qrconnect"</span> +</span><br><span class="line">                <span class="string">"?appid=%s"</span> +</span><br><span class="line">                <span class="string">"&amp;redirect_uri=%s"</span> +</span><br><span class="line">                <span class="string">"&amp;response_type=code"</span> +</span><br><span class="line">                <span class="string">"&amp;scope=snsapi_login"</span> +</span><br><span class="line">                <span class="string">"&amp;state=%s"</span> +</span><br><span class="line">                <span class="string">"#wechat_redirect"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取redirectUrl</span></span><br><span class="line">        String redirectUrl = ConstantWxUtil.REDIRECT_URL;</span><br><span class="line">        <span class="comment">//对url进行utf-8编码</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redirectUrl = URLEncoder.encode(redirectUrl, <span class="string">"utf-8"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对baseUrl中的参数赋值</span></span><br><span class="line">        String url = String.format(</span><br><span class="line">                baseUrl,</span><br><span class="line">                ConstantWxUtil.APP_ID,</span><br><span class="line">                redirectUrl,</span><br><span class="line">                <span class="string">"ryan"</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重定向到请求微信地址里面</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:"</span> + url;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试生成二维码"><a href="#测试生成二维码" class="headerlink" title="测试生成二维码"></a>测试生成二维码</h3><p>在浏览器中访问localhost:8006/eduucenter/wx/login</p>
<p>则会重定向到对应的页面，并得到二维码</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200711231300.png" alt="image-20200711231300433"></p>
<p>使用微信扫描以下二维码并点击确认，便会现实扫描成功，并接着跳转到以下页面：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8150/api/ucenter/wx/callback?code=071eWAOM1O4e291liaMM1uTxOM1eWAOV&amp;state=ryan</span><br></pre></td></tr></table></figure>

<p>这是尚硅谷的提供的那个信息，我们没法改，根据上面的请求地址，我们需要将端口号和相关地址改一下</p>
<p>提示：实际开发中，应该是用不到这一步的，按照实际的域名部署即可，这里没有开通企业服务，只能跟着尚硅谷的信息走了</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8150</span></span><br><span class="line"><span class="comment"># 改完这个端口之后，别忘了更新nginx的配置</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WxApicontroller的请求地址，注意别忘了修改nginx和MemberController的关键字，对应的前端api也需要修改一下</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/ucenter/wx"</span>)</span><br><span class="line"><span class="comment">//nginx的配置</span></span><br><span class="line">location ~ /ucenter/ &#123;</span><br><span class="line">    proxy_pass http:<span class="comment">//localhost:8150;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//MemberController的请求地址，对应的前端api自己改一下</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/ucenter/member"</span>)</span><br></pre></td></tr></table></figure>

<p>从跳转的请求地址中还可以看到，调用的接口是callback，传递的参数是code和state</p>
<p>所以在controller中写一个地址callback接口，并且将以上两个参数传到此接口中，整体步骤图示如下</p>
<p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200712011450.png" alt="image-20200712011450399"></p>
<h3 id="导入相关依赖"><a href="#导入相关依赖" class="headerlink" title="导入相关依赖"></a>导入相关依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--httpclient--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--commons-io--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--gson--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="HttpClient工具类"><a href="#HttpClient工具类" class="headerlink" title="HttpClient工具类"></a>HttpClient工具类</h3><p>提示：使用httpclient可模拟发送请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wxloginservice.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.Consts;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.HttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig.Builder;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ConnectTimeoutException;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.SSLConnectionSocketFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.SSLContextBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.TrustStrategy;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.X509HostnameVerifier;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.ContentType;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLException;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSession;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocket;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketTimeoutException;</span><br><span class="line"><span class="keyword">import</span> java.security.GeneralSecurityException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.CertificateException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  依赖的jar包有：commons-lang-2.6.jar、httpclient-4.3.2.jar、httpcore-4.3.1.jar、commons-io-2.4.jar</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhaoyb</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClientUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> connTimeout=<span class="number">10000</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> readTimeout=<span class="number">10000</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String charset=<span class="string">"UTF-8"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> HttpClient client = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		PoolingHttpClientConnectionManager cm = <span class="keyword">new</span> PoolingHttpClientConnectionManager();</span><br><span class="line">		cm.setMaxTotal(<span class="number">128</span>);</span><br><span class="line">		cm.setDefaultMaxPerRoute(<span class="number">128</span>);</span><br><span class="line">		client = HttpClients.custom().setConnectionManager(cm).build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">postParameters</span><span class="params">(String url, String parameterStr)</span> <span class="keyword">throws</span> ConnectTimeoutException, SocketTimeoutException, Exception</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> post(url,parameterStr,<span class="string">"application/x-www-form-urlencoded"</span>,charset,connTimeout,readTimeout);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">postParameters</span><span class="params">(String url, String parameterStr,String charset, Integer connTimeout, Integer readTimeout)</span> <span class="keyword">throws</span> ConnectTimeoutException, SocketTimeoutException, Exception</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> post(url,parameterStr,<span class="string">"application/x-www-form-urlencoded"</span>,charset,connTimeout,readTimeout);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">postParameters</span><span class="params">(String url, Map&lt;String, String&gt; params)</span> <span class="keyword">throws</span> ConnectTimeoutException,</span></span><br><span class="line"><span class="function">			SocketTimeoutException, Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> postForm(url, params, <span class="keyword">null</span>, connTimeout, readTimeout);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">postParameters</span><span class="params">(String url, Map&lt;String, String&gt; params, Integer connTimeout,Integer readTimeout)</span> <span class="keyword">throws</span> ConnectTimeoutException,</span></span><br><span class="line"><span class="function">			SocketTimeoutException, Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> postForm(url, params, <span class="keyword">null</span>, connTimeout, readTimeout);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String url)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> get(url, charset, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String url, String charset)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> get(url, charset, connTimeout, readTimeout);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送一个 Post 请求, 使用指定的字符集编码.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> body RequestBody</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mimeType 例如 application/xml "application/x-www-form-urlencoded" a=1&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> charset 编码</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> connTimeout 建立链接超时时间,毫秒.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> readTimeout 响应超时时间,毫秒.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> ResponseBody, 使用指定的字符集编码.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ConnectTimeoutException 建立链接超时异常</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SocketTimeoutException  响应超时</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">post</span><span class="params">(String url, String body, String mimeType,String charset, Integer connTimeout, Integer readTimeout)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ConnectTimeoutException, SocketTimeoutException, Exception </span>&#123;</span><br><span class="line">		HttpClient client = <span class="keyword">null</span>;</span><br><span class="line">		HttpPost post = <span class="keyword">new</span> HttpPost(url);</span><br><span class="line">		String result = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (StringUtils.isNotBlank(body)) &#123;</span><br><span class="line">				HttpEntity entity = <span class="keyword">new</span> StringEntity(body, ContentType.create(mimeType, charset));</span><br><span class="line">				post.setEntity(entity);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 设置参数</span></span><br><span class="line">			Builder customReqConf = RequestConfig.custom();</span><br><span class="line">			<span class="keyword">if</span> (connTimeout != <span class="keyword">null</span>) &#123;</span><br><span class="line">				customReqConf.setConnectTimeout(connTimeout);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (readTimeout != <span class="keyword">null</span>) &#123;</span><br><span class="line">				customReqConf.setSocketTimeout(readTimeout);</span><br><span class="line">			&#125;</span><br><span class="line">			post.setConfig(customReqConf.build());</span><br><span class="line"></span><br><span class="line">			HttpResponse res;</span><br><span class="line">			<span class="keyword">if</span> (url.startsWith(<span class="string">"https"</span>)) &#123;</span><br><span class="line">				<span class="comment">// 执行 Https 请求.</span></span><br><span class="line">				client = createSSLInsecureClient();</span><br><span class="line">				res = client.execute(post);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// 执行 Http 请求.</span></span><br><span class="line">				client = HttpClientUtils.client;</span><br><span class="line">				res = client.execute(post);</span><br><span class="line">			&#125;</span><br><span class="line">			result = IOUtils.toString(res.getEntity().getContent(), charset);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			post.releaseConnection();</span><br><span class="line">			<span class="keyword">if</span> (url.startsWith(<span class="string">"https"</span>) &amp;&amp; client != <span class="keyword">null</span>&amp;&amp; client <span class="keyword">instanceof</span> CloseableHttpClient) &#123;</span><br><span class="line">				((CloseableHttpClient) client).close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 提交form表单</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> connTimeout</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> readTimeout</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ConnectTimeoutException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SocketTimeoutException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">postForm</span><span class="params">(String url, Map&lt;String, String&gt; params, Map&lt;String, String&gt; headers, Integer connTimeout,Integer readTimeout)</span> <span class="keyword">throws</span> ConnectTimeoutException,</span></span><br><span class="line"><span class="function">			SocketTimeoutException, Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		HttpClient client = <span class="keyword">null</span>;</span><br><span class="line">		HttpPost post = <span class="keyword">new</span> HttpPost(url);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; !params.isEmpty()) &#123;</span><br><span class="line">				List&lt;NameValuePair&gt; formParams = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line">				Set&lt;Entry&lt;String, String&gt;&gt; entrySet = params.entrySet();</span><br><span class="line">				<span class="keyword">for</span> (Entry&lt;String, String&gt; entry : entrySet) &#123;</span><br><span class="line">					formParams.add(<span class="keyword">new</span> BasicNameValuePair(entry.getKey(), entry.getValue()));</span><br><span class="line">				&#125;</span><br><span class="line">				UrlEncodedFormEntity entity = <span class="keyword">new</span> UrlEncodedFormEntity(formParams, Consts.UTF_8);</span><br><span class="line">				post.setEntity(entity);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (headers != <span class="keyword">null</span> &amp;&amp; !headers.isEmpty()) &#123;</span><br><span class="line">				<span class="keyword">for</span> (Entry&lt;String, String&gt; entry : headers.entrySet()) &#123;</span><br><span class="line">					post.addHeader(entry.getKey(), entry.getValue());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 设置参数</span></span><br><span class="line">			Builder customReqConf = RequestConfig.custom();</span><br><span class="line">			<span class="keyword">if</span> (connTimeout != <span class="keyword">null</span>) &#123;</span><br><span class="line">				customReqConf.setConnectTimeout(connTimeout);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (readTimeout != <span class="keyword">null</span>) &#123;</span><br><span class="line">				customReqConf.setSocketTimeout(readTimeout);</span><br><span class="line">			&#125;</span><br><span class="line">			post.setConfig(customReqConf.build());</span><br><span class="line">			HttpResponse res = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">if</span> (url.startsWith(<span class="string">"https"</span>)) &#123;</span><br><span class="line">				<span class="comment">// 执行 Https 请求.</span></span><br><span class="line">				client = createSSLInsecureClient();</span><br><span class="line">				res = client.execute(post);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// 执行 Http 请求.</span></span><br><span class="line">				client = HttpClientUtils.client;</span><br><span class="line">				res = client.execute(post);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> IOUtils.toString(res.getEntity().getContent(), <span class="string">"UTF-8"</span>);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			post.releaseConnection();</span><br><span class="line">			<span class="keyword">if</span> (url.startsWith(<span class="string">"https"</span>) &amp;&amp; client != <span class="keyword">null</span></span><br><span class="line">					&amp;&amp; client <span class="keyword">instanceof</span> CloseableHttpClient) &#123;</span><br><span class="line">				((CloseableHttpClient) client).close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送一个 GET 请求</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> charset</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> connTimeout  建立链接超时时间,毫秒.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> readTimeout  响应超时时间,毫秒.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ConnectTimeoutException   建立链接超时</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SocketTimeoutException   响应超时</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String url, String charset, Integer connTimeout,Integer readTimeout)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ConnectTimeoutException,SocketTimeoutException, Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		HttpClient client = <span class="keyword">null</span>;</span><br><span class="line">		HttpGet get = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">		String result = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 设置参数</span></span><br><span class="line">			Builder customReqConf = RequestConfig.custom();</span><br><span class="line">			<span class="keyword">if</span> (connTimeout != <span class="keyword">null</span>) &#123;</span><br><span class="line">				customReqConf.setConnectTimeout(connTimeout);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (readTimeout != <span class="keyword">null</span>) &#123;</span><br><span class="line">				customReqConf.setSocketTimeout(readTimeout);</span><br><span class="line">			&#125;</span><br><span class="line">			get.setConfig(customReqConf.build());</span><br><span class="line"></span><br><span class="line">			HttpResponse res = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (url.startsWith(<span class="string">"https"</span>)) &#123;</span><br><span class="line">				<span class="comment">// 执行 Https 请求.</span></span><br><span class="line">				client = createSSLInsecureClient();</span><br><span class="line">				res = client.execute(get);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// 执行 Http 请求.</span></span><br><span class="line">				client = HttpClientUtils.client;</span><br><span class="line">				res = client.execute(get);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			result = IOUtils.toString(res.getEntity().getContent(), charset);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			get.releaseConnection();</span><br><span class="line">			<span class="keyword">if</span> (url.startsWith(<span class="string">"https"</span>) &amp;&amp; client != <span class="keyword">null</span> &amp;&amp; client <span class="keyword">instanceof</span> CloseableHttpClient) &#123;</span><br><span class="line">				((CloseableHttpClient) client).close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 从 response 里获取 charset</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ressponse</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getCharsetFromResponse</span><span class="params">(HttpResponse ressponse)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// Content-Type:text/html; charset=GBK</span></span><br><span class="line">		<span class="keyword">if</span> (ressponse.getEntity() != <span class="keyword">null</span>  &amp;&amp; ressponse.getEntity().getContentType() != <span class="keyword">null</span> &amp;&amp; ressponse.getEntity().getContentType().getValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String contentType = ressponse.getEntity().getContentType().getValue();</span><br><span class="line">			<span class="keyword">if</span> (contentType.contains(<span class="string">"charset="</span>)) &#123;</span><br><span class="line">				<span class="keyword">return</span> contentType.substring(contentType.indexOf(<span class="string">"charset="</span>) + <span class="number">8</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建 SSL连接</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> GeneralSecurityException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> CloseableHttpClient <span class="title">createSSLInsecureClient</span><span class="params">()</span> <span class="keyword">throws</span> GeneralSecurityException </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			SSLContext sslContext = <span class="keyword">new</span> SSLContextBuilder().loadTrustMaterial(<span class="keyword">null</span>, <span class="keyword">new</span> TrustStrategy() &#123;</span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTrusted</span><span class="params">(X509Certificate[] chain,String authType)</span> <span class="keyword">throws</span> CertificateException </span>&#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;).build();</span><br><span class="line"></span><br><span class="line">			SSLConnectionSocketFactory sslsf = <span class="keyword">new</span> SSLConnectionSocketFactory(sslContext, <span class="keyword">new</span> X509HostnameVerifier() &#123;</span><br><span class="line"></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(String arg0, SSLSession arg1)</span> </span>&#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">(String host, SSLSocket ssl)</span></span></span><br><span class="line"><span class="function">						<span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">(String host, X509Certificate cert)</span></span></span><br><span class="line"><span class="function">						<span class="keyword">throws</span> SSLException </span>&#123;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">(String host, String[] cns,</span></span></span><br><span class="line"><span class="function"><span class="params">								   String[] subjectAlts)</span> <span class="keyword">throws</span> SSLException </span>&#123;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> HttpClients.custom().setSSLSocketFactory(sslsf).build();</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">catch</span> (GeneralSecurityException e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> e;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			String str= post(<span class="string">"https://localhost:443/ssl/test.shtml"</span>,<span class="string">"name=12&amp;page=34"</span>,<span class="string">"application/x-www-form-urlencoded"</span>, <span class="string">"UTF-8"</span>, <span class="number">10000</span>, <span class="number">10000</span>);</span><br><span class="line">			<span class="comment">//String str= get("https://localhost:443/ssl/test.shtml?name=12&amp;page=34","GBK");</span></span><br><span class="line">            <span class="comment">/*Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;();</span></span><br><span class="line"><span class="comment">            map.put("name", "111");</span></span><br><span class="line"><span class="comment">            map.put("page", "222");</span></span><br><span class="line"><span class="comment">            String str= postForm("https://localhost:443/ssl/test.shtml",map,null, 10000, 10000);*/</span></span><br><span class="line">			System.out.println(str);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ConnectTimeoutException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SocketTimeoutException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span><span class="comment">//注意这里是为了请求地址，不需要返回数据，所以需要使用@Controller注解，而不是ResController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/ucenter/wx"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxApiController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//微信扫码登陆后跳转的接口</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/callback"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">callback</span><span class="params">(String code, String state)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 获取code值，临时票据，类似于验证码</span></span><br><span class="line">            <span class="comment">//2 拿着code请求 微信固定的地址，得到两个值 accsess_token 和 openid</span></span><br><span class="line">            String baseAccessTokenUrl = <span class="string">"https://api.weixin.qq.com/sns/oauth2/access_token"</span> +</span><br><span class="line">                    <span class="string">"?appid=%s"</span> +</span><br><span class="line">                    <span class="string">"&amp;secret=%s"</span> +</span><br><span class="line">                    <span class="string">"&amp;code=%s"</span> +</span><br><span class="line">                    <span class="string">"&amp;grant_type=authorization_code"</span>;</span><br><span class="line">            String accessTokenUrl = String.format(</span><br><span class="line">                    baseAccessTokenUrl,</span><br><span class="line">                    ConstantWxUtil.APP_ID,</span><br><span class="line">                    ConstantWxUtil.APP_SECRET,</span><br><span class="line">                    code</span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//请求这个拼接好的地址，得到返回两个值 accsess_token 和 openid</span></span><br><span class="line">            <span class="comment">//使用httpclient发送请求，得到返回结果；</span></span><br><span class="line">            String accessTokenInfo = HttpClientUtils.get(accessTokenUrl);</span><br><span class="line">            <span class="comment">//先打印出来看看数据，再往下开发</span></span><br><span class="line">            <span class="comment">//System.out.println(accessTokenInfo);</span></span><br><span class="line">            <span class="comment">//主要得到了以下一些数据，其中最主要的是access_token和openid</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            &#123;"access_token":"35_Mlim9my1JvMMlxEAjdXl_myzYMqK557-gDMT1xPFzkdbuZtCcZhDKYF76fMNm2x4jezwjtDskajHz4moqU3QkY-8-UchF9h97pFfaXXxWDc",</span></span><br><span class="line"><span class="comment">            "expires_in":7200,</span></span><br><span class="line"><span class="comment">            "refresh_token":"35_WrtoTiyByt-WCteQkOK8QfC0uKgASo1TCr9xsDA_McuRwFP16r78PgIl4wpD325Vj5LcI_kGsejd7p-Q1_YPSkKb2JAtbGCiWR5q2flr64E",</span></span><br><span class="line"><span class="comment">            "openid":"o3_SC5y2N2fYnSLhnUp7l2qZpekM",</span></span><br><span class="line"><span class="comment">            "scope":"snsapi_login",</span></span><br><span class="line"><span class="comment">            "unionid":"oWgGz1CNae7qIKCKMuk3esyotkw0"&#125;</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="comment">//拿着返回的数据，使用httpclient进一步请求微信提供的地址</span></span><br><span class="line">            <span class="comment">//因为返回的是字符串，类似于key-value的形式，我们要怎么去获取呢？</span></span><br><span class="line">            <span class="comment">//可以先将返回的数据转换为map集合，然后通过key获取,这里使用json的转换工具为gson，</span></span><br><span class="line">            Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">            HashMap mapAccessToken = gson.fromJson(accessTokenInfo, HashMap<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            String access_token = (String) mapAccessToken.get(<span class="string">"access_token"</span>);</span><br><span class="line">            String openid = (String) mapAccessToken.get(<span class="string">"openid"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//在发送请求之前，我们先应该先通过openid判断该微信用户是否注册过</span></span><br><span class="line">            Member member = memberService.getByOpenId(openid);</span><br><span class="line">            <span class="keyword">if</span> (member == <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//如果为空表示该微信用户还没注册过，则拿着access_token和openid继续请求微信提供的固定地址</span></span><br><span class="line">                String baseUserInfoUrl = <span class="string">"https://api.weixin.qq.com/sns/userinfo"</span> +</span><br><span class="line">                        <span class="string">"?access_token=%s"</span> +</span><br><span class="line">                        <span class="string">"&amp;openid=%s"</span>;</span><br><span class="line">                <span class="comment">//拼接两个参数</span></span><br><span class="line">                String userInfoUrl = String.format(</span><br><span class="line">                        baseUserInfoUrl,</span><br><span class="line">                        access_token,</span><br><span class="line">                        openid</span><br><span class="line">                );</span><br><span class="line">                String userInfo = HttpClientUtils.get(userInfoUrl);</span><br><span class="line">                <span class="comment">//查看下userInfo里面包含的数据</span></span><br><span class="line">                <span class="comment">//System.out.println(userInfo);</span></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                &#123;"openid":"o3_SC5y2N2fYnSLhnUp7l2qZpekM",</span></span><br><span class="line"><span class="comment">                "nickname":"牛排🍖",</span></span><br><span class="line"><span class="comment">                "sex":1,</span></span><br><span class="line"><span class="comment">                "language":"zh_CN",</span></span><br><span class="line"><span class="comment">                "city":"Guangzhou",</span></span><br><span class="line"><span class="comment">                "province":"Guangdong",</span></span><br><span class="line"><span class="comment">                "country":"CN",</span></span><br><span class="line"><span class="comment">                "headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/3akBBSAb7wJNJ124Z0PNicuNibKlUvefsiaPLfcwPUTxxdG1iaAwzylC148j4Q8nSc6jicZoKbpDdia2ldKwicISCF98Q\/132",</span></span><br><span class="line"><span class="comment">                "privilege":["chinaunicom"],</span></span><br><span class="line"><span class="comment">                "unionid":"oWgGz1CNae7qIKCKMuk3esyotkw0"&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="comment">//获取到返回的用户信息之后，将其注册到数据库中，也就是member</span></span><br><span class="line">                <span class="comment">//注册前我们应该先将刚返回的userInfo转换为map集合</span></span><br><span class="line">                HashMap userInfoMap = gson.fromJson(userInfo, HashMap<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                String nickname = (String) userInfoMap.get(<span class="string">"nickname"</span>);</span><br><span class="line">                String avatar = (String) userInfoMap.get(<span class="string">"headimgurl"</span>);</span><br><span class="line">                member = <span class="keyword">new</span> Member();</span><br><span class="line">                member.setOpenid(openid);</span><br><span class="line">                member.setNickname(nickname);</span><br><span class="line">                member.setAvatar(avatar);</span><br><span class="line">                memberService.save(member);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取到用户信息之后，我们怎么样才能在前端获取到这个用户信息呢？</span></span><br><span class="line">            <span class="comment">//有的人可能会想到将其存到cookie中，但是要主要cookie是没法跨域传递的，localhost倒是可以，但是在实际开发中肯定是不同的域名的</span></span><br><span class="line">            <span class="comment">//所以我们还是通过jwt生成token，并通过域名传递</span></span><br><span class="line">            System.out.println(<span class="string">"################获取token前"</span>);</span><br><span class="line">            String jwtToken = JwtUtils.getJwtToken(member.getId(), member.getNickname());</span><br><span class="line">            System.out.println(<span class="string">"############获取token后"</span> + jwtToken);</span><br><span class="line">            <span class="comment">//最后：返回首页面，通过路径传递token字符串</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:http://localhost:8030?token="</span> + jwtToken;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">"登陆失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注意这里是为了请求地址，生成微信扫描登陆的二维码，所以返回值应该是String</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQrCode</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//微信开放平台授权bashUrl,连接是固定的，%s相当于sql语句中？占位符，其他的都是固定值，详细可以参考开发文档</span></span><br><span class="line">        <span class="comment">//注意下面拼接的redirect_uri二部是url</span></span><br><span class="line">        String baseUrl = <span class="string">"https://open.weixin.qq.com/connect/qrconnect"</span> +</span><br><span class="line">                <span class="string">"?appid=%s"</span> +</span><br><span class="line">                <span class="string">"&amp;redirect_uri=%s"</span> +</span><br><span class="line">                <span class="string">"&amp;response_type=code"</span> +</span><br><span class="line">                <span class="string">"&amp;scope=snsapi_login"</span> +</span><br><span class="line">                <span class="string">"&amp;state=%s"</span> +</span><br><span class="line">                <span class="string">"#wechat_redirect"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取redirectUrl</span></span><br><span class="line">        String redirectUrl = ConstantWxUtil.REDIRECT_URL;</span><br><span class="line">        <span class="comment">//对url进行utf-8编码</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redirectUrl = URLEncoder.encode(redirectUrl, <span class="string">"utf-8"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对baseUrl中的参数赋值</span></span><br><span class="line">        String url = String.format(</span><br><span class="line">                baseUrl,</span><br><span class="line">                ConstantWxUtil.APP_ID,</span><br><span class="line">                redirectUrl,</span><br><span class="line">                <span class="string">"ryan"</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重定向到请求微信地址里面</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:"</span> + url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前台显示微信用户信息"><a href="#前台显示微信用户信息" class="headerlink" title="前台显示微信用户信息"></a>前台显示微信用户信息</h3><p>default.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">created()&#123;</span><br><span class="line">    <span class="comment">//首先判断路径中的token</span></span><br><span class="line">    <span class="comment">//以前的restful风格我们都是通过this.$route.param.id取值的，现在因为是使用？传参的，所以不能这样获取</span></span><br><span class="line">    <span class="keyword">this</span>.token = <span class="keyword">this</span>.$route.query.token</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.token)&#123;</span><br><span class="line">      <span class="keyword">this</span>.wxLogin()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.showInfo()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">//微信登陆</span></span><br><span class="line">    wxLogin()&#123;</span><br><span class="line">      <span class="comment">//把token值放到cookie里面</span></span><br><span class="line">      cookie.set(<span class="string">'guli_token'</span>,<span class="keyword">this</span>.token,&#123;<span class="attr">domain</span>: <span class="string">'localhost'</span>&#125;)</span><br><span class="line">      cookie.set(<span class="string">'guli_ucenter'</span>,<span class="string">''</span>,&#123;<span class="attr">domain</span>: <span class="string">'localhost'</span>&#125;)</span><br><span class="line">      <span class="comment">//调用接口通过token获取用户信息</span></span><br><span class="line">      loginApi.getUserInfo()</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.loginInfo = response.data.data.userInfo</span><br><span class="line">          cookie.set(<span class="string">'guli_ucenter'</span>,<span class="keyword">this</span>.loginInfo,&#123;<span class="attr">domain</span>: <span class="string">'localhost'</span>&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//从cookie中获取用户信息，并赋值</span></span><br><span class="line">    showInfo()&#123;</span><br><span class="line">      <span class="keyword">var</span> userStr = cookie.get(<span class="string">'guli_ucenter'</span>)</span><br><span class="line">      <span class="comment">//注意这里获取到的是字符串形式的json数据，我们需要将其转换为json数据</span></span><br><span class="line">      <span class="keyword">if</span>(userStr)&#123;</span><br><span class="line">        <span class="keyword">this</span>.loginInfo = <span class="built_in">JSON</span>.parse(userStr)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//点击退出登录</span></span><br><span class="line">    logout()&#123;</span><br><span class="line">      <span class="comment">//将cookie中的相关信息清除即可，注意cookie没有直接清楚的方法，可重设为空</span></span><br><span class="line">      cookie.set(<span class="string">'guli_token'</span>, <span class="string">''</span>,&#123;<span class="attr">domain</span>:<span class="string">"localhost"</span>&#125;)</span><br><span class="line">      cookie.set(<span class="string">'guli_ucenter'</span>, <span class="string">''</span>,&#123;<span class="attr">domain</span>:<span class="string">"localhost"</span>&#125;)</span><br><span class="line">      <span class="comment">//然后回到首页</span></span><br><span class="line">      <span class="comment">//this.$router.push(&#123;path: '/'&#125;)</span></span><br><span class="line">      <span class="comment">//跳转页面其实也可以这样写，使用js代码，这里建议使用，具体你可以看看a连接的href</span></span><br><span class="line">      <span class="built_in">window</span>.location.href = <span class="string">"/"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><img src= "/img/loading.gif" data-src="https://my-pic-bed-01.oss-cn-shenzhen.aliyuncs.com/img/20200712112943.png" alt="image-20200712111528115"></p>
<h3 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h3><p>1、微信名包含表情的情况，在保存微信名到数据库的时候，会报错，原因：</p>
<p>数据库编码为UTF8，<strong>MYSQL的UTF8编码最多3个字节,EMOJI表情或者某些特殊字符的编码是4个字节</strong>，导致存入数据库时发生了异常。</p>
<p>解决方案：</p>
<p>打开mysql的配置文件my.ini，修改配置如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="comment"># default-character-set=utf8</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4 </span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># character-set-server=utf8</span></span><br><span class="line"><span class="attr">character-set-server</span>=utf8mb4</span><br></pre></td></tr></table></figure>

<p>然后重启mysql服务即可</p>
<p>2、网络错误，无法访问</p>
<p>要么是nginx没启动或者配置文件出错，要么是前后端对应的访问地址出错，排查一遍即可</p>
<p>3、springboot整合linux的redis服务报错：java.io.IOException: 远程主机强迫关闭了一个现有的连接，可能的原因：</p>
<p>一是客户端的连接池满了，无法创建新的连接</p>
<p>二是redis服务端连接溢出，无法分配新的连接</p>
<p>解决方案：</p>
<p>修改我的redis配置文件，具体修改内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcp keepalive 10</span><br><span class="line"><span class="comment"># 反正不是0或者300这些极端数据就行</span></span><br></pre></td></tr></table></figure>

<p>提示：redis这个可能只是暂时性解决问题， 可能还会出现，具体我还没完全弄懂</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ryan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/07/11/%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day07%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E7%99%BB%E9%99%86%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91-jwt-%EF%BC%89/">http://yoursite.com/2020/07/11/%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day07%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E7%99%BB%E9%99%86%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91-jwt-%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Ryan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue/">vue</a><a class="post-meta__tags" href="/tags/springboot/">springboot</a><a class="post-meta__tags" href="/tags/jwt/">jwt</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><button class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="wechat" onclick="window.open('/img/wechat.jpg')"/><div class="post-qr-code__desc">wechat</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/07/14/%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day08%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E8%AE%B2%E5%B8%88-%E8%AF%BE%E7%A8%8B%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91/"><img class="prev-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">谷粒学院实战day08—客户前台讲师+课程页面开发</div></div></a></div><div class="next-post pull-right"><a href="/2020/07/10/%E5%AD%A6%E9%99%A2%E5%AE%9E%E6%88%98day06%E2%80%94%E5%AE%A2%E6%88%B7%E5%89%8D%E5%8F%B0%E5%BC%80%E5%8F%91-%E6%95%B4%E5%90%88redis/"><img class="next-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">谷粒学院实战day06—客户前台开发+整合redis</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/06/24/ringboot-vue前后端分离博客项目/" title="springboot+vue前后端分离博客项目"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-24</div><div class="relatedPosts_title">springboot+vue前后端分离博客项目</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/04/学院实战day03—阿里云对象存储-niginx-easyexcel-课程分类模块开发/" title="谷粒学院实战day03—阿里云对象存储+niginx+easyexcel+课程分类模块开发"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-04</div><div class="relatedPosts_title">谷粒学院实战day03—阿里云对象存储+niginx+easyexcel+课程分类模块开发</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/06/粒学院实战day04—课程管理开发-1/" title="谷粒学院实战day04—课程管理开发(1)"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-06</div><div class="relatedPosts_title">谷粒学院实战day04—课程管理开发(1)</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/08/学院实战day05—课程管理开发-2-微服务springcloud/" title="谷粒学院实战day05—课程管理开发(2)+微服务springcloud"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-08</div><div class="relatedPosts_title">谷粒学院实战day05—课程管理开发(2)+微服务springcloud</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/10/学院实战day06—客户前台开发-整合redis/" title="谷粒学院实战day06—客户前台开发+整合redis"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-10</div><div class="relatedPosts_title">谷粒学院实战day06—客户前台开发+整合redis</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/14/谷粒学院实战day08—客户前台讲师-课程页面开发/" title="谷粒学院实战day08—客户前台讲师+课程页面开发"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-14</div><div class="relatedPosts_title">谷粒学院实战day08—客户前台讲师+课程页面开发</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'hCTAXV9K2j6lRxnNWaeqXmHJ-gzGzoHsz',
  appKey: 'bL3PlAeQjsLS33uYxl0f7BVr',
  placeholder: '记得留下你的昵称和邮箱，可以快速收到回复哦',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ryan</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text"><a href="https://ryan0824.github.io/" target="_blank" rel="noopener">Hi, welcome to myblog</a>!</div><div class="icp"><a><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备20003954号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fas fa-comments"></i></a><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script></body></html>