<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>springboot+vue前后端分离博客项目 | Ryan</title><meta name="description" content="确定技术栈后端技术栈： springboot mybatis plus shiro lombok redis hibernate validatior(springboot内置) jwt  后端开发步骤：1、建好数据库2、springboot整合mybatis plus（整合之后别忘了先测试一下）3、前后端统一结果封装这里我们用到了一个Result的类，这个用于我们的异步统一返回的结果封装。一般来"><meta name="keywords" content="vue,springboot"><meta name="author" content="Ryan"><meta name="copyright" content="Ryan"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2020/06/24/ringboot-vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="springboot+vue前后端分离博客项目"><meta property="og:url" content="http://yoursite.com/2020/06/24/ringboot-vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"><meta property="og:site_name" content="Ryan"><meta property="og:description" content="确定技术栈后端技术栈： springboot mybatis plus shiro lombok redis hibernate validatior(springboot内置) jwt  后端开发步骤：1、建好数据库2、springboot整合mybatis plus（整合之后别忘了先测试一下）3、前后端统一结果封装这里我们用到了一个Result的类，这个用于我们的异步统一返回的结果封装。一般来"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-06-24T08:49:00.000Z"><meta property="article:modified_time" content="2020-06-24T10:41:05.917Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="Hexo+github快速搭建个人博客系统" href="http://yoursite.com/2020/06/24/xo-github%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"><link rel="next" title="RabbitMQ入门+整合springboot" href="http://yoursite.com/2020/06/24/bbitMQ%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Ryan" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#确定技术栈"><span class="toc-number">1.</span> <span class="toc-text">确定技术栈</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#后端技术栈："><span class="toc-number">1.1.</span> <span class="toc-text">后端技术栈：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#后端开发步骤："><span class="toc-number">1.1.1.</span> <span class="toc-text">后端开发步骤：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、建好数据库"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">1、建好数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、springboot整合mybatis-plus（整合之后别忘了先测试一下）"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">2、springboot整合mybatis plus（整合之后别忘了先测试一下）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、前后端统一结果封装"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">3、前后端统一结果封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、shiro整合jwt逻辑分析"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">4、shiro整合jwt逻辑分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5、shiro代码编写"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">5、shiro代码编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6、全局异常处理"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">6、全局异常处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7、实体校验"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">7、实体校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8、解决跨域问题"><span class="toc-number">1.1.1.8.</span> <span class="toc-text">8、解决跨域问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9、登陆接口开发"><span class="toc-number">1.1.1.9.</span> <span class="toc-text">9、登陆接口开发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前端技术栈："><span class="toc-number">1.2.</span> <span class="toc-text">前端技术栈：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前端开发步骤："><span class="toc-number">1.2.1.</span> <span class="toc-text">前端开发步骤：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、环境搭建"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">1、环境搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、页面路由"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2、页面路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、登陆页面"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">3、登陆页面</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1、token状态同步"><span class="toc-number">1.2.1.3.1.</span> <span class="toc-text">3.1、token状态同步</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2、定义全局axios拦截器"><span class="toc-number">1.2.1.3.2.</span> <span class="toc-text">3.2、定义全局axios拦截器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、博客列表"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">4、博客列表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1、头部用户信息"><span class="toc-number">1.2.1.4.1.</span> <span class="toc-text">4.1、头部用户信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2、博客分页"><span class="toc-number">1.2.1.4.2.</span> <span class="toc-text">4.2、博客分页</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5、博客编辑"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">5、博客编辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6、博客详情"><span class="toc-number">1.2.1.6.</span> <span class="toc-text">6、博客详情</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7、路由权限拦截"><span class="toc-number">1.2.1.7.</span> <span class="toc-text">7、路由权限拦截</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Ryan</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">springboot+vue前后端分离博客项目</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-06-24 16:49:00"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-06-24</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-24 18:41:05"><i class="fas fa-history fa-fw"></i> 更新于 2020-06-24</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/">前后端分离</a><i class="fas fa-angle-right post-meta__separator"></i><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E7%AB%AF/">前端</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">10k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 45 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="far fa-comments fa-fw post-meta__icon"></i><span>评论数:</span><a href="/2020/06/24/ringboot-vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/06/24/ringboot-vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="确定技术栈"><a href="#确定技术栈" class="headerlink" title="确定技术栈"></a>确定技术栈</h1><h2 id="后端技术栈："><a href="#后端技术栈：" class="headerlink" title="后端技术栈："></a>后端技术栈：</h2><ul>
<li>springboot</li>
<li>mybatis plus</li>
<li>shiro</li>
<li>lombok</li>
<li>redis</li>
<li>hibernate validatior(springboot内置)</li>
<li>jwt</li>
</ul>
<h3 id="后端开发步骤："><a href="#后端开发步骤：" class="headerlink" title="后端开发步骤："></a>后端开发步骤：</h3><h4 id="1、建好数据库"><a href="#1、建好数据库" class="headerlink" title="1、建好数据库"></a>1、建好数据库</h4><h4 id="2、springboot整合mybatis-plus（整合之后别忘了先测试一下）"><a href="#2、springboot整合mybatis-plus（整合之后别忘了先测试一下）" class="headerlink" title="2、springboot整合mybatis plus（整合之后别忘了先测试一下）"></a>2、springboot整合mybatis plus（整合之后别忘了先测试一下）</h4><h4 id="3、前后端统一结果封装"><a href="#3、前后端统一结果封装" class="headerlink" title="3、前后端统一结果封装"></a>3、前后端统一结果封装</h4><p>这里我们用到了一个Result的类，这个用于我们的异步统一返回的结果封装。一般来说，结果里面有几个要素必要的</p>
<ul>
<li>是否成功，可用code表示（如200表示成功，400表示异常）</li>
<li>结果消息</li>
<li>结果数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.common.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">//状态码,200一般表示正常，非200表示异常</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="comment">//信息</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="comment">//数据</span></span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操作成功的结果封装</span></span><br><span class="line">    <span class="comment">//对于前端来说，操作成功一般都是200，他们一般比较注重我data，所以我们需要进一步封装</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">(Object data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="number">200</span>,<span class="string">"操作成功"</span>,data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法封装，方便别处调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">(<span class="keyword">int</span> code,String msg,Object data)</span></span>&#123;</span><br><span class="line">        Result result = <span class="keyword">new</span> Result();</span><br><span class="line">        result.setCode(code);</span><br><span class="line">        result.setMsg(msg);</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//往往操作失败之后，没有什么数据返回的，看中的是msg，所以我们可以再进一层封装</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">fail</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="number">400</span>, msg,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操作失败的状态码一般是400，msg一般是错误原因什么的，所以这里最好也加上</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">fail</span><span class="params">(String msg, Object data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="number">400</span>,msg,data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操作失败的结果封装</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">fail</span><span class="params">(<span class="keyword">int</span> code,String msg,Object data)</span></span>&#123;</span><br><span class="line">        Result result = <span class="keyword">new</span> Result();</span><br><span class="line">        result.setCode(code);</span><br><span class="line">        result.setMsg(msg);</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、shiro整合jwt逻辑分析"><a href="#4、shiro整合jwt逻辑分析" class="headerlink" title="4、shiro整合jwt逻辑分析"></a>4、shiro整合jwt逻辑分析</h4><ul>
<li><p>登陆逻辑</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/vizs7gK8Q36xkNj.png" alt="image-20200611113753252"></p>
</li>
<li><p>访问资源（接口）时的shiro&amp;jwt逻辑</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/JFZc7hiTYOgxdA4.png" alt="image-20200611115119307"></p>
</li>
</ul>
<h4 id="5、shiro代码编写"><a href="#5、shiro代码编写" class="headerlink" title="5、shiro代码编写"></a>5、shiro代码编写</h4><p>考虑到后面可能需要做集群、负载均衡等，所以就需要会话共享，而shiro的缓存和会话信息，我们一般考虑使用redis来存储这些数据，所以，我们不仅仅需要整合shiro，同时也需要整合redis。在开源的项目中，我们找到了一个starter可以快速整合shiro-redis，配置简单，这里也推荐大家使用。</p>
<p>而因为我们需要做的是前后端分离项目的骨架，所以一般我们会采用token或者jwt作为跨域身份验证解决方案。所以整合shiro的过程中，我们需要引入jwt的身份验证过程。</p>
<p>第一步：导入shiro-redis的starter包：还有jwt的工具包，以及为了简化开发，我引入了hutool工具包。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.crazycake<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-redis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- hutool工具类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jwt --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二部：配置shiro</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ryan.shiro.AccountRealm;</span><br><span class="line"><span class="keyword">import</span> com.ryan.shiro.JwtFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSessionStorageEvaluator;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSubjectDAO;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.session.mgt.SessionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.config.DefaultShiroFilterChainDefinition;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.config.ShiroFilterChainDefinition;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.session.mgt.DefaultWebSessionManager;</span><br><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisSessionDAO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * shiro启用注解拦截控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtFilter jwtFilter;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SessionManager <span class="title">sessionManager</span><span class="params">(RedisSessionDAO redisSessionDAO)</span> </span>&#123;</span><br><span class="line">        DefaultWebSessionManager sessionManager = <span class="keyword">new</span> DefaultWebSessionManager();</span><br><span class="line">        sessionManager.setSessionDAO(redisSessionDAO);</span><br><span class="line">        <span class="keyword">return</span> sessionManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">securityManager</span><span class="params">(AccountRealm accountRealm,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                     SessionManager sessionManager,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                     RedisCacheManager redisCacheManager)</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager(accountRealm);</span><br><span class="line">        securityManager.setSessionManager(sessionManager);</span><br><span class="line">        securityManager.setCacheManager(redisCacheManager);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 关闭shiro自带的session，详情见文档</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        DefaultSubjectDAO subjectDAO = <span class="keyword">new</span> DefaultSubjectDAO();</span><br><span class="line">        DefaultSessionStorageEvaluator defaultSessionStorageEvaluator = <span class="keyword">new</span> DefaultSessionStorageEvaluator();</span><br><span class="line">        defaultSessionStorageEvaluator.setSessionStorageEnabled(<span class="keyword">false</span>);</span><br><span class="line">        subjectDAO.setSessionStorageEvaluator(defaultSessionStorageEvaluator);</span><br><span class="line">        securityManager.setSubjectDAO(subjectDAO);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//shiro过滤器链的定义</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterChainDefinition <span class="title">shiroFilterChainDefinition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultShiroFilterChainDefinition chainDefinition = <span class="keyword">new</span> DefaultShiroFilterChainDefinition();</span><br><span class="line">        Map&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//所有的链接都会经过我们jwt</span></span><br><span class="line">        filterMap.put(<span class="string">"/**"</span>, <span class="string">"jwt"</span>); <span class="comment">// 主要通过注解方式校验权限</span></span><br><span class="line">        chainDefinition.addPathDefinitions(filterMap);</span><br><span class="line">        <span class="keyword">return</span> chainDefinition;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"shiroFilterFactoryBean"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                             ShiroFilterChainDefinition shiroFilterChainDefinition)</span> </span>&#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilter = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        shiroFilter.setSecurityManager(securityManager);</span><br><span class="line">        Map&lt;String, Filter&gt; filters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        filters.put(<span class="string">"jwt"</span>, jwtFilter);</span><br><span class="line">        shiroFilter.setFilters(filters);</span><br><span class="line">        Map&lt;String, String&gt; filterMap = shiroFilterChainDefinition.getFilterChainMap();</span><br><span class="line">        shiroFilter.setFilterChainDefinitionMap(filterMap);</span><br><span class="line">        <span class="keyword">return</span> shiroFilter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开启注解代理（默认好像已经开启，可以不要）</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(SecurityManager securityManager)</span></span>&#123;</span><br><span class="line">        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DefaultAdvisorAutoProxyCreator <span class="title">getDefaultAdvisorAutoProxyCreator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultAdvisorAutoProxyCreator creator = <span class="keyword">new</span> DefaultAdvisorAutoProxyCreator();</span><br><span class="line">        <span class="keyword">return</span> creator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：导入jwt工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jwt工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"ryan.jwt"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String secret;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> expire;</span><br><span class="line">    <span class="keyword">private</span> String header;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成jwt token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateToken</span><span class="params">(<span class="keyword">long</span> userId)</span> </span>&#123;</span><br><span class="line">        Date nowDate = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="comment">//过期时间</span></span><br><span class="line">        Date expireDate = <span class="keyword">new</span> Date(nowDate.getTime() + expire * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">"typ"</span>, <span class="string">"JWT"</span>)</span><br><span class="line">                .setSubject(userId+<span class="string">""</span>)</span><br><span class="line">                .setIssuedAt(nowDate)</span><br><span class="line">                .setExpiration(expireDate)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, secret)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Claims <span class="title">getClaimByToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Jwts.parser()</span><br><span class="line">                    .setSigningKey(secret)</span><br><span class="line">                    .parseClaimsJws(token)</span><br><span class="line">                    .getBody();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            log.debug(<span class="string">"validate is token error "</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * token是否过期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  true：过期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTokenExpired</span><span class="params">(Date expiration)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> expiration.before(<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：编写jwtFilter类</p>
<ul>
<li><p>这个过滤器是我们的重点，这里我们继承的是Shiro内置的AuthenticatingFilter，一个可以内置了可以自动登录方法的的过滤器，有些同学继承BasicHttpAuthenticationFilter也是可以的。</p>
<p>我们需要重写几个方法：</p>
<ol>
<li>createToken：实现登录，我们需要生成我们自定义支持的JwtToken</li>
<li>onAccessDenied：拦截校验，当头部没有Authorization时候，我们直接通过，不需要自动登录；当带有的时候，首先我们校验jwt的有效性，没问题我们就直接执行executeLogin方法实现自动登录</li>
<li>onLoginFailure：登录异常时候进入的方法，我们直接把异常信息封装然后抛出</li>
<li>preHandle：拦截器的前置拦截，因为我们是前后端分析项目，项目中除了需要跨域全局配置之外，我们再拦截器中也需要提供跨域支持。这样，拦截器才不会在进入Controller之前就被限制了。</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.shiro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.ryan.common.lang.Result;</span><br><span class="line"><span class="keyword">import</span> com.ryan.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.ExpiredCredentialsException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.authc.AuthenticatingFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义jwt的过滤器JwtFilter</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这个过滤器是我们的重点，这里我们继承的是Shiro内置的AuthenticatingFilter，</span></span><br><span class="line"><span class="comment">一个可以内置了可以自动登录方法的的过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtFilter</span> <span class="keyword">extends</span> <span class="title">AuthenticatingFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现登录，我们需要生成我们自定义支持的JwtToken</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationToken <span class="title">createToken</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//获取Token</span></span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        String jwt = request.getHeader(<span class="string">"Authorization"</span>);<span class="comment">//获取jwt，,jwt是放在header里面的</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jwt))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;<span class="comment">//jwt为空的话就没必要登陆，直接跳过</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//有的话，封装成token</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JwtToken(jwt);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        思考：这里的createToken有什么用呢？</span></span><br><span class="line"><span class="comment">            底层就是调用了subject.login(token)</span></span><br><span class="line"><span class="comment">            然后再交给realm进行处理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//拦截校验，当头部没有Authorization时候，我们直接通过，不需要自动登录；</span></span><br><span class="line">    <span class="comment">// 当带有的时候，首先我们校验jwt的有效性，没问题我们就直接执行executeLogin方法实现自动登录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onAccessDenied</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        String jwt = request.getHeader(<span class="string">"Authorization"</span>);<span class="comment">//获取jwt，,jwt是放在header里面的</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jwt))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//没jwt，直接跳过，进入接口注解过滤</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//如果有，则需要校验jwt</span></span><br><span class="line">            Claims claim = jwtUtils.getClaimByToken(jwt);</span><br><span class="line">            <span class="comment">//如果claim为空或者token过期了，则抛出异常</span></span><br><span class="line">            <span class="keyword">if</span> (claim == <span class="keyword">null</span> || jwtUtils.isTokenExpired(claim.getExpiration()))&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ExpiredCredentialsException(<span class="string">"token已过期，请重新登录"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//执行登陆，接下来就是交给realm处理的</span></span><br><span class="line">            <span class="keyword">return</span> executeLogin(servletRequest,servletResponse);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从executeLogin方法原码可以看到，登录异常时候进入onLoginFailure方法，我们直接把异常信息封装然后抛出</span></span><br><span class="line">    <span class="comment">//因为是前后端分离，当出现登陆异常时，我们应该封装结果集</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onLoginFailure</span><span class="params">(AuthenticationToken token, AuthenticationException e, ServletRequest request, ServletResponse response)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        HttpServletResponse httpServletResponse = (HttpServletResponse) response;</span><br><span class="line">        Throwable throwable = e.getCause() == <span class="keyword">null</span> ? e : e.getCause();</span><br><span class="line">        Result result = Result.fail(throwable.getMessage());</span><br><span class="line">        String json = JSONUtil.toJsonStr(result);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            httpServletResponse.getWriter().print(json);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：新建一个jwtToken类</p>
<ul>
<li>shiro默认supports的是UsernamePasswordToken，而我们现在采用了jwt的方式，所以这里我们自定义一个JwtToken，来完成shiro的supports方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.shiro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtToken</span> <span class="keyword">implements</span> <span class="title">AuthenticationToken</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JwtToken</span><span class="params">(String jwt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.token = jwt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getPrincipal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getCredentials</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第五步：新建一个AccountProfile类</p>
<ul>
<li>而在AccountRealm我们还用到了AccountProfile，这是为了登录成功之后返回的一个用户信息的载体</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.shiro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountProfile</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第六步：新建AccountRealm类</p>
<ul>
<li><p>AccountRealm是shiro进行登录或者权限校验的逻辑所在，算是核心了，我们需要重写3个方法，分别是</p>
<ul>
<li>supports：为了让realm支持jwt的凭证校验</li>
<li>doGetAuthorizationInfo：权限校验</li>
<li>doGetAuthenticationInfo：登录认证校验</li>
</ul>
</li>
<li><p>其实主要就是doGetAuthenticationInfo登录认证这个方法，可以看到我们通过jwt获取到用户信息，判断用户的状态，最后异常就抛出对应的异常信息，否者封装成SimpleAuthenticationInfo返回给shiro。 接下来我们逐步分析里面出现的新类：</p>
<p>1、shiro默认supports的是UsernamePasswordToken，而我们现在采用了jwt的方式，所以这里我们自定义一个JwtToken，来完成shiro的supports方法。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.shiro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> com.ryan.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.ryan.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.ryan.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountRealm</span>  <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//需要声明支持什么token</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(AuthenticationToken token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token <span class="keyword">instanceof</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//登陆处理</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">//强转</span></span><br><span class="line">        JwtToken jwtToken = (JwtToken) token;</span><br><span class="line">        String userId = jwtUtils.getClaimByToken((String) jwtToken.getPrincipal()).getSubject();</span><br><span class="line">        User user = userService.getById(Long.valueOf(userId));</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnknownAccountException(<span class="string">"账户不存在"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (user.getStatus() == -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockedAccountException(<span class="string">"账户已被锁定"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        AccountProfile profile = <span class="keyword">new</span> AccountProfile();</span><br><span class="line">        BeanUtil.copyProperties(user, profile);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(profile, jwtToken.getCredentials(),getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基本的校验的路线完成之后，我们需要少量的基本信息配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">shiro-redis:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">redis-manager:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379</span></span><br><span class="line"><span class="attr">ryan:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="comment"># 加密秘钥</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">f4e2e52034348f86b67cde581c0f9eb5</span></span><br><span class="line">    <span class="comment"># token有效时长，7天，单位秒</span></span><br><span class="line">    <span class="attr">expire:</span> <span class="number">604800</span></span><br><span class="line">    <span class="attr">header:</span> <span class="string">token</span></span><br></pre></td></tr></table></figure>

<p>另外，如果你项目有使用spring-boot-devtools，需要添加一个配置文件，在resources目录下新建文件夹META-INF，然后新建文件spring-devtools.properties，这样热重启时候才不会报错。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">restart.include.shiro-redis</span>=<span class="string">/shiro-[\\w-\\.]+jar</span></span><br></pre></td></tr></table></figure>



<h4 id="6、全局异常处理"><a href="#6、全局异常处理" class="headerlink" title="6、全局异常处理"></a>6、全局异常处理</h4><p>新建一个exception包，然后新建一个全局异常处理的类GlobalExceptionHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ryan.common.lang.Result;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.ShiroException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//除了runtime还有shiro</span></span><br><span class="line">    <span class="meta">@ResponseStatus</span>(HttpStatus.UNAUTHORIZED)<span class="comment">//未授权</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = ShiroException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Result</span> <span class="title">handler</span>(<span class="title">ShiroException</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        log.error(<span class="string">"运行时异常:----------------&#123;&#125;"</span>,e);</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="number">401</span>,e.getMessage(),<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//大异常RuntimeException</span></span><br><span class="line">    <span class="meta">@ResponseStatus</span>(HttpStatus.BAD_REQUEST)<span class="comment">//返回状态码，让前端知道</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = RuntimeException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Result</span> <span class="title">handler</span>(<span class="title">RuntimeException</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        log.error(<span class="string">"运行时异常:----------------&#123;&#125;"</span>,e);</span><br><span class="line">        <span class="keyword">return</span> Result.fail(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口添加一个要求认证后才能访问的注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresAuthentication</span></span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/IyKalkGZzoJqucf.png" alt="image-20200611140254230"></p>
<h4 id="7、实体校验"><a href="#7、实体校验" class="headerlink" title="7、实体校验"></a>7、实体校验</h4><p>当我们表单数据提交的时候，前端的校验我们可以使用一些类似于jQuery Validate等js插件实现，而后端我们可以使用Hibernate validatior来做校验。</p>
<p>我们使用springboot框架作为基础，那么就已经自动集成了Hibernate validatior。</p>
<p>那么用起来啥样子的呢？</p>
<p>第一步：首先在实体的属性上添加对应的校验规则，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableId</span>(value = <span class="string">"id"</span>, type = IdType.AUTO)</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotBlank</span>(message = <span class="string">"昵称不能为空"</span>)</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotBlank</span>(message = <span class="string">"邮箱不能为空"</span>)</span><br><span class="line"><span class="meta">@Email</span>(message = <span class="string">"邮箱格式不正确"</span>)</span><br><span class="line"><span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> LocalDateTime created;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> LocalDateTime lastLogin;</span><br></pre></td></tr></table></figure>

<p>第二步 ：这里我们使用@Validated注解方式，如果实体不符合要求，系统会抛出异常，那么我们的异常处理中就捕获到MethodArgumentNotValidException。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">save</span><span class="params">(@Validated @RequestBody User user)</span></span>&#123;</span><br><span class="line">    <span class="comment">//@Validated注解方式，如果实体不符合要求，系统会抛出异常MethodArgumentNotValidException</span></span><br><span class="line">    <span class="comment">//这就要求我们需要在全局异常处理中捕捉他</span></span><br><span class="line">    <span class="keyword">return</span> Result.success(user);</span><br></pre></td></tr></table></figure>

<p>第三步：全局异常中处理实体校验异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseStatus</span>(HttpStatus.UNAUTHORIZED)<span class="comment">//未授权</span></span><br><span class="line"><span class="meta">@ExceptionHandler</span>(value = MethodArgumentNotValidException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">Result</span> <span class="title">handler</span>(<span class="title">MethodArgumentNotValidException</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">    log.error(<span class="string">"实体校验异常:----------------&#123;&#125;"</span>,e);</span><br><span class="line">    ObjectError objectError = e.getBindingResult().getAllErrors().stream().findFirst().get();</span><br><span class="line">    <span class="keyword">return</span> Result.fail(objectError.getDefaultMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：使用postman测试下</p>
<p>实体校验出现异常时：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/5lO1vaIVTQBjkxq.png" alt="image-20200611151212054"></p>
<p>实体校验成功时：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/NmHfPayWdejLg7Z.png" alt="image-20200611151409504"></p>
<h4 id="8、解决跨域问题"><a href="#8、解决跨域问题" class="headerlink" title="8、解决跨域问题"></a>8、解决跨域问题</h4><p>因为是前后端分析，所以跨域问题是避免不了的，我们直接在后台进行全局跨域处理：</p>
<p>第一步：跨域配置CorsConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解决跨域问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">"/**"</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">                .allowedMethods(<span class="string">"GET"</span>, <span class="string">"HEAD"</span>, <span class="string">"POST"</span>, <span class="string">"PUT"</span>, <span class="string">"DELETE"</span>, <span class="string">"OPTIONS"</span>)</span><br><span class="line">                .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">                .maxAge(<span class="number">3600</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">"*"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步：在jwtfilter中提供跨域的支持</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对跨域提供支持</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    HttpServletRequest httpServletRequest = WebUtils.toHttp(request);</span><br><span class="line">    HttpServletResponse httpServletResponse = WebUtils.toHttp(response);</span><br><span class="line">    httpServletResponse.setHeader(<span class="string">"Access-control-Allow-Origin"</span>, httpServletRequest.getHeader(<span class="string">"Origin"</span>));</span><br><span class="line">    httpServletResponse.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"GET,POST,OPTIONS,PUT,DELETE"</span>);</span><br><span class="line">    httpServletResponse.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>, httpServletRequest.getHeader(<span class="string">"Access-Control-Request-Headers"</span>));</span><br><span class="line">    <span class="comment">// 跨域时会首先发送一个OPTIONS请求，这里我们给OPTIONS请求直接返回正常状态</span></span><br><span class="line">    <span class="keyword">if</span> (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class="line">        httpServletResponse.setStatus(org.springframework.http.HttpStatus.OK.value());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="9、登陆接口开发"><a href="#9、登陆接口开发" class="headerlink" title="9、登陆接口开发"></a>9、登陆接口开发</h4><p>登录的逻辑其实很简答，只需要接受账号密码，然后把用户的id生成jwt，返回给前段，为了后续的jwt的延期，所以我们把jwt放在header上。具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.map.MapUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.crypto.SecureUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.ryan.common.dto.LoginDto;</span><br><span class="line"><span class="keyword">import</span> com.ryan.common.lang.Result;</span><br><span class="line"><span class="keyword">import</span> com.ryan.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.ryan.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.ryan.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.security.SecurityUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.annotation.RequiresAuthentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 默认账号密码：ryan / 111111</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">login</span><span class="params">(@Validated @RequestBody LoginDto loginDto, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">        <span class="comment">//1.用户名验证</span></span><br><span class="line">        User user = userService.getOne(<span class="keyword">new</span> QueryWrapper&lt;User&gt;().eq(<span class="string">"username"</span>, loginDto.getUsername()));</span><br><span class="line">        <span class="comment">//断言username不为空</span></span><br><span class="line">        Assert.notNull(user, <span class="string">"用户不存在"</span>);</span><br><span class="line">        <span class="comment">//2.密码验证</span></span><br><span class="line">        <span class="keyword">if</span>(!user.getPassword().equals(SecureUtil.md5(loginDto.getPassword())))&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">"密码不正确"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.生成jwt并放到header当中</span></span><br><span class="line">        String jwt = jwtUtils.generateToken(user.getId());</span><br><span class="line">        response.setHeader(<span class="string">"Authorization"</span>,jwt);</span><br><span class="line">        response.setHeader(<span class="string">"Access-control-Expose-Header"</span>,<span class="string">"Authorization"</span>);</span><br><span class="line">        <span class="comment">//4.返回用户信息</span></span><br><span class="line">        <span class="keyword">return</span> Result.success(MapUtil.builder()</span><br><span class="line">                .put(<span class="string">"id"</span>,user.getId())</span><br><span class="line">                .put(<span class="string">"username"</span>,user.getUsername())</span><br><span class="line">                .put(<span class="string">"avatar"</span>,user.getAvatar())</span><br><span class="line">                .put(<span class="string">"email"</span>,user.getEmail())</span><br><span class="line">                .map()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequiresAuthentication</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/logout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">logout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SecurityUtils.getSubject().logout();</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Assert.notNull(user, “用户不存在”);执行可能会抛出异常，需要在全局异常中处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseStatus</span>(HttpStatus.UNAUTHORIZED)<span class="comment">//未授权</span></span><br><span class="line"><span class="meta">@ExceptionHandler</span>(value = IllegalArgumentException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">Result</span> <span class="title">handler</span>(<span class="title">IllegalArgumentException</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">    log.error(<span class="string">"Assert异常:----------------&#123;&#125;"</span>,e);</span><br><span class="line">    <span class="keyword">return</span> Result.fail(e.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>10、博客接口开发</p>
<p>我们的骨架已经完成，接下来，我们就可以添加我们的业务接口了，下面我以一个简单的博客列表、博客详情页、博客编辑/新增、博客删除为例子开发：</p>
<p>第一步：写一个工具类ShiroUtil</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ryan.shiro.AccountProfile;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AccountProfile <span class="title">getProfile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (AccountProfile) SecurityUtils.getSubject().getPrincipal();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步：接口开发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ryan.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.ryan.common.lang.Result;</span><br><span class="line"><span class="keyword">import</span> com.ryan.entity.Blog;</span><br><span class="line"><span class="keyword">import</span> com.ryan.service.BlogService;</span><br><span class="line"><span class="keyword">import</span> com.ryan.utils.ShiroUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.annotation.RequiresAuthentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *  前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Ryan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-06-11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//详情（list）、detail（通过id）、编辑/新建、删除</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BlogService blogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/blogs"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">list</span><span class="params">(@RequestParam(defaultValue = <span class="string">"1"</span>)</span> Integer currentPage)</span>&#123;<span class="comment">//默认是第一页，确保不是空</span></span><br><span class="line">        Page page = <span class="keyword">new</span> Page(currentPage, <span class="number">5</span>);<span class="comment">//每页5条记录</span></span><br><span class="line">        IPage pageData = blogService.page(page, <span class="keyword">new</span> QueryWrapper&lt;Blog&gt;().orderByDesc(<span class="string">"created"</span>));</span><br><span class="line">        <span class="keyword">return</span> Result.success(pageData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/blog/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">detail</span><span class="params">(@PathVariable(value = <span class="string">"id"</span>)</span>Long id)</span>&#123;</span><br><span class="line">        Blog blog = blogService.getById(id);</span><br><span class="line">        <span class="comment">//blog不应该为空</span></span><br><span class="line">        Assert.notNull(blog, <span class="string">"该博客不存在或已被删除"</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.success(blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequiresAuthentication</span><span class="comment">//需要认证才能编辑</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/blog/edit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">edit</span><span class="params">(@Validated @RequestBody Blog blog)</span></span>&#123;</span><br><span class="line">        <span class="comment">//分为两种情况，编辑已有博客和新建博客</span></span><br><span class="line">        Blog temp = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(blog.getId() != <span class="keyword">null</span>)&#123;<span class="comment">//表示编辑已有博客</span></span><br><span class="line">            temp = blogService.getById(blog.getId());</span><br><span class="line">            <span class="comment">//注意，只能编辑自己的博客</span></span><br><span class="line">            Assert.isTrue(temp.getUserId().longValue() == ShiroUtil.getProfile().getId().longValue(), <span class="string">"抱歉，没有权限编辑他人的博客"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">//表示新建博客</span></span><br><span class="line">            temp = <span class="keyword">new</span> Blog();</span><br><span class="line">            temp.setUserId(ShiroUtil.getProfile().getId());</span><br><span class="line">            temp.setCreated(LocalDateTime.now());</span><br><span class="line">            temp.setStatus(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        BeanUtil.copyProperties(blog, temp, <span class="string">"id"</span>,<span class="string">"userId"</span>,<span class="string">"created"</span>,<span class="string">"status"</span>);</span><br><span class="line">        blogService.saveOrUpdate(temp);</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/blog/remove/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">delete</span><span class="params">(@PathVariable(value = <span class="string">"id"</span>)</span>Long id)</span>&#123;</span><br><span class="line">        blogService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：略</p>
<h2 id="前端技术栈："><a href="#前端技术栈：" class="headerlink" title="前端技术栈："></a>前端技术栈：</h2><ul>
<li>vue</li>
<li>element ui</li>
<li>axios</li>
<li>mavon-editor</li>
<li>markdown-it</li>
<li>github-markdown-css</li>
</ul>
<h3 id="前端开发步骤："><a href="#前端开发步骤：" class="headerlink" title="前端开发步骤："></a>前端开发步骤：</h3><h4 id="1、环境搭建"><a href="#1、环境搭建" class="headerlink" title="1、环境搭建"></a>1、环境搭建</h4><p>1.1、node.js：之前都安装过了，这里就不演示了</p>
<p>1.2、vue cli：为了vue可视化操作，我这里升级了vue3.6.3的版本，注意是3.6+的版本，不然会踩到一些坑，然后控制台输入vue cli即可弹出vue的可视化界面，在工程根目录下新建一个vueblog-vue项目</p>
<p>1.3、下一步中，项目文件夹中输入项目名称“vueblog-vue”，其他不用改，点击下一步，选择【手动】，再点击下一步，如图点击按钮，勾选上路由Router、状态管理Vuex，去掉js的校验。</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/NOqCHQb3vo8f5ah.png" alt="image-20200612172536970"></p>
<p>下一步中，也选上【Use history mode for router】，点击创建项目，然后弹窗中选择按钮【创建项目，不保存预设】，就进入项目创建啦。</p>
<p>稍等片刻之后，项目就初始化完成了。上面的步骤中，我们创建了一个vue项目，并且安装了Router、Vuex。这样我们后面就可以直接使用。</p>
<p>1.4、安装element-ui：略</p>
<p>1.5、安装axios：略</p>
<h4 id="2、页面路由"><a href="#2、页面路由" class="headerlink" title="2、页面路由"></a>2、页面路由</h4><p>接下来，我们先定义好路由和页面，因为我们只是做一个简单的博客项目，页面比较少，所以我们可以直接先定义好，然后在慢慢开发，这样需要用到链接的地方我们就可以直接可以使用：</p>
<p>我们在views文件夹下定义几个页面：</p>
<ul>
<li>BlogDetail.vue（博客详情页）</li>
<li>BlogEdit.vue（编辑博客）</li>
<li>Blogs.vue（博客列表）</li>
<li>Login.vue（登录页面）</li>
</ul>
<p>然后在路由中心配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">"../views/Login"</span>;</span><br><span class="line"><span class="keyword">import</span> Blogs <span class="keyword">from</span> <span class="string">"../views/Blogs"</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">"../views/Detail"</span>;</span><br><span class="line"><span class="keyword">import</span> Edit <span class="keyword">from</span> <span class="string">"../views/Edit"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    name: <span class="string">'index'</span>,</span><br><span class="line">    component: Blogs</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    path: <span class="string">'/login'</span>,</span><br><span class="line">    name: <span class="string">'Login'</span>,</span><br><span class="line">    component: Login</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    path: <span class="string">'/blogs'</span>,</span><br><span class="line">    name: <span class="string">'Blogs'</span>,</span><br><span class="line">    component: Blogs</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    path: <span class="string">'/blog/add'</span>,</span><br><span class="line">    name: <span class="string">'Add'</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      requireAuth: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    component: Edit</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">  path: <span class="string">'/blog/:blogId/detail'</span>,</span><br><span class="line">  name: <span class="string">'Detail'</span>,</span><br><span class="line">  component: Detail</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">  path: <span class="string">'/blog/:blogId/edit'</span>,</span><br><span class="line">  name: <span class="string">'Edit'</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      requireAuth: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">  component: Edit</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  base: process.env.BASE_URL,</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<p>接下来我们去开发我们的页面。其中，带有meta：requireAuth: true说明是需要登录字后才能访问的受限资源，后面我们路由权限拦截时候会用到。</p>
<h4 id="3、登陆页面"><a href="#3、登陆页面" class="headerlink" title="3、登陆页面"></a>3、登陆页面</h4><p>Login.vue</p>
<p>接下来，我们来搞一个登陆页面，表单组件我们直接在element-ui的官网上找就行了，登陆页面就两个输入框和一个提交按钮，相对简单，然后我们最好带页面的js校验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;el-container&gt;</span><br><span class="line">            &lt;el-header&gt;</span><br><span class="line">                &lt;img class&#x3D;&quot;logo&quot; src&#x3D;&quot;https:&#x2F;&#x2F;www.markerhub.com&#x2F;dist&#x2F;images&#x2F;logo&#x2F;markerhub-logo.png&quot; alt&#x3D;&quot;&quot;&gt;</span><br><span class="line">            &lt;&#x2F;el-header&gt;</span><br><span class="line">            &lt;el-main&gt;</span><br><span class="line">                &lt;el-form :model&#x3D;&quot;ruleForm&quot; :rules&#x3D;&quot;rules&quot; ref&#x3D;&quot;ruleForm&quot; label-width&#x3D;&quot;100px&quot; class&#x3D;&quot;demo-ruleForm&quot;&gt;</span><br><span class="line">                    &lt;el-form-item label&#x3D;&quot;用户名&quot; prop&#x3D;&quot;username&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model&#x3D;&quot;ruleForm.username&quot;&gt;&lt;&#x2F;el-input&gt;</span><br><span class="line">                    &lt;&#x2F;el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label&#x3D;&quot;密码&quot; prop&#x3D;&quot;password&quot;&gt;</span><br><span class="line">                        &lt;el-input type&#x3D;&quot;password&quot; v-model&#x3D;&quot;ruleForm.password&quot;&gt;&lt;&#x2F;el-input&gt;</span><br><span class="line">                    &lt;&#x2F;el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item&gt;</span><br><span class="line">                        &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;submitForm(&#39;ruleForm&#39;)&quot;&gt;立即登录&lt;&#x2F;el-button&gt;</span><br><span class="line">                        &lt;el-button @click&#x3D;&quot;resetForm(&#39;ruleForm&#39;)&quot;&gt;重置&lt;&#x2F;el-button&gt;</span><br><span class="line">                    &lt;&#x2F;el-form-item&gt;</span><br><span class="line">                &lt;&#x2F;el-form&gt;</span><br><span class="line">            &lt;&#x2F;el-main&gt;</span><br><span class="line">        &lt;&#x2F;el-container&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;Login&quot;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                ruleForm: &#123;</span><br><span class="line">                    username: &#39;ryan&#39;,</span><br><span class="line">                    password: &#39;111111&#39;</span><br><span class="line">                &#125;,</span><br><span class="line">                rules: &#123;</span><br><span class="line">                    username: [</span><br><span class="line">                        &#123; required: true, message: &#39;请输入用户名&#39;, trigger: &#39;blur&#39; &#125;,</span><br><span class="line">                        &#123; min: 3, max: 15, message: &#39;长度在 3 到 15 个字符&#39;, trigger: &#39;blur&#39; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    password: [</span><br><span class="line">                        &#123; required: true, message: &#39;请输入密码&#39;, trigger: &#39;change&#39; &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            submitForm(formName) &#123;</span><br><span class="line">                this.$refs[formName].validate((valid) &#x3D;&gt; &#123;</span><br><span class="line">                    if (valid) &#123;</span><br><span class="line">                        const _this &#x3D; this;&#x2F;&#x2F;全局this对象</span><br><span class="line">                        &#x2F;&#x2F;为了降低耦合度，我们可全局配置url前缀</span><br><span class="line">                        this.axios.post(&quot;&#x2F;login&quot;, this.ruleForm).then(response &#x3D;&gt; &#123;</span><br><span class="line">                            const jwt &#x3D; response.headers[&quot;authorization&quot;]</span><br><span class="line">                            const userInfo &#x3D; response.data.data</span><br><span class="line">							&#x2F;&#x2F;将token和用户信息存储起来，方便在其他地方用到（获取、认证等）</span><br><span class="line">                            _this.$store.commit(&quot;SET_TOKEN&quot;, jwt)</span><br><span class="line">                            _this.$store.commit(&quot;SET_USERINFO&quot;, userInfo)</span><br><span class="line"></span><br><span class="line">                            _this.$router.push(&quot;&#x2F;blogs&quot;)</span><br><span class="line">                            &#x2F;&#x2F;这是用户名密码正确的情况下的逻辑</span><br><span class="line">                            &#x2F;&#x2F;如果出现错误，我们应该弹窗才行，也就是拦截，不走这个逻辑，我们另外新建一个配置即可</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        console.log(&#39;error submit!!&#39;);</span><br><span class="line">                        return false;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            resetForm(formName) &#123;</span><br><span class="line">                this.$refs[formName].resetFields();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .logo&#123;</span><br><span class="line">        height: 60px;</span><br><span class="line">    &#125;</span><br><span class="line">    .el-header, .el-footer &#123;</span><br><span class="line">        background-color: #B3C0D1;</span><br><span class="line">        color: #333;</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 60px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .el-aside &#123;</span><br><span class="line">        background-color: #D3DCE6;</span><br><span class="line">        color: #333;</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 200px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .el-main &#123;</span><br><span class="line">        &#x2F;*background-color: #E9EEF3;*&#x2F;</span><br><span class="line">        color: #333;</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 160px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .demo-ruleForm &#123;</span><br><span class="line">        max-width: 500px;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    body &gt; .el-container &#123;</span><br><span class="line">        margin-bottom: 40px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .el-container:nth-child(5) .el-aside,</span><br><span class="line">    .el-container:nth-child(6) .el-aside &#123;</span><br><span class="line">        line-height: 260px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .el-container:nth-child(7) .el-aside &#123;</span><br><span class="line">        line-height: 320px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p>上面的代码主要做了两件事情：</p>
<ul>
<li>表单验证</li>
<li>登陆按钮点击登陆时间</li>
</ul>
<p>表单校验规则还好，比较固定写法，查一下element-ui的组件就知道了，我们来分析一下发起登录之后的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_this.$store.commit(&quot;SET_TOKEN&quot;, jwt)</span><br><span class="line">_this.$store.commit(&quot;SET_USERINFO&quot;, userInfo)</span><br><span class="line"></span><br><span class="line">_this.$router.push(&quot;&#x2F;blogs&quot;)</span><br></pre></td></tr></table></figure>

<p>从返回的结果请求头中获取到token的信息，然后使用store提交token和用户信息的状态。完成操作之后，我们调整到了/blogs路由，即博客列表页面。</p>
<h5 id="3-1、token状态同步"><a href="#3-1、token状态同步" class="headerlink" title="3.1、token状态同步"></a>3.1、token状态同步</h5><p>需要在store/index.js中配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    token: <span class="string">""</span>,</span><br><span class="line">    userInfo: <span class="built_in">JSON</span>.parse(sessionStorage.getItem(<span class="string">"userInfo"</span>))<span class="comment">//反序列化</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">//相当于setter</span></span><br><span class="line">    SET_TOKEN: <span class="function">(<span class="params">state, token</span>) =&gt;</span> &#123;</span><br><span class="line">      state.token = token</span><br><span class="line">      localStorage.setItem(<span class="string">"token"</span>, token)</span><br><span class="line">    &#125;,</span><br><span class="line">    SET_USERINFO: <span class="function">(<span class="params">state, userInfo</span>) =&gt;</span> &#123;</span><br><span class="line">      state.userInfo = userInfo</span><br><span class="line">      sessionStorage.setItem(<span class="string">"userInfo"</span>, <span class="built_in">JSON</span>.stringify(userInfo))</span><br><span class="line">      <span class="comment">//说明：JSON.stringify()的作用是将 JavaScript 对象转换为 JSON 字符串，而JSON.parse()可以将JSON字符串转为一个对象。</span></span><br><span class="line">    &#125;,</span><br><span class="line">    REMOVE_INFO: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      state.token = <span class="string">""</span></span><br><span class="line">      state.userInfo = &#123;&#125;</span><br><span class="line">      localStorage.setItem(<span class="string">"token"</span>,<span class="string">""</span>)</span><br><span class="line">      sessionStorage.setItem(<span class="string">"userInfo"</span>, <span class="built_in">JSON</span>.stringify(<span class="string">""</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    <span class="comment">//getter</span></span><br><span class="line">    getUser: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.userInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>存储token，我们用的是localStorage，存储用户信息，我们用的是sessionStorage。毕竟用户信息我们不需要长久保存，保存了token信息，我们随时都可以初始化用户信息。</p>
<h5 id="3-2、定义全局axios拦截器"><a href="#3-2、定义全局axios拦截器" class="headerlink" title="3.2、定义全局axios拦截器"></a>3.2、定义全局axios拦截器</h5><p>点击登录按钮发起登录请求，成功时候返回了数据，如果是密码错误，我们是不是也应该弹窗消息提示。为了让这个错误弹窗能运用到所有的地方，所以我对axios做了个后置拦截器，就是返回数据时候，如果结果的code或者status不正常，那么我对应弹窗提示。</p>
<p>src目录下新建一个axios.js文件（与main.js同级）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">'element-ui'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store"</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">"./router"</span>;</span><br><span class="line"><span class="comment">//url前缀</span></span><br><span class="line">axios.defaults.baseURL = <span class="string">"http://localhost:8001"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//前置拦截</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//后置拦截</span></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> res = response.data;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"=========================="</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"=========================="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res.code === <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;<span class="comment">//这是针对shiroException的情况，其他的属于报错了</span></span><br><span class="line">        <span class="comment">//因为此axios是要挂载到main.js中的，所以这里不能使用this.$message</span></span><br><span class="line">        ElementUI.Message.error(<span class="string">'密码错误，请重新输入'</span>, &#123;<span class="attr">duration</span>: <span class="number">3</span>*<span class="number">1000</span>&#125;);<span class="comment">//弹窗3秒后消失</span></span><br><span class="line">        <span class="comment">//同时我们要拦截Login.vue中的正确逻辑,并弹窗</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(response.data.msg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">    <span class="keyword">if</span>(error.response.data)&#123;<span class="comment">//当返回的数据不为空的时候，就将msg赋值给error的message，给下面的弹窗使用</span></span><br><span class="line">    error.message = error.response.data.msg</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//报错的话我们应该重新跳转到登陆界面</span></span><br><span class="line">    <span class="keyword">if</span>(error.response.status === <span class="number">401</span>)&#123;</span><br><span class="line">    <span class="comment">//先清楚token和userInfo</span></span><br><span class="line">    store.commit(<span class="string">'REMOVE_INFO'</span>);<span class="comment">//注意store不要导错包了</span></span><br><span class="line">    router.push(<span class="string">"/login"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//除了401，我们直接弹窗即可</span></span><br><span class="line">    ElementUI.Message.error(error.message, &#123;<span class="attr">duration</span>: <span class="number">3</span>*<span class="number">1000</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>前置拦截，其实可以统一为所有需要权限的请求装配上header的token信息，这样不需要在使用是再配置，我的小项目比较小，所以，还是免了吧~</p>
<p>然后再main.js中导入axios.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./axios.js'</span> <span class="comment">// 请求拦截</span></span><br></pre></td></tr></table></figure>

<p>后端因为返回的实体是Result，success时候code为200，fail时候返回的是400，所以可以根据这里判断结果是否是正常的。另外权限不足时候可以通过请求结果的状态码来判断结果是否正常。这里都做了简单的处理。</p>
<h4 id="4、博客列表"><a href="#4、博客列表" class="headerlink" title="4、博客列表"></a>4、博客列表</h4><p>登录完成之后直接进入博客列表页面，然后加载博客列表的数据渲染出来。同时页面头部我们需要把用户的信息展示出来，因为很多地方都用到这个模块，所以我们把页面头部的用户信息单独抽取出来作为一个组件。</p>
<h5 id="4-1、头部用户信息"><a href="#4-1、头部用户信息" class="headerlink" title="4.1、头部用户信息"></a>4.1、头部用户信息</h5><p>那么，我们先来完成头部的用户信息，应该包含三部分信息：id，头像、用户名，而这些信息我们是在登录之后就已经存在了sessionStorage。因此，我们可以通过store的getters获取到用户信息。</p>
<p>在component文件夹中新建Header.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;m-content&quot;&gt;</span><br><span class="line">        &lt;h3&gt;欢迎来到Ryan的博客&lt;&#x2F;h3&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;block&quot;&gt;</span><br><span class="line">            &lt;el-avatar :size&#x3D;&quot;50&quot; :src&#x3D;&quot;user.avatar&quot;&gt;&lt;&#x2F;el-avatar&gt;</span><br><span class="line">            &lt;div&gt;&#123;&#123;user.username&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;maction&quot;&gt;</span><br><span class="line">            &lt;span&gt;&lt;el-link href&#x3D;&quot;&#x2F;blogs&quot;&gt;主页&lt;&#x2F;el-link&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;el-divider direction&#x3D;&quot;vertical&quot;&gt;&lt;&#x2F;el-divider&gt;</span><br><span class="line">            &lt;span&gt;&lt;el-link href&#x3D;&quot;&#x2F;blog&#x2F;add&quot; type&#x3D;&quot;success&quot;&gt;编写博客&lt;&#x2F;el-link&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;!--根据是否登陆显示其中一个按钮--&gt;</span><br><span class="line">            &lt;el-divider direction&#x3D;&quot;vertical&quot;&gt;&lt;&#x2F;el-divider&gt;</span><br><span class="line">            &lt;span v-show&#x3D;&quot;!hasLogin&quot;&gt;&lt;el-link href&#x3D;&quot;&#x2F;login&quot; type&#x3D;&quot;primary&quot;&gt;登陆&lt;&#x2F;el-link&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;span v-show&#x3D;&quot;hasLogin&quot;&gt;&lt;el-link @click&#x3D;&quot;logout&quot; type&#x3D;&quot;danger&quot;&gt;退出&lt;&#x2F;el-link&gt;&lt;&#x2F;span&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;Header&quot;,</span><br><span class="line">        data()&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                user: &#123;</span><br><span class="line">                    username: &quot;请先登录&quot;,</span><br><span class="line">                    avatar: &quot;https:&#x2F;&#x2F;cube.elemecdn.com&#x2F;3&#x2F;7c&#x2F;3ea6beec64369c2642b92c6726f1epng.png&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                hasLogin: false&#x2F;&#x2F;默认为false</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            logout()&#123;</span><br><span class="line">                &#x2F;&#x2F;访问后端logout（清除信息）</span><br><span class="line">                const _this &#x3D; this</span><br><span class="line">                _this.axios.get(&quot;&#x2F;logout&quot;,&#123;</span><br><span class="line">                    headers: &#123;&#x2F;&#x2F;因为后端logout需要认证才能访问，所以需要携带token访问</span><br><span class="line">                        &quot;Authorization&quot;: localStorage.getItem(&quot;token&quot;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then(res &#x3D;&gt; &#123;</span><br><span class="line">                    &#x2F;&#x2F;删除存储在浏览器的相关信息</span><br><span class="line">                    _this.$store.commit(&quot;REMOVE_INFO&quot;)</span><br><span class="line">                    &#x2F;&#x2F;然后跳转到登陆页面</span><br><span class="line">                    _this.$router.push(&quot;&#x2F;login&quot;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F;信息回显，也就是header页面创建的时候就拉去相关信息（created钩子函数）</span><br><span class="line">        created() &#123;</span><br><span class="line">            if(this.$store.getters.getUser.username)&#123;&#x2F;&#x2F;表明已经登陆</span><br><span class="line">                this.user.username &#x3D; this.$store.getters.getUser.username</span><br><span class="line">                this.user.avatar &#x3D; this.$store.getters.getUser.avatar</span><br><span class="line">                &#x2F;&#x2F;此时hasLogin应为true</span><br><span class="line">                this.hasLogin &#x3D; true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">     .m-content&#123;</span><br><span class="line">         max-width: 960px;</span><br><span class="line">         margin: 0 auto;</span><br><span class="line">         text-align: center;</span><br><span class="line">     &#125;</span><br><span class="line">    .maction&#123;</span><br><span class="line">        margin: 10px 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p>然后需要头部用户信息的页面只需要几个步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import Header from &quot;@&#x2F;components&#x2F;Header&quot;;</span><br><span class="line">data() &#123;</span><br><span class="line">  components: &#123;Header&#125;</span><br><span class="line">&#125;</span><br><span class="line"># 然后模板中调用组件</span><br><span class="line">&lt;Header&gt;&lt;&#x2F;Header&gt;</span><br></pre></td></tr></table></figure>

<h5 id="4-2、博客分页"><a href="#4-2、博客分页" class="headerlink" title="4.2、博客分页"></a>4.2、博客分页</h5><p>接下来就是列表页面，需要做分页，列表我们在element-ui中直接使用<strong>时间线</strong>组件来作为我们的列表样式，还是挺好看的。还有我们的分页组件。</p>
<p>需要几部分信息：</p>
<ul>
<li>分页信息</li>
<li>博客列表内容，包括id、标题、摘要、创建时间</li>
</ul>
<p>Blogs.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Header&gt;&lt;&#x2F;Header&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;block&quot;&gt;</span><br><span class="line">            &lt;el-timeline&gt;</span><br><span class="line">                &lt;!--for循环遍历博客，绑定相关值，时间格式可以在后端的实体类中定义--&gt;</span><br><span class="line">                &lt;el-timeline-item :timestamp&#x3D;&quot;blog.created&quot; placement&#x3D;&quot;top&quot; v-for&#x3D;&quot;blog in blogs&quot;&gt;</span><br><span class="line">                    &lt;el-card&gt;</span><br><span class="line">                        &lt;h4&gt;</span><br><span class="line">                            &lt;router-link :to&#x3D;&quot;&#123;name:&#39;Detail&#39;, params:&#123;blogId: blog.id&#125;&#125;&quot;&gt;</span><br><span class="line">                                &#123;&#123;blog.title&#125;&#125;</span><br><span class="line">                            &lt;&#x2F;router-link&gt;</span><br><span class="line">                        &lt;&#x2F;h4&gt;</span><br><span class="line">                        &lt;p&gt;&#123;&#123;blog.description&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">                    &lt;&#x2F;el-card&gt;</span><br><span class="line">                &lt;&#x2F;el-timeline-item&gt;</span><br><span class="line">            &lt;&#x2F;el-timeline&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;!--分页组件--&gt;</span><br><span class="line">        &lt;el-pagination class&#x3D;&quot;mpage&quot;</span><br><span class="line">                background</span><br><span class="line">                layout&#x3D;&quot;prev, pager, next&quot;</span><br><span class="line">                :total&#x3D;&quot;total&quot;</span><br><span class="line">                :page-size&#x3D;&quot;pageSize&quot;</span><br><span class="line">                :current-page&#x3D;&quot;currentPage&quot;</span><br><span class="line">                @current-change&#x3D;page&gt;</span><br><span class="line">        &lt;&#x2F;el-pagination&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import Header from &quot;..&#x2F;components&#x2F;Header&quot;;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;Blogs&quot;,</span><br><span class="line">        components: &#123;Header&#125;,</span><br><span class="line">        data()&#123;</span><br><span class="line">            return&#123;</span><br><span class="line">                blogs: &#123;&#125;,</span><br><span class="line">                currentPage: 1,</span><br><span class="line">                total: 0,</span><br><span class="line">                pageSize: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            page(currentPage)&#123;</span><br><span class="line">                const _this &#x3D; this;</span><br><span class="line">                _this.axios.get(&quot;&#x2F;blogs?currentPage&#x3D;&quot; + currentPage).then(res &#x3D;&gt; &#123;</span><br><span class="line">                    console.log(res)</span><br><span class="line">                    &#x2F;&#x2F;然后进行赋值，相关数据都可以在浏览器抓包的响应体中看到</span><br><span class="line">                    _this.blogs &#x3D; res.data.data.records;</span><br><span class="line">                    _this.currentPage &#x3D; res.data.data.current;</span><br><span class="line">                    _this.total &#x3D; res.data.data.total;</span><br><span class="line">                    _this.pageSize &#x3D; res.data.data.size;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        created(currentPage) &#123;</span><br><span class="line">            &#x2F;&#x2F;一开始渲染的时候就调用page方法,默认第1页</span><br><span class="line">            this.page(1)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .mpage&#123;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p>data()中直接定义博客列表blogs、以及一些分页信息。methods()中定义分页的调用接口page（currentPage），参数是需要调整的页码currentPage，得到结果之后直接赋值即可。然后初始化时候，直接在mounted()方法中调用第一页this.page(1)。</p>
<h4 id="5、博客编辑"><a href="#5、博客编辑" class="headerlink" title="5、博客编辑"></a>5、博客编辑</h4><p>我们点击发表博客链接调整到/blog/add页面，这里我们需要用到一个markdown编辑器，在vue组件中，比较好用的是mavon-editor，那么我们直接使用哈。先来安装mavon-editor相关组件：</p>
<p>安装mavon-editor</p>
<p>基于Vue的markdown编辑器mavon-editor</p>
<p><code>npm install mavon-editor --save</code></p>
<p>然后在main.js中全局注册:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mavonEditor <span class="keyword">from</span> <span class="string">'mavon-editor'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'mavon-editor/dist/css/index.css'</span></span><br><span class="line">Vue.use(mavonEditor);</span><br></pre></td></tr></table></figure>

<p>ok，那么我们去定义我们的博客表单：</p>
<p>Edit.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Header&gt;&lt;&#x2F;Header&gt;</span><br><span class="line">        &lt;el-form :model&#x3D;&quot;ruleForm&quot; :rules&#x3D;&quot;rules&quot; ref&#x3D;&quot;ruleForm&quot; label-width&#x3D;&quot;100px&quot; class&#x3D;&quot;demo-ruleForm&quot;&gt;</span><br><span class="line">            &lt;el-form-item label&#x3D;&quot;标题&quot; prop&#x3D;&quot;title&quot;&gt;</span><br><span class="line">                &lt;el-input v-model&#x3D;&quot;ruleForm.title&quot;&gt;&lt;&#x2F;el-input&gt;</span><br><span class="line">            &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item label&#x3D;&quot;标题&quot; prop&#x3D;&quot;description&quot;&gt;</span><br><span class="line">                &lt;el-input v-model&#x3D;&quot;ruleForm.description&quot;&gt;&lt;&#x2F;el-input&gt;</span><br><span class="line">            &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--文本编辑器--&gt;</span><br><span class="line">            &lt;el-form-item label&#x3D;&quot;内容&quot; prop&#x3D;&quot;content&quot;&gt;</span><br><span class="line">                &lt;mavon-editor v-model&#x3D;&quot;ruleForm.content&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item class&#x3D;&quot;msubmit&quot;&gt;</span><br><span class="line">                &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;submitForm(&#39;ruleForm&#39;)&quot;&gt;提交&lt;&#x2F;el-button&gt;</span><br><span class="line">                &lt;el-button @click&#x3D;&quot;resetForm(&#39;ruleForm&#39;)&quot;&gt;清空&lt;&#x2F;el-button&gt;</span><br><span class="line">            &lt;&#x2F;el-form-item&gt;</span><br><span class="line">        &lt;&#x2F;el-form&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import Header from &quot;..&#x2F;components&#x2F;Header&quot;;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;Edit&quot;,</span><br><span class="line">        components: &#123;Header&#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                ruleForm: &#123;</span><br><span class="line">                    id: null,</span><br><span class="line">                    title: &#39;&#39;,</span><br><span class="line">                    description: &#39;&#39;,</span><br><span class="line">                    content: &#39;&#39;,</span><br><span class="line">                &#125;,</span><br><span class="line">                rules: &#123;</span><br><span class="line">                    title: [</span><br><span class="line">                        &#123; required: true, message: &#39;请输入标题&#39;, trigger: &#39;blur&#39; &#125;,</span><br><span class="line">                        &#123; min: 3, max: 15, message: &#39;长度在 3 到 15 个字符&#39;, trigger: &#39;blur&#39; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    description: [</span><br><span class="line">                        &#123; required: true, message: &#39;请输入摘要&#39;, trigger: &#39;blur&#39; &#125;,</span><br><span class="line">                        &#123; min: 3, max: 25, message: &#39;长度在 3 到 25 个字符&#39;, trigger: &#39;blur&#39; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    content: [</span><br><span class="line">                        &#123; required: true,  trigger: &#39;blur&#39; &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            submitForm(formName) &#123;</span><br><span class="line">                this.$refs[formName].validate((valid) &#x3D;&gt; &#123;</span><br><span class="line">                    if (valid) &#123;</span><br><span class="line">                        const _this &#x3D; this;</span><br><span class="line">                        this.axios.post(&quot;&#x2F;blog&#x2F;edit&quot;, this.ruleForm, &#123;&#x2F;&#x2F;内容是this.ruleForm(博客),然后需要携带令牌</span><br><span class="line">                            headers: &#123;&#x2F;&#x2F;因为后端logout需要认证才能访问，所以需要携带token访问</span><br><span class="line">                                &quot;Authorization&quot;: localStorage.getItem(&quot;token&quot;)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;).then(res &#x3D;&gt; &#123;&#x2F;&#x2F;弹窗提示，并跳转到博客列表页面</span><br><span class="line">                            this.$alert(&#39;提交成功&#39;, &#39;提醒&#39;, &#123;</span><br><span class="line">                                confirmButtonText: &#39;确定&#39;,</span><br><span class="line">                                callback: action &#x3D;&gt; &#123;</span><br><span class="line">                                    this.$router.push(&quot;&#x2F;blogs&quot;)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        console.log(&#39;error submit!!&#39;);</span><br><span class="line">                        return false;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            resetForm(formName) &#123;</span><br><span class="line">                this.$refs[formName].resetFields();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        created() &#123;&#x2F;&#x2F;消息回显</span><br><span class="line">            const blogId &#x3D; this.$route.params.blogId;</span><br><span class="line">            console.log(blogId);</span><br><span class="line">            const _this &#x3D; this;</span><br><span class="line">            if(blogId)&#123;&#x2F;&#x2F;通过id获取博客内容</span><br><span class="line">                this.axios.get(&quot;&#x2F;blog&#x2F;&quot; + blogId).then(res &#x3D;&gt; &#123;</span><br><span class="line">                    const blog &#x3D; res.data.data</span><br><span class="line">                    _this.ruleForm.id &#x3D; blog.id</span><br><span class="line">                    _this.ruleForm.title &#x3D; blog.title</span><br><span class="line">                    _this.ruleForm.description &#x3D; blog.description</span><br><span class="line">                    _this.ruleForm.content &#x3D; blog.content</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .msubmit&#123;</span><br><span class="line">        text-align: center;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p>逻辑依然简单，校验表单，然后点击按钮提交表单，注意头部加上Authorization信息，返回结果弹窗提示操作成功，然后跳转到博客列表页面。</p>
<p>然后因为编辑和添加是同一个页面，所以有了create()方法，比如从编辑连接/blog/7/edit中获取blogId为7的这个id。然后回显博客信息。获取方式是const blogId = this.$route.params.blogId。</p>
<p>对了，mavon-editor因为已经全局注册，所以我们直接使用组件即可：</p>
<h4 id="6、博客详情"><a href="#6、博客详情" class="headerlink" title="6、博客详情"></a>6、博客详情</h4><p>博客详情中需要回显博客信息，然后有个问题就是，后端传过来的是博客内容是markdown格式的内容，我们需要进行渲染然后显示出来，这里我们使用一个插件markdown-it，用于解析md文档，然后导入github-markdown-c，所谓md的样式。</p>
<p>方法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 用于解析md文档</span><br><span class="line">npm install markdown-it --save</span><br><span class="line"># md样式</span><br><span class="line">npm install github-markdown-css</span><br></pre></td></tr></table></figure>

<p>然后就可以在需要渲染的地方使用：</p>
<p>Detail.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Header&gt;&lt;&#x2F;Header&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;mblog&quot;&gt;</span><br><span class="line">            &lt;h2&gt;&#123;&#123;blog.title&#125;&#125;&lt;&#x2F;h2&gt;</span><br><span class="line">            &lt;el-link icon&#x3D;&quot;el-icon-edit&quot; v-show&#x3D;&quot;isOWnBlog&quot;&gt;</span><br><span class="line">                &lt;router-link :to&#x3D;&quot;&#123;name: &#39;Edit&#39;, params:&#123;blogId: blog.id&#125;&#125;&quot;&gt;编辑&lt;&#x2F;router-link&gt;</span><br><span class="line">            &lt;&#x2F;el-link&gt;</span><br><span class="line">            &lt;el-divider direction&#x3D;&quot;vertical&quot; &gt;&lt;&#x2F;el-divider&gt;</span><br><span class="line">            &lt;el-link icon&#x3D;&quot;el-icon-delete&quot; v-show&#x3D;&quot;isOWnBlog&quot; @click&#x3D;&quot;&quot;&gt;</span><br><span class="line">                &lt;el-button type&#x3D;&quot;text&quot; @click&#x3D;&quot;open&quot;&gt;删除&lt;&#x2F;el-button&gt;</span><br><span class="line">            &lt;&#x2F;el-link&gt;</span><br><span class="line">            &lt;el-divider&gt;&lt;&#x2F;el-divider&gt;</span><br><span class="line">            &lt;!--别忘了添加class&#x3D;&quot;markdown-body&quot;，否则没法渲染--&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;markdown-body&quot; v-html&#x3D;&quot;blog.content&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import Header from &quot;..&#x2F;components&#x2F;Header&quot;;</span><br><span class="line">    import &quot;github-markdown-css&#x2F;github-markdown.css&quot;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;Detail&quot;,</span><br><span class="line">        components: &#123;Header&#125;,</span><br><span class="line">        data()&#123;</span><br><span class="line">            return&#123;</span><br><span class="line">                blog : &#123;</span><br><span class="line">                    id : null,</span><br><span class="line">                    title: &quot;&quot;,</span><br><span class="line">                    description: &quot;&quot;,</span><br><span class="line">                    content: &quot;&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                isOWnBlog: false</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            open() &#123;</span><br><span class="line">                this.$confirm(&#39;确定要删除此条博客吗&#39;, &#39;提示&#39;, &#123;</span><br><span class="line">                    confirmButtonText: &#39;确定&#39;,</span><br><span class="line">                    cancelButtonText: &#39;取消&#39;,</span><br><span class="line">                    type: &#39;warning&#39;</span><br><span class="line">                &#125;).then(() &#x3D;&gt; &#123;</span><br><span class="line">                    const blogId &#x3D; this.$route.params.blogId;</span><br><span class="line">                    console.log(blogId);</span><br><span class="line">                    const _this &#x3D; this;</span><br><span class="line">                    if(blogId)&#123;</span><br><span class="line">                        this.axios.get(&quot;&#x2F;blog&#x2F;remove&#x2F;&quot; + blogId).then(res &#x3D;&gt; &#123;</span><br><span class="line">                            this.$alert(&#39;删除成功&#39;, &#39;提醒&#39;, &#123;</span><br><span class="line">                                confirmButtonText: &#39;确定&#39;,</span><br><span class="line">                                callback: action &#x3D;&gt; &#123;</span><br><span class="line">                                    this.$router.push(&quot;&#x2F;blogs&quot;);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        created() &#123;&#x2F;&#x2F;数据回显</span><br><span class="line">            const blogId &#x3D; this.$route.params.blogId;</span><br><span class="line">            console.log(blogId);</span><br><span class="line">            const _this &#x3D; this;</span><br><span class="line">            if(blogId)&#123;&#x2F;&#x2F;通过id获取博客内容</span><br><span class="line">                this.axios.get(&quot;&#x2F;blog&#x2F;&quot; + blogId).then(res &#x3D;&gt; &#123;</span><br><span class="line">                    const blog &#x3D; res.data.data;</span><br><span class="line">                    _this.blog.id &#x3D; blog.id;</span><br><span class="line">                    _this.blog.title &#x3D; blog.title;</span><br><span class="line">                    &#x2F;&#x2F;正文我们需要markdown解析，然后再使用github的css样式</span><br><span class="line">                    var MarkdownIt &#x3D; require(&#39;markdown-it&#39;);</span><br><span class="line">                    var md &#x3D; MarkdownIt();</span><br><span class="line">                    var result &#x3D; md.render(blog.content);</span><br><span class="line">                    _this.blog.content &#x3D; result</span><br><span class="line">                    _this.isOWnBlog &#x3D; (blog.userId &#x3D;&#x3D;&#x3D; _this.$store.getters.getUser.id)&#x2F;&#x2F;只有自己的博客才可以编辑，别人是编辑不了的</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .mblog &#123;</span><br><span class="line">        box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);</span><br><span class="line">        width: 100%;</span><br><span class="line">        min-height: 700px;</span><br><span class="line">        padding: 20px 15px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p>具体逻辑还是挺简单，初始化create()方法中调用getBlog()方法，请求博客详情接口，返回的博客详情content通过markdown-it工具进行渲染。同时还添加了“编辑”和“删除”两个按钮</p>
<p>别忘了导入github的样式哦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"github-markdown-css/github-markdown.css"</span></span><br></pre></td></tr></table></figure>

<p>另外标题下添加了个小小的编辑按钮，通过isOwnBlog （判断博文作者与登录用户是否同一人）来判断按钮是否显示出来。</p>
<h4 id="7、路由权限拦截"><a href="#7、路由权限拦截" class="headerlink" title="7、路由权限拦截"></a>7、路由权限拦截</h4><p>页面已经开发完毕之后，我们来控制一下哪些页面是需要登录之后才能跳转的，如果未登录访问就直接重定向到登录页面，因此我们在src目录下定义一个js文件：</p>
<p>permission.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">"./router"</span>;</span><br><span class="line"><span class="comment">// 路由判断登录 根据路由配置文件的参数</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.matched.some(<span class="function"><span class="params">record</span> =&gt;</span> record.meta.requireAuth)) &#123; <span class="comment">// 判断该路由是否需要登录权限</span></span><br><span class="line">        <span class="keyword">const</span> token = localStorage.getItem(<span class="string">"token"</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"------------"</span> + token)</span><br><span class="line">        <span class="keyword">if</span> (token) &#123; <span class="comment">// 判断当前的token是否存在 ； 登录存入的token</span></span><br><span class="line">            <span class="keyword">if</span> (to.path === <span class="string">'/login'</span>) &#123;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                next()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            next(&#123;</span><br><span class="line">                path: <span class="string">'/login'</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>通过之前我们再定义页面路由时候的的meta信息，指定requireAuth: true，需要登录才能访问，因此这里我们在每次路由之前（router.beforeEach）判断token的状态，觉得是否需要跳转到登录页面。</p>
<p>然后我们再main.js中import我们的permission.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./permission.js'</span> <span class="comment">// 路由拦截</span></span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ryan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/06/24/ringboot-vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/">http://yoursite.com/2020/06/24/ringboot-vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Ryan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue/">vue</a><a class="post-meta__tags" href="/tags/springboot/">springboot</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><button class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="wechat" onclick="window.open('/img/wechat.jpg')"/><div class="post-qr-code__desc">wechat</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/06/24/xo-github%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"><img class="prev-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hexo+github快速搭建个人博客系统</div></div></a></div><div class="next-post pull-right"><a href="/2020/06/24/bbitMQ%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/"><img class="next-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">RabbitMQ入门+整合springboot</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/07/04/学院实战day03—阿里云对象存储-niginx-easyexcel-课程分类模块开发/" title="谷粒学院实战day03—阿里云对象存储+niginx+easyexcel+课程分类模块开发"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-04</div><div class="relatedPosts_title">谷粒学院实战day03—阿里云对象存储+niginx+easyexcel+课程分类模块开发</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/06/粒学院实战day04—课程管理开发-1/" title="谷粒学院实战day04—课程管理开发(1)"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-06</div><div class="relatedPosts_title">谷粒学院实战day04—课程管理开发(1)</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/24/前端入门——VUE/" title="前端入门——VUE"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-24</div><div class="relatedPosts_title">前端入门——VUE</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/02/学院项目实战day02—讲师管理前端模块开发/" title="谷粒学院项目实战day02—ES6规范+讲师管理前端模块开发"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-02</div><div class="relatedPosts_title">谷粒学院项目实战day02—ES6规范+讲师管理前端模块开发</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/24/ringboot入门-实战/" title="Springboot入门+实战"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-24</div><div class="relatedPosts_title">Springboot入门+实战</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'hCTAXV9K2j6lRxnNWaeqXmHJ-gzGzoHsz',
  appKey: 'bL3PlAeQjsLS33uYxl0f7BVr',
  placeholder: '记得留下你的昵称和邮箱，可以快速收到回复哦',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ryan</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text"><a href="https://ryan0824.github.io/" target="_blank" rel="noopener">Hi, welcome to myblog</a>!</div><div class="icp"><a><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备20003954号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fas fa-comments"></i></a><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script></body></html>