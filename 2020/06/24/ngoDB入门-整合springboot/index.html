<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MongoDB入门+整合springboot | Ryan</title><meta name="description" content="什么是MongoDB？MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。 在高负载的情况下，添加更多的节点，可以保证服务器性能。 MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。 MongoDB 将数据存储为一个文档，数据结构由键值(key&#x3D;&gt;value)对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数"><meta name="keywords" content="mongodb"><meta name="author" content="Ryan"><meta name="copyright" content="Ryan"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2020/06/24/ngoDB%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="MongoDB入门+整合springboot"><meta property="og:url" content="http://yoursite.com/2020/06/24/ngoDB%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/"><meta property="og:site_name" content="Ryan"><meta property="og:description" content="什么是MongoDB？MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。 在高负载的情况下，添加更多的节点，可以保证服务器性能。 MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。 MongoDB 将数据存储为一个文档，数据结构由键值(key&#x3D;&gt;value)对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-06-24T08:43:00.000Z"><meta property="article:modified_time" content="2020-06-24T08:46:38.247Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="ElasticSearch入门+整合springboot" href="http://yoursite.com/2020/06/24/asticSearch%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/"><link rel="next" title="Linux入门教程" href="http://yoursite.com/2020/06/24/nux%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Ryan" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是MongoDB？"><span class="toc-number">1.</span> <span class="toc-text">什么是MongoDB？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主要特点"><span class="toc-number">2.</span> <span class="toc-text">主要特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows安装"><span class="toc-number">3.</span> <span class="toc-text">windows安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux安装"><span class="toc-number">4.</span> <span class="toc-text">Linux安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库的创建和删除"><span class="toc-number">5.</span> <span class="toc-text">数据库的创建和删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#选择和创建数据库"><span class="toc-number">5.0.1.</span> <span class="toc-text">选择和创建数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看数据库"><span class="toc-number">5.0.2.</span> <span class="toc-text">查看数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除数据库"><span class="toc-number">5.0.3.</span> <span class="toc-text">删除数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集合"><span class="toc-number">6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建集合"><span class="toc-number">6.1.</span> <span class="toc-text">创建集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#显式创建、查看、删除"><span class="toc-number">6.1.1.</span> <span class="toc-text">显式创建、查看、删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#隐式创建"><span class="toc-number">6.2.</span> <span class="toc-text">隐式创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文档操作"><span class="toc-number">6.3.</span> <span class="toc-text">文档操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#插入文档"><span class="toc-number">6.3.1.</span> <span class="toc-text">插入文档</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#单条插入"><span class="toc-number">6.3.1.1.</span> <span class="toc-text">单条插入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#批量插入"><span class="toc-number">6.3.1.2.</span> <span class="toc-text">批量插入</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询文档"><span class="toc-number">6.3.2.</span> <span class="toc-text">查询文档</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#查询所有"><span class="toc-number">6.3.2.1.</span> <span class="toc-text">查询所有</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#查询单条"><span class="toc-number">6.3.2.2.</span> <span class="toc-text">查询单条</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#投影查询"><span class="toc-number">6.3.2.3.</span> <span class="toc-text">投影查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#统计查询"><span class="toc-number">6.3.2.4.</span> <span class="toc-text">统计查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#分页查询"><span class="toc-number">6.3.2.5.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#排序查询"><span class="toc-number">6.3.2.6.</span> <span class="toc-text">排序查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#正则查询"><span class="toc-number">6.3.2.7.</span> <span class="toc-text">正则查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#比较查询"><span class="toc-number">6.3.2.8.</span> <span class="toc-text">比较查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#包含查询"><span class="toc-number">6.3.2.9.</span> <span class="toc-text">包含查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#条件连接查询"><span class="toc-number">6.3.2.10.</span> <span class="toc-text">条件连接查询</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改文档"><span class="toc-number">6.3.3.</span> <span class="toc-text">修改文档</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#覆盖修改"><span class="toc-number">6.3.3.1.</span> <span class="toc-text">覆盖修改</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#局部修改"><span class="toc-number">6.3.3.2.</span> <span class="toc-text">局部修改</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#批量修改"><span class="toc-number">6.3.3.3.</span> <span class="toc-text">批量修改</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#列值增长的修改"><span class="toc-number">6.3.3.4.</span> <span class="toc-text">列值增长的修改</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除文档"><span class="toc-number">6.3.4.</span> <span class="toc-text">删除文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常用命令小结"><span class="toc-number">6.4.</span> <span class="toc-text">常用命令小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引"><span class="toc-number">6.5.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#索引的类型"><span class="toc-number">6.5.1.</span> <span class="toc-text">索引的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#单字段索引"><span class="toc-number">6.5.1.1.</span> <span class="toc-text">单字段索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#复合索引"><span class="toc-number">6.5.1.2.</span> <span class="toc-text">复合索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#其他索引"><span class="toc-number">6.5.1.3.</span> <span class="toc-text">其他索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#地理空间索引"><span class="toc-number">6.5.1.4.</span> <span class="toc-text">地理空间索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#文本索引"><span class="toc-number">6.5.1.5.</span> <span class="toc-text">文本索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#哈希索引"><span class="toc-number">6.5.1.6.</span> <span class="toc-text">哈希索引</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引管理"><span class="toc-number">6.5.2.</span> <span class="toc-text">索引管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#查询索引"><span class="toc-number">6.5.2.1.</span> <span class="toc-text">查询索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#创建索引"><span class="toc-number">6.5.2.2.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#索引的移除"><span class="toc-number">6.5.2.3.</span> <span class="toc-text">索引的移除</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引的使用"><span class="toc-number">6.6.</span> <span class="toc-text">索引的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#执行计划"><span class="toc-number">6.6.0.1.</span> <span class="toc-text">执行计划</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#涵盖的查询"><span class="toc-number">6.6.0.2.</span> <span class="toc-text">涵盖的查询</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#springboot整合MongoDB"><span class="toc-number">7.</span> <span class="toc-text">springboot整合MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、创建项目，导入依赖"><span class="toc-number">7.1.</span> <span class="toc-text">1、创建项目，导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、配置yml文件"><span class="toc-number">7.2.</span> <span class="toc-text">2、配置yml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、编写主启动类"><span class="toc-number">7.3.</span> <span class="toc-text">3、编写主启动类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、编写实体类"><span class="toc-number">7.4.</span> <span class="toc-text">4、编写实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、编写dao层"><span class="toc-number">7.5.</span> <span class="toc-text">5、编写dao层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6、编写service层"><span class="toc-number">7.6.</span> <span class="toc-text">6、编写service层</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Ryan</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">MongoDB入门+整合springboot</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-06-24 16:43:00"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-06-24</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-24 16:46:38"><i class="fas fa-history fa-fw"></i> 更新于 2020-06-24</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">8.8k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 35 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="far fa-comments fa-fw post-meta__icon"></i><span>评论数:</span><a href="/2020/06/24/ngoDB%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/06/24/ngoDB%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="什么是MongoDB？"><a href="#什么是MongoDB？" class="headerlink" title="什么是MongoDB？"></a>什么是MongoDB？</h2><p>MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。</p>
<p>在高负载的情况下，添加更多的节点，可以保证服务器性能。</p>
<p>MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。</p>
<p>MongoDB 将数据存储为一个文档，数据结构由键值(key=&gt;value)对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。</p>
<p><img src= "/img/loading.gif" data-src="https://www.runoob.com/wp-content/uploads/2013/10/crud-annotated-document.png" alt="img"></p>
<h2 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h2><ul>
<li>MongoDB 是一个面向文档存储的数据库，操作起来比较简单和容易。</li>
<li>你可以在MongoDB记录中设置任何属性的索引 (如：FirstName=”Sameer”,Address=”8 Gandhi Road”)来实现更快的排序。</li>
<li>你可以通过本地或者网络创建数据镜像，这使得MongoDB有更强的扩展性。</li>
<li>如果负载的增加（需要更多的存储空间和更强的处理能力） ，它可以分布在计算机网络中的其他节点上这就是所谓的分片。</li>
<li>Mongo支持丰富的查询表达式。查询指令使用JSON形式的标记，可轻易查询文档中内嵌的对象及数组。</li>
<li>MongoDb 使用update()命令可以实现替换完成的文档（数据）或者一些指定的数据字段 。</li>
<li>Mongodb中的Map/reduce主要是用来对数据进行批量处理和聚合操作。</li>
<li>Map和Reduce。Map函数调用emit(key,value)遍历集合中所有的记录，将key与value传给Reduce函数进行处理。</li>
<li>Map函数和Reduce函数是使用Javascript编写的，并可以通过db.runCommand或mapreduce命令来执行MapReduce操作。</li>
<li>GridFS是MongoDB中的一个内置功能，可以用于存放大量小文件。</li>
<li>MongoDB允许在服务端执行脚本，可以用Javascript编写某个函数，直接在服务端执行，也可以把函数的定义存储在服务端，下次直接调用即可。</li>
<li>MongoDB支持各种编程语言:RUBY，PYTHON，JAVA，C++，PHP，C#等多种语言。</li>
<li>MongoDB安装简单。</li>
</ul>
<h2 id="windows安装"><a href="#windows安装" class="headerlink" title="windows安装"></a>windows安装</h2><p>官网下载安装文件或者压缩包即可</p>
<p>安装有两种方式：</p>
<p>方式一：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在安装路径的bin同级目录下新建两级文件夹:data/db</span><br><span class="line">然后进入bin目录打开命令窗口，输入命令</span><br><span class="line">mongod --dbpath ..\data\db</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<p>首先在bin同级目录下新建config文件夹中新建mongod.conf配置文件，编辑</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">    dbPath: D:\environment\MongoDB\data\db</span><br></pre></td></tr></table></figure>

<p>然后到bin目录下打开命令窗口，输入以下命令行启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod -f ..\config\mongod.conf</span><br></pre></td></tr></table></figure>

<p>完成启动，发现mongodb的默认端口号是27017</p>
<p>开启了mongodb服务之后，该怎么连接呢，连接也有两种方式</p>
<p>方式一：</p>
<p>打开bin目录下的mongo.exe，直接输入以下命令就可以连接（甚至自动连接）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure>

<p>测试是否连接成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line"><span class="built_in">local</span>   0.000GB</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<p>可通过可视化工具来连接，需要下载compass，在官网下载解压即用，运行compass.exe文件，然后conect即可</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/Iumf28kPVKlaMGW.png" alt="image-20200620155614140"></p>
<h2 id="Linux安装"><a href="#Linux安装" class="headerlink" title="Linux安装"></a>Linux安装</h2><p>官网下载linux版本的mongodb</p>
<p>将压缩包放到linux系统中的usr/local/mongodb文件夹中，解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mongodb</span><br><span class="line">tar -xvf mongodb-linux-x86_64-4.0.10.tgz</span><br></pre></td></tr></table></figure>

<p>新家几个目录，分别用来存储数据、日志和配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/<span class="built_in">local</span>/mongodb/data</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/mongodb/<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p>在bin目录下新建并修改配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/mongodbmongodb-linux-x86_64-4.0.19/bin/mongod.conf</span><br></pre></td></tr></table></figure>

<p>内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">  <span class="comment">#MongoDB发送所有日志输出的目标指定为文件</span></span><br><span class="line">  destination: file</span><br><span class="line">  path: <span class="string">"/usr/local/mongodb/log/mongod.log"</span></span><br><span class="line">  <span class="comment"># 当mongoos或mongod实例重新启动时，会将新条目附加到先有日志文件的末尾</span></span><br><span class="line">  logAppend: <span class="literal">true</span></span><br><span class="line">storage:</span><br><span class="line">  <span class="comment">#mongod实例存储其数据的目录</span></span><br><span class="line">  dbPath: <span class="string">"/usr/local/mongodb/data/db"</span></span><br><span class="line">  journal:</span><br><span class="line">    <span class="comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。 </span></span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">processManagement: </span><br><span class="line">   <span class="comment">#启用在后台运行mongos或mongod进程的守护进程模式。 </span></span><br><span class="line">   fork: <span class="literal">true</span></span><br><span class="line">net:</span><br><span class="line">   <span class="comment">#服务实例绑定的IP，默认是localhost </span></span><br><span class="line">   bindIp: localhost,172.16.0.17</span><br><span class="line">   port: 27017</span><br></pre></td></tr></table></figure>

<p>启动MongoDB服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mongod -f ./mongod.conf</span><br></pre></td></tr></table></figure>

<p>启动成功</p>
<p>测试是否启动成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep mongod</span><br></pre></td></tr></table></figure>

<p>最后通过可视化界面来检测我们的mongodb，这时候不再是localhost了，而是要连接到我们的远程服务器上，需要填写远程服务器的主机名</p>
<p>连接成功</p>
<p>最后看下怎么关闭服务</p>
<p>方式一：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -2 进程id</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mongo --port 27017 </span><br><span class="line">//<span class="comment">#切换到admin库 </span></span><br><span class="line">use admin </span><br><span class="line">//关闭服务 </span><br><span class="line">db.shutdownServer()</span><br></pre></td></tr></table></figure>

<h2 id="数据库的创建和删除"><a href="#数据库的创建和删除" class="headerlink" title="数据库的创建和删除"></a>数据库的创建和删除</h2><p>存放文章评论的数据存放到MongoDB中，数据结构参考如下：</p>
<p>数据库：articledb</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/ZVUdEjtaXPoNlBR.png" alt="image-20200620211946625"></p>
<h4 id="选择和创建数据库"><a href="#选择和创建数据库" class="headerlink" title="选择和创建数据库"></a>选择和创建数据库</h4><p>如果数据库不存在则自动创建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use articledb</span><br></pre></td></tr></table></figure>

<h4 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a>查看数据库</h4><p>查看有权限查看的所有的数据库命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br></pre></td></tr></table></figure>

<p>注意：如果是空的db是不会显示出来的，例如刚刚创建的articledb，因为刚创建还没数据，也就是还没持久化到磁盘中，暂存在内存中</p>
<p>查看正在使用的数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db</span><br></pre></td></tr></table></figure>

<h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><p>MongoDB 删除数据库的语法格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure>

<p>提示：主要用来删除已经持久化的数据库</p>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><h3 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h3><p>集合，类似关系型数据库中的表。 可以显示的创建，也可以隐式的创建</p>
<h4 id="显式创建、查看、删除"><a href="#显式创建、查看、删除" class="headerlink" title="显式创建、查看、删除"></a>显式创建、查看、删除</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.createCollection(<span class="string">"my"</span>)</span><br><span class="line">&#123; <span class="string">"ok"</span> : 1 &#125;</span><br><span class="line">&gt; show collections <span class="comment"># 查看集合</span></span><br><span class="line">my</span><br><span class="line">&gt; db.my.drop()</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt; show collections</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>集合的命名规范：</p>
<ul>
<li>集合名不能是空字符串””。</li>
<li>集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。</li>
<li>集合名不能以”system.”开头，这是为系统集合保留的前缀。</li>
<li>用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除 非你要访问这种系统创建的集合，否则千万不要在名字里出现$。</li>
</ul>
<h3 id="隐式创建"><a href="#隐式创建" class="headerlink" title="隐式创建"></a>隐式创建</h3><p>当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合,通常我们使用隐式创建文档即可</p>
<h3 id="文档操作"><a href="#文档操作" class="headerlink" title="文档操作"></a>文档操作</h3><p>文档（document）的数据结构和 JSON 基本一样。 所有存储在集合中的数据都是 BSON 格式</p>
<h4 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h4><p>跟mysql一样既可以单条插入，也可以多条执行</p>
<h5 id="单条插入"><a href="#单条插入" class="headerlink" title="单条插入"></a>单条插入</h5><p>使用insert() 或 save() 方法向集合中插入文档，语法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert( </span><br><span class="line">    &lt;document or array of documents&gt;, </span><br><span class="line">    &#123; </span><br><span class="line">    	writeConcern: &lt;document&gt;, </span><br><span class="line">    	ordered: &lt;boolean&gt; </span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/vXDhTeliLktyw8g.png" alt="image-20200620214516387"></p>
<p>示例：</p>
<p>要想comment的集合中插入一条测试数据（隐式插入）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.insert(&#123;</span><br><span class="line">...     <span class="string">"articleid"</span>: <span class="string">"100000"</span>,</span><br><span class="line">...     <span class="string">"content"</span>: <span class="string">"今天天气真好，阳光明 媚"</span>,</span><br><span class="line">...     <span class="string">"userid"</span>: <span class="string">"1001"</span>,</span><br><span class="line">...     <span class="string">"nickname"</span>: <span class="string">"Rose"</span>,</span><br><span class="line">...     <span class="string">"createdatetime"</span>: new Date(),</span><br><span class="line">...     <span class="string">"likenum"</span>: NumberInt(10),</span><br><span class="line">...     <span class="string">"state"</span>: null</span><br><span class="line">... &#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nInserted"</span> : 1 &#125;) <span class="comment"># 表明插入成功</span></span><br><span class="line">&gt; show collections</span><br><span class="line">comment</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>提示：</p>
<ul>
<li>comment集合如果不存在，则会隐式创建</li>
<li>mongo中的数字，默认double类型，如要存整型，必须使用函数NumberInt，否则取出来就有问题了。</li>
<li>插入当前日期使用 new Date()</li>
<li>插入的数据没有指定 _id ，会自动生成主键值</li>
<li>如果某字段没值，可以赋值为null，或不写该字段。</li>
</ul>
<p>注意：</p>
<ol>
<li>文档中的键/值对是有序的。</li>
<li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</li>
<li>MongoDB区分类型和大小写。</li>
<li>MongoDB的文档不能有重复的键。</li>
<li>文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。</li>
</ol>
<p>文档键命名规范：</p>
<ul>
<li>键不能含有\0 (空字符)。这个字符用来表示键的结尾。</li>
<li>.和$有特别的意义，只有在特定环境下才能使用。</li>
<li>以下划线”_”开头的键是保留的(不是严格要求的)</li>
</ul>
<h5 id="批量插入"><a href="#批量插入" class="headerlink" title="批量插入"></a>批量插入</h5><p>语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insertMany(</span><br><span class="line">    [ &lt;document 1&gt; , &lt;document 2&gt;, ... ], </span><br><span class="line">    &#123; writeConcern: &lt;document&gt;, ordered: &lt;boolean&gt; &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.insertMany([&#123;</span><br><span class="line">...     <span class="string">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">...     <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">...     <span class="string">"content"</span>: <span class="string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我 他。"</span>,</span><br><span class="line">...     <span class="string">"userid"</span>: <span class="string">"1002"</span>,</span><br><span class="line">...     <span class="string">"nickname"</span>: <span class="string">"相忘于江湖"</span>,</span><br><span class="line">...     <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08- 05T22:08:15.522Z"</span>),</span><br><span class="line">...     <span class="string">"likenum"</span>: NumberInt(1000),</span><br><span class="line">...     <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">... &#125;,</span><br><span class="line">... &#123;</span><br><span class="line">...     <span class="string">"_id"</span>: <span class="string">"2"</span>,</span><br><span class="line">...     <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">...     <span class="string">"content"</span>: <span class="string">"我夏天空腹喝凉开水，冬天喝温开水"</span>,</span><br><span class="line">...     <span class="string">"userid"</span>: <span class="string">"1005"</span>,</span><br><span class="line">...     <span class="string">"nickname"</span>: <span class="string">"伊人憔 悴"</span>,</span><br><span class="line">...     <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08-05T23:58:51.485Z"</span>),</span><br><span class="line">...     <span class="string">"likenum"</span>: NumberInt(888),</span><br><span class="line">...     <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">... &#125;,</span><br><span class="line">... &#123;</span><br><span class="line">...     <span class="string">"_id"</span>: <span class="string">"3"</span>,</span><br><span class="line">...     <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">...     <span class="string">"content"</span>: <span class="string">"我一直喝凉开水，冬天夏天都喝。"</span>,</span><br><span class="line">...     <span class="string">"userid"</span>: <span class="string">"1004"</span>,</span><br><span class="line">...     <span class="string">"nickname"</span>: <span class="string">"杰克船 长"</span>,</span><br><span class="line">...     <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08-06T01:05:06.321Z"</span>),</span><br><span class="line">...     <span class="string">"likenum"</span>: NumberInt(666),</span><br><span class="line">...     <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">... &#125;,</span><br><span class="line">... &#123;</span><br><span class="line">...     <span class="string">"_id"</span>: <span class="string">"4"</span>,</span><br><span class="line">...     <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">...     <span class="string">"content"</span>: <span class="string">"专家说不能空腹吃饭，影响健康。"</span>,</span><br><span class="line">...     <span class="string">"userid"</span>: <span class="string">"1003"</span>,</span><br><span class="line">...     <span class="string">"nickname"</span>: <span class="string">"凯 撒"</span>,</span><br><span class="line">...     <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08-06T08:18:35.288Z"</span>),</span><br><span class="line">...     <span class="string">"likenum"</span>: NumberInt(2000),</span><br><span class="line">...     <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">... &#125;,</span><br><span class="line">... &#123;</span><br><span class="line">...     <span class="string">"_id"</span>: <span class="string">"5"</span>,</span><br><span class="line">...     <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">...     <span class="string">"content"</span>: <span class="string">"研究表明，刚烧开的水千万不能喝，因为烫 嘴。"</span>,</span><br><span class="line">...     <span class="string">"userid"</span>: <span class="string">"1003"</span>,</span><br><span class="line">...     <span class="string">"nickname"</span>: <span class="string">"凯撒"</span>,</span><br><span class="line">...     <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08- 06T11:01:02.521Z"</span>),</span><br><span class="line">...     <span class="string">"likenum"</span>: NumberInt(3000),</span><br><span class="line">...     <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">... &#125;]);</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"insertedIds"</span> : [</span><br><span class="line">                <span class="string">"1"</span>,</span><br><span class="line">                <span class="string">"2"</span>,</span><br><span class="line">                <span class="string">"3"</span>,</span><br><span class="line">                <span class="string">"4"</span>,</span><br><span class="line">                <span class="string">"5"</span></span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提示：</p>
<p>插入时指定了 _id ，则主键就是该值。</p>
<p>如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉。</p>
<p>因为批量插入由于数据较多容易出现失败，因此，可以使用try catch进行异常捕捉处理，测试的时候可以不处理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">try &#123;  </span><br><span class="line">    db.comment.insertMany([&#123;</span><br><span class="line">    <span class="string">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">    <span class="string">"content"</span>: <span class="string">"我们不应该把清晨浪费在手机上，健康很重要"</span>,</span><br><span class="line">    <span class="string">"userid"</span>: <span class="string">"1002"</span>,</span><br><span class="line">    <span class="string">"nickname"</span>: <span class="string">"相忘于江湖"</span>,</span><br><span class="line">    <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08- 05T22:08:15.522Z"</span>),</span><br><span class="line">    <span class="string">"likenum"</span>: NumberInt(1000),</span><br><span class="line">    <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"_id"</span>: <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">        <span class="string">"content"</span>: <span class="string">"我夏天空腹喝凉开水，冬天喝温开水"</span>,</span><br><span class="line">        <span class="string">"userid"</span>: <span class="string">"1005"</span>,</span><br><span class="line">        <span class="string">"nickname"</span>: <span class="string">"伊人憔 悴"</span>,</span><br><span class="line">        <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08-05T23:58:51.485Z"</span>),</span><br><span class="line">        <span class="string">"likenum"</span>: NumberInt(888),</span><br><span class="line">        <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"_id"</span>: <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">        <span class="string">"content"</span>: <span class="string">"我一直喝凉开水，冬天夏天都喝。"</span>,</span><br><span class="line">        <span class="string">"userid"</span>: <span class="string">"1004"</span>,</span><br><span class="line">        <span class="string">"nickname"</span>: <span class="string">"杰克船 长"</span>,</span><br><span class="line">        <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08-06T01:05:06.321Z"</span>),</span><br><span class="line">        <span class="string">"likenum"</span>: NumberInt(666),</span><br><span class="line">        <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"_id"</span>: <span class="string">"4"</span>,</span><br><span class="line">        <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">        <span class="string">"content"</span>: <span class="string">"专家说不能空腹吃饭，影响健康。"</span>,</span><br><span class="line">        <span class="string">"userid"</span>: <span class="string">"1003"</span>,</span><br><span class="line">        <span class="string">"nickname"</span>: <span class="string">"凯 撒"</span>,</span><br><span class="line">        <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08-06T08:18:35.288Z"</span>),</span><br><span class="line">        <span class="string">"likenum"</span>: NumberInt(2000),</span><br><span class="line">        <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"_id"</span>: <span class="string">"5"</span>,</span><br><span class="line">        <span class="string">"articleid"</span>: <span class="string">"100001"</span>,</span><br><span class="line">        <span class="string">"content"</span>: <span class="string">"研究表明，刚烧开的水千万不能喝，因为烫 嘴。"</span>,</span><br><span class="line">        <span class="string">"userid"</span>: <span class="string">"1003"</span>,</span><br><span class="line">        <span class="string">"nickname"</span>: <span class="string">"凯撒"</span>,</span><br><span class="line">        <span class="string">"createdatetime"</span>: new Date(<span class="string">"2019-08- 06T11:01:02.521Z"</span>),</span><br><span class="line">        <span class="string">"likenum"</span>: NumberInt(3000),</span><br><span class="line">        <span class="string">"state"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;]);</span><br><span class="line">&#125; catch (e) &#123; </span><br><span class="line">    <span class="built_in">print</span> (e); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h4><p>查询数据的语法格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&lt;query&gt;, [projection])</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>query</td>
<td>document</td>
<td>可选。使用查询运算符指定选择筛选器。若要返回集合中的所有文档，请省略此参数或传递空文档 ({})</td>
</tr>
<tr>
<td>projection</td>
<td>document</td>
<td>可选。指定要在与查询筛选器匹配的文档中返回的字段（投影）。若要返回匹配文档中的所有字段，</td>
</tr>
</tbody></table>
<p>示例：</p>
<h5 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a><strong>查询所有</strong></h5><p>如果我们要查询集合的所有文档，我们输入以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find() </span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">db.comment.find(&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>这里你会发现每条文档会有一个叫_id的字段，这个相当于我们原来关系数据库中表的主键，当你在插入文档记录时没有指定该字段， MongoDB会自动创建，其类型是ObjectID类型。 如果我们在插入文档记录时指定该字段也可以，其类型可以是ObjectID类型，也可以是MongoDB支持的任意类型.</p>
<p>如果我想按一定条件来查询，比如我想查询userid为1003的记录，怎么办？很简单！只 要在fifind()中添加参数即可，参数也是json格式，如 下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;userid:&quot;1003&quot;&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : &quot;4&quot;, &quot;articleid&quot; : &quot;100001&quot;, &quot;content&quot; : &quot;专家说不能空腹吃饭，影响健康。&quot;, &quot;userid&quot; : &quot;1003&quot;, &quot;nickname&quot; : &quot;凯 撒&quot;, &quot;createdatetime&quot; : ISODate(&quot;2019-08-06T08:18:35.288Z&quot;), &quot;likenum&quot; : 2000, &quot;state&quot; : &quot;1&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;5&quot;, &quot;articleid&quot; : &quot;100001&quot;, &quot;content&quot; : &quot;研究表明，刚烧开的水千万不能喝，因为烫 嘴。&quot;, &quot;userid&quot; : &quot;1003&quot;, &quot;nickname&quot; : &quot;凯撒&quot;, &quot;createdatetime&quot; : ISODate(&quot;1970-01-01T00:00:00Z&quot;), &quot;likenum&quot; : 3000, &quot;state&quot; : &quot;1&quot; &#125;</span><br></pre></td></tr></table></figure>

<h5 id="查询单条"><a href="#查询单条" class="headerlink" title="查询单条"></a><strong>查询单条</strong></h5><p>如果你只需要返回符合条件的第一条数据，我们可以使用fifindOne命令来实现，语法和fifind一样。</p>
<p>如：查询用户编号是1003的记录，但只最多返回符合条件的第一条记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.findOne(&#123;userid:<span class="string">"1003"</span>&#125;)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"4"</span>,</span><br><span class="line">        <span class="string">"articleid"</span> : <span class="string">"100001"</span>,</span><br><span class="line">        <span class="string">"content"</span> : <span class="string">"专家说不能空腹吃饭，影响健康。"</span>,</span><br><span class="line">        <span class="string">"userid"</span> : <span class="string">"1003"</span>,</span><br><span class="line">        <span class="string">"nickname"</span> : <span class="string">"凯 撒"</span>,</span><br><span class="line">        <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T08:18:35.288Z"</span>),</span><br><span class="line">        <span class="string">"likenum"</span> : 2000,</span><br><span class="line">        <span class="string">"state"</span> : <span class="string">"1"</span></span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h5 id="投影查询"><a href="#投影查询" class="headerlink" title="投影查询"></a><strong>投影查询</strong></h5><p>如果要查询结果返回部分字段，则需要使用投影查询（不显示所有字段，只显示指定的字段）。</p>
<p>如：查询结果只显示 _id、userid、nickname :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;userid:<span class="string">"1003"</span>&#125;,&#123;userid:1,nickname:1&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"4"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯 撒"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"5"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒"</span> &#125;</span><br></pre></td></tr></table></figure>

<p>如：查询结果只显示 、userid、nickname ，不显示 _id ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;userid:<span class="string">"1003"</span>&#125;,&#123;userid:1,nickname:1,_id:0&#125;)</span><br><span class="line">&#123; <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯 撒"</span> &#125;</span><br><span class="line">&#123; <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒"</span> &#125;</span><br></pre></td></tr></table></figure>

<p>再例如：查询所有数据，但只显示 _id、userid、nickname :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;&#125;,&#123;userid:1,nickname:1&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="统计查询"><a href="#统计查询" class="headerlink" title="统计查询"></a><strong>统计查询</strong></h5><p>语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.count(query, options)</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>query</td>
<td>document</td>
<td>查询选择条件。</td>
</tr>
<tr>
<td>options</td>
<td>document</td>
<td>可选。用于修改计数的额外选项。</td>
</tr>
</tbody></table>
<p>示例：</p>
<p>统计comment集合的所有的记录数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.count()</span><br><span class="line">6</span><br><span class="line">&gt; db.comment.count(&#123;userid:<span class="string">"1003"</span>&#125;)</span><br><span class="line">2</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h5 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a><strong>分页查询</strong></h5><p>可以使用limit()方法来读取指定数量的数据，使用skip()方法来跳过指定数量的数据</p>
<p>基本语法如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.find().<span class="built_in">limit</span>(NUMBER).skip(NUMBER)</span><br></pre></td></tr></table></figure>

<p>如果你想返回指定条数的记录，可以在fifind方法后调用limit来返回结果(TopN)，默认值20，例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find().<span class="built_in">limit</span>(3)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5eee1393b9ba7b116ffa7823"</span>), <span class="string">"articleid"</span> : <span class="string">"100000"</span>, <span class="string">"content"</span> : <span class="string">"今天天气真好，阳光明 媚"</span>, <span class="string">"userid"</span> : <span class="string">"1001"</span>, <span class="string">"nickname"</span> : <span class="string">"Rose"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2020-06-20T13:48:03.665Z"</span>), <span class="string">"likenum"</span> : 10, <span class="string">"state"</span> : null &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"1"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我 他。"</span>, <span class="string">"userid"</span> : <span class="string">"1002"</span>, <span class="string">"nickname"</span> : <span class="string">"相忘于江湖"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 1000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"2"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我夏天空腹喝凉开水，冬天喝温开水"</span>, <span class="string">"userid"</span> : <span class="string">"1005"</span>, <span class="string">"nickname"</span> : <span class="string">"伊人憔 悴"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-05T23:58:51.485Z"</span>), <span class="string">"likenum"</span> : 888, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>skip方法同样接受一个数字参数作为跳过的记录条数。（前N个不要）,默认值是0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find().skip(3)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"3"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我一直喝凉开水，冬天夏天都喝。"</span>, <span class="string">"userid"</span> : <span class="string">"1004"</span>, <span class="string">"nickname"</span> : <span class="string">"杰克船 长"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T01:05:06.321Z"</span>), <span class="string">"likenum"</span> : 666, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"4"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"专家说不能空腹吃饭，影响健康。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯 撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T08:18:35.288Z"</span>), <span class="string">"likenum"</span> : 2000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"5"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"研究表明，刚烧开的水千万不能喝，因为烫 嘴。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 3000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br></pre></td></tr></table></figure>

<h5 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a><strong>排序查询</strong></h5><p>sort() 方法对数据进行排序，sort() 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而 -1 是用 于降序排列</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.find().sort(&#123;KEY:1&#125;)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<p>对userid降序排列，并对访问量进行升序排列</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find().sort(&#123;userid:-1,likenum:1&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"2"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我夏天空腹喝凉开水，冬天喝温开水"</span>, <span class="string">"userid"</span> : <span class="string">"1005"</span>, <span class="string">"nickname"</span> : <span class="string">"伊人憔 悴"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-05T23:58:51.485Z"</span>), <span class="string">"likenum"</span> : 888, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"3"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我一直喝凉开水，冬天夏天都喝。"</span>, <span class="string">"userid"</span> : <span class="string">"1004"</span>, <span class="string">"nickname"</span> : <span class="string">"杰克船 长"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T01:05:06.321Z"</span>), <span class="string">"likenum"</span> : 666, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"4"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"专家说不能空腹吃饭，影响健康。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯 撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T08:18:35.288Z"</span>), <span class="string">"likenum"</span> : 2000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"5"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"研究表明，刚烧开的水千万不能喝，因为烫 嘴。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 3000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"1"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我 他。"</span>, <span class="string">"userid"</span> : <span class="string">"1002"</span>, <span class="string">"nickname"</span> : <span class="string">"相忘于江湖"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 1000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5eee1393b9ba7b116ffa7823"</span>), <span class="string">"articleid"</span> : <span class="string">"100000"</span>, <span class="string">"content"</span> : <span class="string">"今天天气真好，阳光明 媚"</span>, <span class="string">"userid"</span> : <span class="string">"1001"</span>, <span class="string">"nickname"</span> : <span class="string">"Rose"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2020-06-20T13:48:03.665Z"</span>), <span class="string">"likenum"</span> : 10, <span class="string">"state"</span> : null &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>提示：</p>
<p>skip(), limilt(), sort()三个放在一起执行的时候，执行的顺序是先 sort(), 然后是 skip()，最后是显示的 limit()，和命令编写顺序无关。</p>
<h5 id="正则查询"><a href="#正则查询" class="headerlink" title="正则查询"></a><strong>正则查询</strong></h5><p>MongoDB的模糊查询是通过<strong>正则表达式</strong>的方式实现的。格式为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&#123;field:/正则表达式/&#125;)</span><br></pre></td></tr></table></figure>

<p>提示：正则表达式是js的语法，直接量的写法。</p>
<p>例如，我要查询评论内容包含“开水”的所有文档，代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;content:/空腹/&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"2"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我夏天空腹喝凉开水，冬天喝温开水"</span>, <span class="string">"userid"</span> : <span class="string">"1005"</span>, <span class="string">"nickname"</span> : <span class="string">"伊人憔 悴"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-05T23:58:51.485Z"</span>), <span class="string">"likenum"</span> : 888, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"4"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"专家说不能空腹吃饭，影响健康。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯 撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T08:18:35.288Z"</span>), <span class="string">"likenum"</span> : 2000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&gt; db.comment.find(&#123;content:/^我们/&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"1"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我 他。"</span>, <span class="string">"userid"</span> : <span class="string">"1002"</span>, <span class="string">"nickname"</span> : <span class="string">"相忘于江湖"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 1000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h5 id="比较查询"><a href="#比较查询" class="headerlink" title="比较查询"></a>比较查询</h5><p>&lt;, &lt;=, &gt;, &gt;= 这个操作符也是很常用的，格式如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find(&#123; <span class="string">"field"</span> : &#123; <span class="variable">$gt</span>: value &#125;&#125;) // 大于: field &gt; value </span><br><span class="line">db.集合名称.find(&#123; <span class="string">"field"</span> : &#123; <span class="variable">$lt</span>: value &#125;&#125;) // 小于: field &lt; value </span><br><span class="line">db.集合名称.find(&#123; <span class="string">"field"</span> : &#123; <span class="variable">$gte</span>: value &#125;&#125;) // 大于等于: field &gt;= value </span><br><span class="line">db.集合名称.find(&#123; <span class="string">"field"</span> : &#123; <span class="variable">$lte</span>: value &#125;&#125;) // 小于等于: field &lt;= value </span><br><span class="line">db.集合名称.find(&#123; <span class="string">"field"</span> : &#123; <span class="variable">$ne</span>: value &#125;&#125;) // 不等于: field != value</span><br></pre></td></tr></table></figure>

<p>示例：查询评论点赞数量大于700的记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;likenum:&#123;<span class="variable">$gt</span>:NumberInt(700)&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"1"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我 他。"</span>, <span class="string">"userid"</span> : <span class="string">"1002"</span>, <span class="string">"nickname"</span> : <span class="string">"相忘于江湖"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 1000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"2"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我夏天空腹喝凉开水，冬天喝温开水"</span>, <span class="string">"userid"</span> : <span class="string">"1005"</span>, <span class="string">"nickname"</span> : <span class="string">"伊人憔 悴"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-05T23:58:51.485Z"</span>), <span class="string">"likenum"</span> : 888, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"4"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"专家说不能空腹吃饭，影响健康。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯 撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T08:18:35.288Z"</span>), <span class="string">"likenum"</span> : 2000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"5"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"研究表明，刚烧开的水千万不能喝，因为烫 嘴。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 3000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h5 id="包含查询"><a href="#包含查询" class="headerlink" title="包含查询"></a>包含查询</h5><p>包含使用$in操作符。 示例：查询评论的集合中userid字段包含1003或1004的文档</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;userid:&#123;<span class="variable">$in</span>:[<span class="string">"1003"</span>,<span class="string">"1004"</span>]&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"3"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我一直喝凉开水，冬天夏天都喝。"</span>, <span class="string">"userid"</span> : <span class="string">"1004"</span>, <span class="string">"nickname"</span> : <span class="string">"杰克船 长"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T01:05:06.321Z"</span>), <span class="string">"likenum"</span> : 666, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"4"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"专家说不能空腹吃饭，影响健康。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯 撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T08:18:35.288Z"</span>), <span class="string">"likenum"</span> : 2000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"5"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"研究表明，刚烧开的水千万不能喝，因为烫 嘴。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 3000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h5 id="条件连接查询"><a href="#条件连接查询" class="headerlink" title="条件连接查询"></a>条件连接查询</h5><p>我们如果需要查询同时满足两个以上条件，需要使用$and操作符将条件进行关联。 格式为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$and</span>:[ &#123; &#125;,&#123; &#125;,&#123; &#125; ]</span><br></pre></td></tr></table></figure>

<p>示例：查询评论集合中likenum大于等于700 并且小于2000的文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;<span class="variable">$and</span>:[&#123;likenum:&#123;<span class="variable">$gte</span>:NumberInt(700)&#125;&#125;,&#123;likenum:&#123;<span class="variable">$lt</span>:NumberInt(2000)&#125;&#125;]&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"1"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我 他。"</span>, <span class="string">"userid"</span> : <span class="string">"1002"</span>, <span class="string">"nickname"</span> : <span class="string">"相忘于江湖"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 1000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"2"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"我夏天空腹喝凉开水，冬天喝温开水"</span>, <span class="string">"userid"</span> : <span class="string">"1005"</span>, <span class="string">"nickname"</span> : <span class="string">"伊人憔 悴"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-05T23:58:51.485Z"</span>), <span class="string">"likenum"</span> : 888, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>如果两个以上条件之间是或者的关系，我们使用 操作符进行关联，与前面 and的使用方式相同 格式为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$or</span>:[ &#123; &#125;,&#123; &#125;,&#123; &#125; ]</span><br></pre></td></tr></table></figure>

<h4 id="修改文档"><a href="#修改文档" class="headerlink" title="修改文档"></a>修改文档</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(query, update, options) </span><br><span class="line">或 </span><br><span class="line">db.collection.update( </span><br><span class="line">    &lt;query&gt;, </span><br><span class="line">    &lt;update&gt;, </span><br><span class="line">    &#123; </span><br><span class="line">        upsert: &lt;boolean&gt;, </span><br><span class="line">        multi: &lt;boolean&gt;, </span><br><span class="line">        writeConcern: &lt;document&gt;, </span><br><span class="line">        collation: &lt;document&gt;, </span><br><span class="line">        arrayFilters: [ &lt;filterdocument1&gt;, ... ], </span><br><span class="line">        hint: &lt;document|string&gt; // Available starting <span class="keyword">in</span> MongoDB 4.2 </span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h5 id="覆盖修改"><a href="#覆盖修改" class="headerlink" title="覆盖修改"></a>覆盖修改</h5><p>如果我们想修改_id为1的记录，点赞量为1001，输入以下语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.update(&#123;_id:<span class="string">"1"</span>&#125;,&#123;likenum:NumberInt(1001)&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : 1, <span class="string">"nUpserted"</span> : 0, <span class="string">"nModified"</span> : 1 &#125;)</span><br><span class="line">&gt; db.comment.findOne(&#123;_id:<span class="string">"1"</span>&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"1"</span>, <span class="string">"likenum"</span> : 1001 &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>执行后，我们会发现，这条文档除了likenum字段其它字段都不见了</p>
<h5 id="局部修改"><a href="#局部修改" class="headerlink" title="局部修改"></a>局部修改</h5><p>为了解决这个问题，我们需要使用修改器$set来实现，命令如下：</p>
<p>我们想修改_id为2的记录，浏览量为889，输入以下语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.update(&#123;_id:<span class="string">"2"</span>&#125;,&#123;<span class="variable">$set</span>:&#123;likenum:NumberInt(889)&#125;&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : 1, <span class="string">"nUpserted"</span> : 0, <span class="string">"nModified"</span> : 1 &#125;)</span><br><span class="line">&gt; db.comment.findOne(&#123;_id:<span class="string">"2"</span>&#125;)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"articleid"</span> : <span class="string">"100001"</span>,</span><br><span class="line">        <span class="string">"content"</span> : <span class="string">"我夏天空腹喝凉开水，冬天喝温开水"</span>,</span><br><span class="line">        <span class="string">"userid"</span> : <span class="string">"1005"</span>,</span><br><span class="line">        <span class="string">"nickname"</span> : <span class="string">"伊人憔 悴"</span>,</span><br><span class="line">        <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-05T23:58:51.485Z"</span>),</span><br><span class="line">        <span class="string">"likenum"</span> : 889,</span><br><span class="line">        <span class="string">"state"</span> : <span class="string">"1"</span></span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h5 id="批量修改"><a href="#批量修改" class="headerlink" title="批量修改"></a>批量修改</h5><p>更新所有用户为 1003 的用户的昵称为 凯撒大帝 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.update(&#123;userid:<span class="string">"1003"</span>&#125;,&#123;<span class="variable">$set</span>:&#123;nickname:<span class="string">"凯撒2"</span>&#125;&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : 1, <span class="string">"nUpserted"</span> : 0, <span class="string">"nModified"</span> : 1 &#125;)</span><br><span class="line">&gt; db.comment.find(&#123;userid:<span class="string">"1003"</span>&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"4"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"专家说不能空腹吃饭，影响健康。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒2"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T08:18:35.288Z"</span>), <span class="string">"likenum"</span> : 2000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"5"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"研究表明，刚烧开的水千万不能喝，因为烫 嘴。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 3000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&gt; db.comment.update(&#123;userid:<span class="string">"1003"</span>&#125;,&#123;<span class="variable">$set</span>:&#123;nickname:<span class="string">"凯撒大帝"</span>&#125;&#125;,&#123;multi:<span class="literal">true</span>&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : 2, <span class="string">"nUpserted"</span> : 0, <span class="string">"nModified"</span> : 2 &#125;)</span><br><span class="line">&gt;  db.comment.find(&#123;userid:<span class="string">"1003"</span>&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"4"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"专家说不能空腹吃饭，影响健康。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒大帝"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"2019-08-06T08:18:35.288Z"</span>), <span class="string">"likenum"</span> : 2000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="string">"5"</span>, <span class="string">"articleid"</span> : <span class="string">"100001"</span>, <span class="string">"content"</span> : <span class="string">"研究表明，刚烧开的水千万不能喝，因为烫 嘴。"</span>, <span class="string">"userid"</span> : <span class="string">"1003"</span>, <span class="string">"nickname"</span> : <span class="string">"凯撒大帝"</span>, <span class="string">"createdatetime"</span> : ISODate(<span class="string">"1970-01-01T00:00:00Z"</span>), <span class="string">"likenum"</span> : 3000, <span class="string">"state"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>提示：如果不加后面的参数，则只更新符合条件的第一条记录</p>
<h5 id="列值增长的修改"><a href="#列值增长的修改" class="headerlink" title="列值增长的修改"></a>列值增长的修改</h5><p>如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用 $inc 运算符来实现。</p>
<p>需求：对3号数据的点赞数，每次递增1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.update(&#123;_id:<span class="string">"3"</span>&#125;,&#123;<span class="variable">$inc</span>:&#123;likenum:Number(1)&#125;&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : 1, <span class="string">"nUpserted"</span> : 0, <span class="string">"nModified"</span> : 1 &#125;)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h4 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h4><p>删除文档的语法结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.remove(条件)</span><br></pre></td></tr></table></figure>

<p>以下语句可以将数据全部删除，请慎用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.remove(&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>如果删除_id=1的记录，输入以下语句</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.remove(&#123;_id:<span class="string">"1"</span>&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nRemoved"</span> : 1 &#125;)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h3 id="常用命令小结"><a href="#常用命令小结" class="headerlink" title="常用命令小结"></a>常用命令小结</h3><p>选择切换数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use articledb</span><br></pre></td></tr></table></figure>

<p>插入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.insert(&#123;bson数据&#125;)</span><br></pre></td></tr></table></figure>

<p>查询所有数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find()</span><br></pre></td></tr></table></figure>

<p>条件查询数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;条件&#125;)</span><br></pre></td></tr></table></figure>

<p>查询符合条件的第一条记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.findOne(&#123;条件&#125;)</span><br></pre></td></tr></table></figure>

<p>查询符合条件的前几条记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;条件&#125;).limit(条数)</span><br></pre></td></tr></table></figure>

<p>查询符合条件的跳过的记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;条件&#125;).skip(条数)</span><br></pre></td></tr></table></figure>

<p>修改数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(&#123;条件&#125;,&#123;修改后的数据&#125;) </span><br><span class="line">或</span><br><span class="line">db.comment.update(&#123;条件&#125;,&#123;$set:&#123;要修改部分的字段:数据&#125;)</span><br></pre></td></tr></table></figure>

<p>修改数据并自增某字段值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(&#123;条件&#125;,&#123;$inc:&#123;自增的字段:步进值&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>删除数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.remove(&#123;条件&#125;)</span><br></pre></td></tr></table></figure>

<p>统计查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.count(&#123;条件&#125;)</span><br></pre></td></tr></table></figure>

<p>模糊查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;字段名:&#x2F;正则表达式&#x2F;&#125;)</span><br></pre></td></tr></table></figure>

<p>条件比较运算：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;字段名:&#123;$gt:值&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>包含查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;字段名:&#123;$in:[值1，值2]&#125;&#125;)</span><br><span class="line">或</span><br><span class="line">db.comment.find(&#123;字段名:&#123;$nin:[值1，值2]&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>条件连接查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;$and:[&#123;条件1&#125;,&#123;条件2&#125;]&#125;)</span><br><span class="line">或</span><br><span class="line">db.comment.find(&#123;$or:[&#123;条件1&#125;,&#123;条件2&#125;]&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>索引支持在MongoDB中高效地执行查询。如果没有索引，MongoDB必须执行全集合扫描，即扫描集合中的每个文档，以选择与查询语句匹配的文档。这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。</p>
<p>如果查询存在适当的索引，MongoDB可以使用该索引限制必须检查的文档数。</p>
<p>索引是特殊的数据结构，它以易于遍历的形式存储集合数据集的一小部分。索引存储特定字段或一组字段的值，按字段值排序。索引项的排序支持有效的相等匹配和基于范围的查询操作。此外，MongoDB还可以使用索引中的排序返回排序结果。</p>
<p>官网文档：<a href="https://docs.mongodb.com/manual/indexes/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/indexes/</a></p>
<p>MongoDB索引使用B树数据结构（确切的说是B-Tree，MySQL是B+Tree）</p>
<h4 id="索引的类型"><a href="#索引的类型" class="headerlink" title="索引的类型"></a>索引的类型</h4><h5 id="单字段索引"><a href="#单字段索引" class="headerlink" title="单字段索引"></a>单字段索引</h5><p>MongoDB支持在文档的单个字段上创建用户定义的升序/降序索引，称为单字段索引（Single Field Index）。</p>
<p>对于单个字段索引和排序操作，索引键的排序顺序（即升序或降序）并不重要，因为MongoDB可以在任何方向上遍历索引。</p>
<h5 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h5><p>MongoDB还支持多个字段的用户定义索引，即复合索引（Compound Index）。</p>
<p>复合索引中列出的字段顺序具有重要意义。例如，如果复合索引由 { userid: 1, score: -1 } 组成，则索引首先按userid正序排序，然后在每个userid的值内，再在按score倒序排序</p>
<h5 id="其他索引"><a href="#其他索引" class="headerlink" title="其他索引"></a>其他索引</h5><p>地理空间索引（Geospatial Index）、文本索引（Text Indexes）、哈希索引（Hashed Indexes）。</p>
<h5 id="地理空间索引"><a href="#地理空间索引" class="headerlink" title="地理空间索引"></a>地理空间索引</h5><p>为了支持对地理空间坐标数据的有效查询，MongoDB提供了两种特殊的索引：返回结果时使用平面几何的二维索引和返回结果时使用球面 几何的二维球面索引。</p>
<h5 id="文本索引"><a href="#文本索引" class="headerlink" title="文本索引"></a>文本索引</h5><p>MongoDB提供了一种文本索引类型，支持在集合中搜索字符串内容。这些文本索引不存储特定于语言的停止词（例如“the”、“a”、“or”），而将集合中的词作为词干，只存储根词。</p>
<h5 id="哈希索引"><a href="#哈希索引" class="headerlink" title="哈希索引"></a>哈希索引</h5><p>为了支持基于散列的分片，MongoDB提供了散列索引类型，它对字段值的散列进行索引。这些索引在其范围内的值分布更加随机，但只支 持相等匹配，不支持基于范围的查询。</p>
<h4 id="索引管理"><a href="#索引管理" class="headerlink" title="索引管理"></a>索引管理</h4><h5 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h5><p>返回一个集合中的所有索引的数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.getIndexes()</span><br><span class="line">[</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="string">"v"</span> : 2, <span class="comment"># 索引引擎版本</span></span><br><span class="line">                <span class="string">"key"</span> : &#123;</span><br><span class="line">                        <span class="string">"_id"</span> : 1 <span class="comment"># 索引对应的字段：1代表升序</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"name"</span> : <span class="string">"_id_"</span>, <span class="comment"># 索引名称</span></span><br><span class="line">                <span class="string">"ns"</span> : <span class="string">"test.comment"</span></span><br><span class="line">        &#125;</span><br><span class="line">]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>结果中显示的是默认 _id 索引。</p>
<p>默认_id索引：</p>
<p>MongoDB在创建集合的过程中，在 _id 字段上创建一个唯一的索引，默认名字为 <em>id</em> ，该索引可防止客户端插入两个具有相同值的文 档，您不能在_id字段上删除此索引。</p>
<p>注意：该索引是唯一索引，因此值不能重复，即 _id 值不能重复的。在分片集群中，通常使用 _id 作为片键</p>
<h5 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h5><p>在集合上创建索引。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex(keys, options)</span><br></pre></td></tr></table></figure>

<p>在集合上创建索引。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex(keys, options)</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/sPwtMWju7JhIecg.png" alt="image-20200620230719986"></p>
<p>options（更多选项）列表：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/eGxf6kBcRX5tO9M.png" alt="image-20200620230736005"></p>
<p>提示：</p>
<p>注意在 3.0.0 版本前创建索引方法为 db.collection.ensureIndex() ，之后的版本使用了 db.collection.createIndex() 方法， ensureIndex() 还能用，但只是createIndex() 的别名。</p>
<p>【示例】</p>
<p>（1）单字段索引示例：对 userid 字段建立索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.comment.createIndex(&#123;userid:1&#125;) </span><br><span class="line">&#123; </span><br><span class="line">	<span class="string">"createdCollectionAutomatically"</span> : <span class="literal">false</span>, </span><br><span class="line">	<span class="string">"numIndexesBefore"</span> : 1, </span><br><span class="line">	<span class="string">"numIndexesAfter"</span> : 2, </span><br><span class="line">	<span class="string">"ok"</span> : 1 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）复合索引：对 userid 和 nickname 同时建立复合（Compound）索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.comment.createIndex(&#123;userid:1,nickname:-1&#125;) </span><br><span class="line">&#123; </span><br><span class="line">	<span class="string">"createdCollectionAutomatically"</span> : <span class="literal">false</span>, </span><br><span class="line">	<span class="string">"numIndexesBefore"</span> : 2, </span><br><span class="line">	<span class="string">"numIndexesAfter"</span> : 3, </span><br><span class="line">	<span class="string">"ok"</span> : 1 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="索引的移除"><a href="#索引的移除" class="headerlink" title="索引的移除"></a>索引的移除</h5><p>可以移除指定的索引，或移除所有索引</p>
<p>移除指定索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.dropIndex(index)</span><br></pre></td></tr></table></figure>

<p>移除所有索引：</p>
<p>注意：_id的索引是不会被删除的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.dropIndexes()</span><br></pre></td></tr></table></figure>

<h3 id="索引的使用"><a href="#索引的使用" class="headerlink" title="索引的使用"></a>索引的使用</h3><h5 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h5><p>分析查询性能（Analyze Query Performance）通常使用执行计划（解释计划、Explain Plan）来查看查询的情况，如查询耗费的时间、是否基于索引查询等。</p>
<p>那么，通常，我们想知道，建立的索引是否有效，效果如何，都需要通过执行计划查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(query,options).explain(options)</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p>查看根据userid查询数据的情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;userid:<span class="string">"1003"</span>&#125;).explain()</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">"queryPlanner"</span> : &#123;</span><br><span class="line">                <span class="string">"plannerVersion"</span> : 1,</span><br><span class="line">                <span class="string">"namespace"</span> : <span class="string">"test.comment"</span>,</span><br><span class="line">                <span class="string">"indexFilterSet"</span> : <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"parsedQuery"</span> : &#123;</span><br><span class="line">                        <span class="string">"userid"</span> : &#123;</span><br><span class="line">                                <span class="string">"<span class="variable">$eq</span>"</span> : <span class="string">"1003"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"winningPlan"</span> : &#123;</span><br><span class="line">                        <span class="string">"stage"</span> : <span class="string">"COLLSCAN"</span>,</span><br><span class="line">                        <span class="string">"filter"</span> : &#123;</span><br><span class="line">                                <span class="string">"userid"</span> : &#123;</span><br><span class="line">                                        <span class="string">"<span class="variable">$eq</span>"</span> : <span class="string">"1003"</span></span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="string">"direction"</span> : <span class="string">"forward"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"rejectedPlans"</span> : [ ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"serverInfo"</span> : &#123;</span><br><span class="line">                <span class="string">"host"</span> : <span class="string">"ryan"</span>,</span><br><span class="line">                <span class="string">"port"</span> : 27017,</span><br><span class="line">                <span class="string">"version"</span> : <span class="string">"4.0.19"</span>,</span><br><span class="line">                <span class="string">"gitVersion"</span> : <span class="string">"7e28f4296a04d858a2e3dd84a1e79c9ba59a9568"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"ok"</span> : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关键点看： “stage” : “COLLSCAN”, 表示全集合扫描，也就是全部5条数据都要查一遍，再选择符合条件的，这个查询方式就比较低了</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/8vSuM2BiZyoJ496.png" alt="image-20200620231717152"></p>
<p>我们尝试给userid加上索引，再查一下看看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.createIndex(&#123;userid:1&#125;)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">"createdCollectionAutomatically"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"numIndexesBefore"</span> : 1,</span><br><span class="line">        <span class="string">"numIndexesAfter"</span> : 2,</span><br><span class="line">        <span class="string">"ok"</span> : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/Q5PREg1lSsNO2IL.png" alt="image-20200620231911938"></p>
<p>再次查看执行计划,关键点看： “stage” : “IXSCAN” ,基于索引的扫描，然后抓取fetch</p>
<p>这时候会先去索引库中扫描数据，再抓取符合条件的数据，总共才查了2条数据，对比没有索引的，效率肯定是提高了，如果是大数据，就会非常明显</p>
<h5 id="涵盖的查询"><a href="#涵盖的查询" class="headerlink" title="涵盖的查询"></a>涵盖的查询</h5><p>当查询条件和查询的投影仅包含索引字段时，MongoDB直接从索引返回结果，而不扫描任何文档或将文档带入内存，这些覆盖的查询非常高效</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/hrBLuvI4FOxERVl.png" alt="image-20200620232450122"></p>
<p>示例：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/tTpaP6oSi8YFRKh.png" alt="image-20200620232634793"></p>
<h2 id="springboot整合MongoDB"><a href="#springboot整合MongoDB" class="headerlink" title="springboot整合MongoDB"></a>springboot整合MongoDB</h2><p>主要结合springboot-mangodb对数据的操作</p>
<p>表结构分析</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/24/Tmb8RgdnAt2JQal.png" alt="image-20200620233306607"></p>
<p>技术选型</p>
<p>SpringDataMongoDB</p>
<p>实战：</p>
<h3 id="1、创建项目，导入依赖"><a href="#1、创建项目，导入依赖" class="headerlink" title="1、创建项目，导入依赖"></a>1、创建项目，导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ryan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongodb-study<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-data-mongodb --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- this is needed or IntelliJ gives junit.jar or junit-platform-launcher:1.3.2 not found errors --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.platform<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-platform-launcher<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2、配置yml文件"><a href="#2、配置yml文件" class="headerlink" title="2、配置yml文件"></a>2、配置yml文件</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># 数据源配置</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="comment"># 主机地址</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">203.195</span><span class="number">.160</span><span class="number">.231</span></span><br><span class="line">      <span class="comment"># 数据库</span></span><br><span class="line">      <span class="attr">database:</span> <span class="string">test</span></span><br><span class="line">      <span class="comment"># 默认端口号：27017</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">27017</span></span><br></pre></td></tr></table></figure>

<h3 id="3、编写主启动类"><a href="#3、编写主启动类" class="headerlink" title="3、编写主启动类"></a>3、编写主启动类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleApplication</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">           SpringApplication.run(ArticleApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、编写实体类"><a href="#4、编写实体类" class="headerlink" title="4、编写实体类"></a>4、编写实体类</h3><p>注意：由于是非关系型数据库，所以实体类属性和mongodb数据库中已经存在的字段不需要不一定要保持一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Document</span>(collection = <span class="string">"comment"</span>)<span class="comment">//指定对应的集合</span></span><br><span class="line"><span class="meta">@CompoundIndex</span>(def = <span class="string">"&#123;'userid':1, 'nickname':-1&#125;"</span>)<span class="comment">//也可以在类上添加索引</span></span><br><span class="line"><span class="meta">@Accessors</span>(chain = <span class="keyword">true</span>)<span class="comment">//支持链式编程</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@Id</span></span><br><span class="line">    <span class="keyword">private</span> String id;<span class="comment">//主键，_id，如果属性名时id，可以省略注解@Id</span></span><br><span class="line">    <span class="meta">@Field</span>(<span class="string">"content"</span>)</span><br><span class="line">    <span class="keyword">private</span> String content;<span class="comment">//如果属性名称和集合中的字段名字不一样，可以像这样添加注解</span></span><br><span class="line">    <span class="keyword">private</span> Date publishtime;</span><br><span class="line">    <span class="meta">@Indexed</span></span><br><span class="line">    <span class="keyword">private</span> String userid;<span class="comment">//添加索引，一般会通过命令行去添加索引</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdatetime;</span><br><span class="line">    <span class="keyword">private</span> Integer likenum;</span><br><span class="line">    <span class="keyword">private</span> Integer replynum;</span><br><span class="line">    <span class="keyword">private</span> String parentid;</span><br><span class="line">    <span class="keyword">private</span> String articleid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、编写dao层"><a href="#5、编写dao层" class="headerlink" title="5、编写dao层"></a>5、编写dao层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//评论的持久层接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommentDao</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Comment</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//继承MongoRepository之后已经继承了很多crud方法，具体可以点进去查看</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果想要实现分页查询，我们需要另增方法，注意方法名格式是有要求的，findBy+字段名</span></span><br><span class="line">    <span class="function">Page&lt;Comment&gt; <span class="title">findByUserid</span><span class="params">(String userid, Pageable pageable)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6、编写service层"><a href="#6、编写service层" class="headerlink" title="6、编写service层"></a>6、编写service层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CommentDao commentDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用dao的方法，都是通过dao继承MongoRepository过来的</span></span><br><span class="line">    <span class="comment">//增</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveComment</span><span class="params">(Comment comment)</span></span>&#123;</span><br><span class="line">        commentDao.save(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateComment</span><span class="params">(Comment comment)</span></span>&#123;</span><br><span class="line">        commentDao.save(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据id删除</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCommentById</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">        commentDao.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除所有</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAllComments</span><span class="params">()</span></span>&#123;</span><br><span class="line">        commentDao.deleteAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据id查询</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Comment <span class="title">findById</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> commentDao.findById(id).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询所有</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Comment&gt; <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> commentDao.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页查询</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;Comment&gt; <span class="title">findByPage</span><span class="params">(String userid, <span class="keyword">int</span> pageNo, <span class="keyword">int</span> pageSize)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> commentDao.findByUserid(userid, PageRequest.of(pageNo,pageSize));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现点赞+1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCommentLikenum</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">        <span class="comment">//查询条件</span></span><br><span class="line">        Query query = Query.query(Criteria.where(<span class="string">"_id"</span>).is(id));<span class="comment">//查询的条件，如果是多个条件，可以在后面addCriteria</span></span><br><span class="line">        <span class="comment">//更新条件</span></span><br><span class="line">        Update update = <span class="keyword">new</span> Update();</span><br><span class="line">        update.inc(<span class="string">"likenum"</span>);<span class="comment">//自增1</span></span><br><span class="line">        <span class="comment">//执行更新</span></span><br><span class="line">        mongoTemplate.updateFirst(query, update, Comment<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>7、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CommentService commentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Comment comment = <span class="keyword">new</span> Comment();</span><br><span class="line">        comment.setContent(<span class="string">"ryan自学java"</span>)</span><br><span class="line">                .setPublishtime(<span class="keyword">new</span> Date())</span><br><span class="line">                .setUserid(<span class="string">"10086"</span>)</span><br><span class="line">                .setNickname(<span class="string">"牛排"</span>)</span><br><span class="line">                .setCreatedatetime(LocalDateTime.now())</span><br><span class="line">                .setLikenum(<span class="number">999</span>)</span><br><span class="line">                .setReplynum(<span class="number">40</span>)</span><br><span class="line">                .setArticleid(<span class="string">"9527"</span>);</span><br><span class="line">        commentService.saveComment(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//其他的crud方法就不一一测试了</span></span><br><span class="line">    <span class="comment">//如果想要实现分页查询，可以通过在dao层自定义一个方法查询</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//另外如果想通过mongodb实现点赞数+1的话，原生的+1方法效率比较低，这时候我们可以通过MongoTemplate来实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testAddLikenum</span><span class="params">()</span></span>&#123;</span><br><span class="line">        commentService.updateCommentLikenum(<span class="string">"2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>测试前，别忘了开mongodb的服务哦，我这里是将mongodb部署到远程服务上的</li>
<li>另外可以结合可视化工具compass方便查看数据哦</li>
</ul>
<p>以上是mongodb的简单入门，先写到这里，后续会再进一步学习mongodb</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ryan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/06/24/ngoDB%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/">http://yoursite.com/2020/06/24/ngoDB%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Ryan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mongodb/">mongodb</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><button class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="wechat" onclick="window.open('/img/wechat.jpg')"/><div class="post-qr-code__desc">wechat</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/06/24/asticSearch%E5%85%A5%E9%97%A8-%E6%95%B4%E5%90%88springboot/"><img class="prev-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ElasticSearch入门+整合springboot</div></div></a></div><div class="next-post pull-right"><a href="/2020/06/24/nux%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"><img class="next-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux入门教程</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'hCTAXV9K2j6lRxnNWaeqXmHJ-gzGzoHsz',
  appKey: 'bL3PlAeQjsLS33uYxl0f7BVr',
  placeholder: '记得留下你的昵称和邮箱，可以快速收到回复哦',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ryan</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text"><a href="https://ryan0824.github.io/" target="_blank" rel="noopener">Hi, welcome to myblog</a>!</div><div class="icp"><a><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备20003954号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fas fa-comments"></i></a><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script></body></html>